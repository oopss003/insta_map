<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>저장된 매장 목록</title>
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=qpbrmxiff4"></script>
  <style>
    body{margin:0;display:flex;height:100vh;font-family:sans-serif}
    #map{flex:3}
    #list{flex:1;overflow:auto;padding:10px;border-left:1px solid #ccc}
    .store{padding:6px;border-bottom:1px solid #ddd;cursor:pointer}
    .store:hover{background:#f0f4ff}

    /* ★ 색상 선택 UI 스타일 */
    #pinControl {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: rgba(255,255,255,0.9);
      padding: 8px;
      border-radius: 4px;
      font-size:14px;
    }
    #pinControl select {
      margin-left:6px;
      padding:2px 4px;
    }
  </style>
</head>
<body>

  <!-- ★ 핀 색상 선택 드롭다운 -->
  <div id="pinControl">
    <label for="pinColor">핀 색상:</label>
    <select id="pinColor">
      <option value="red">빨강</option>
      <option value="blue">파랑</option>
      <option value="green">초록</option>
      <option value="yellow">노랑</option>
      <option value="purple">보라</option>
    </select>
  </div>

  <div id="map"></div>
  <div id="list"><h3>매장 리스트</h3></div>

  <script>
    const KEY = 'instaMapStores';
    const data = JSON.parse(localStorage.getItem(KEY) || '[]');
    const $list = document.getElementById('list');
    if (!data.length) {
      $list.innerHTML += '<p>저장된 가게가 없습니다.</p>';
      console.warn('LocalStorage 비어 있음');
    }

    // 1) 맵 초기화
    const map = new naver.maps.Map('map',{
      center: new naver.maps.LatLng(37.5665,126.9780),
      zoom: 12
    });

    // 2) 핀 색상 선택 DOM
    const pinSelect = document.getElementById('pinColor');

    // 배열에 넣어두면 색상 변경 시 아이콘도 바꿀 수 있음
    const markers = [];

    // 3) 마커 생성 함수
    function addMarkers() {
      // 기존 마커 지우기
      markers.forEach(m => m.setMap(null));
      markers.length = 0;

      // 현재 선택된 색상
      const color = pinSelect.value;
      // 구글 맵 기본 마커 아이콘으로 예시 (naver SDK 도 custom URL 가능)
      const iconUrlBase = 'https://maps.google.com/mapfiles/ms/icons/';

      data.forEach(s => {
        const lat = parseFloat(s.lat), lng = parseFloat(s.lng);
        if (isNaN(lat) || isNaN(lng)) return;

        // 3-1) 마커 옵션에 icon 설정
        const marker = new naver.maps.Marker({
          position: new naver.maps.LatLng(lat, lng),
          map: map,
          icon: {
            url: `${iconUrlBase}${color}-dot.png`,
            size: new naver.maps.Size(32, 32),
            anchor: new naver.maps.Point(16, 32)
          }
        });
        markers.push(marker);

        // 3-2) InfoWindow
        const info = new naver.maps.InfoWindow({
          content: `
            <div style="min-width:160px;padding:6px">
              <strong>${s.name}</strong><br>
              <a href="https://instagram.com/${s.insta}" target="_blank">
                @${s.insta}
              </a><br>
              ${s.desc||''}
            </div>`
        });
        naver.maps.Event.addListener(marker, 'click', ()=> {
          info.open(map, marker);
        });

        // 3-3) 사이드 바 리스트
        const div = document.createElement('div');
        div.className = 'store';
        div.innerHTML = `<strong>${s.name}</strong><br>@${s.insta}`;
        div.onclick = () => {
          map.setCenter(marker.getPosition());
          map.setZoom(15);
          info.open(map, marker);
        };
        $list.appendChild(div);
      });
    }

    // 4) 최초 렌더링
    addMarkers();

    // 5) 사용자가 드롭다운을 바꾸면 마커 색상 리프레시
    pinSelect.addEventListener('change', ()=> {
      // 사이드 바는 지우지 않고, 마커만 다시 찍음
      addMarkers();
    });
  </script>
</body>
</html>
