<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê°€ê²Œ ë“±ë¡</title>
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=qpbrmxiff4"></script>
  <style>
    body{font-family:sans-serif;max-width:640px;margin:24px auto;padding:0 12px}
    #map{width:100%;height:320px;border:1px solid #ccc;border-radius:6px;margin-bottom:14px}
    label{font-weight:700;display:block;margin-top:12px}
    input,textarea{width:100%;padding:8px;font-size:14px;margin-top:4px;border:1px solid #bbb;border-radius:4px}
    button{margin-top:14px;padding:10px 18px;font-size:15px;border:none;border-radius:4px;cursor:pointer}
    #getLocBtn{background:#28a745;color:#fff}
    #saveBtn{background:#2d8cff;color:#fff}
  </style>
</head>
<body>
  <h2>ğŸ“ ê°€ê²Œ ë“±ë¡</h2>
  <div id="map"></div>

  <button id="getLocBtn">í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°</button>

  <form id="storeForm" onsubmit="return false;">
    <label>ê°€ê²Œ ì´ë¦„</label>
    <input type="text" name="name" required />

    <label>ì¸ìŠ¤íƒ€ê·¸ë¨ ID (@ ì œì™¸)</label>
    <input type="text" name="insta_id" required />

    <label>ê°€ê²Œ ì„¤ëª…</label>
    <textarea name="desc" rows="4"></textarea>

    <label>ìœ„ë„</label>
    <input type="text" id="lat" name="lat" readonly required />

    <label>ê²½ë„</label>
    <input type="text" id="lng" name="lng" readonly required />

    <button id="saveBtn" type="submit">ì €ì¥</button>
  </form>

  <script>
    // ì§€ë„ ì´ˆê¸°í™”
    const map = new naver.maps.Map('map', {
      center: new naver.maps.LatLng(37.5665, 126.9780),
      zoom: 15
    });
    let marker=null;

    // ì§€ë„ í´ë¦­ ì‹œ ì¢Œí‘œ ì…ë ¥
    naver.maps.Event.addListener(map,'click',e=>{
      setLatLng(e.coord.lat(), e.coord.lng());
    });

    // í˜„ ìœ„ì¹˜ ë²„íŠ¼
    document.getElementById('getLocBtn').addEventListener('click',()=>{
      if(!navigator.geolocation){alert('ë¸Œë¼ìš°ì €ê°€ ìœ„ì¹˜ ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');return;}
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude,longitude}=pos.coords;
        setLatLng(latitude,longitude);
        map.setCenter(new naver.maps.LatLng(latitude,longitude));
      },()=>alert('ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.'));
    });

    function setLatLng(lat,lng){
      document.getElementById('lat').value=lat;
      document.getElementById('lng').value=lng;
      if(marker) marker.setMap(null);
      marker=new naver.maps.Marker({position:new naver.maps.LatLng(lat,lng),map});
    }

    // ì €ì¥ ë¡œì§
    const KEY='instaMapStores';
    document.getElementById('storeForm').addEventListener('submit',()=>{
      const name = document.querySelector('[name=name]').value.trim();
      const insta= document.querySelector('[name=insta_id]').value.trim();
      const desc = document.querySelector('[name=desc]').value.trim();
      const lat  = document.getElementById('lat').value;
      const lng  = document.getElementById('lng').value;
      if(!name||!insta||!lat||!lng){alert('í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');return;}
      const store={name,insta,desc,lat,lng};
      const arr=JSON.parse(localStorage.getItem(KEY)||'[]');
      arr.push(store);
      localStorage.setItem(KEY,JSON.stringify(arr));
      alert('ê°€ê²Œ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      document.getElementById('storeForm').reset();
      if(marker) marker.setMap(null);
    });
  </script>
</body>
</html>
