<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>가게 등록</title>
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=qpbrmxiff4"></script>
  <style>
    body{font-family:sans-serif;max-width:640px;margin:24px auto;padding:0 12px}
    #map{width:100%;height:320px;border:1px solid #ccc;border-radius:6px;margin-bottom:14px}
    label{font-weight:700;display:block;margin-top:12px}
    input,textarea{width:100%;padding:8px;font-size:14px;margin-top:4px;border:1px solid #bbb;border-radius:4px}
    button{margin-top:14px;padding:10px 18px;font-size:15px;border:none;border-radius:4px;cursor:pointer}
    #getLocBtn{background:#28a745;color:#fff}
    #saveBtn{background:#2d8cff;color:#fff}
  </style>
</head>
<body>
  <h2>📍 가게 등록</h2>
  <div id="map"></div>

  <button id="getLocBtn">현재 위치 가져오기</button>

  <form id="storeForm" onsubmit="return false;">
    <label>가게 이름</label>
    <input type="text" name="name" required />

    <label>인스타그램 ID (@ 제외)</label>
    <input type="text" name="insta_id" required />

    <label>가게 설명</label>
    <textarea name="desc" rows="4"></textarea>

    <label>위도</label>
    <input type="text" id="lat" name="lat" readonly required />

    <label>경도</label>
    <input type="text" id="lng" name="lng" readonly required />

    <button id="saveBtn" type="submit">저장</button>
  </form>

  <script>
    // 지도 초기화
    const map = new naver.maps.Map('map', {
      center: new naver.maps.LatLng(37.5665, 126.9780),
      zoom: 15
    });
    let marker=null;

    // 지도 클릭 시 좌표 입력
    naver.maps.Event.addListener(map,'click',e=>{
      setLatLng(e.coord.lat(), e.coord.lng());
    });

    // 현 위치 버튼
    document.getElementById('getLocBtn').addEventListener('click',()=>{
      if(!navigator.geolocation){alert('브라우저가 위치 기능을 지원하지 않습니다.');return;}
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude,longitude}=pos.coords;
        setLatLng(latitude,longitude);
        map.setCenter(new naver.maps.LatLng(latitude,longitude));
      },()=>alert('위치 권한을 허용해주세요.'));
    });

    function setLatLng(lat,lng){
      document.getElementById('lat').value=lat;
      document.getElementById('lng').value=lng;
      if(marker) marker.setMap(null);
      marker=new naver.maps.Marker({position:new naver.maps.LatLng(lat,lng),map});
    }

    // 저장 로직
    const KEY='instaMapStores';
    document.getElementById('storeForm').addEventListener('submit',()=>{
      const name = document.querySelector('[name=name]').value.trim();
      const insta= document.querySelector('[name=insta_id]').value.trim();
      const desc = document.querySelector('[name=desc]').value.trim();
      const lat  = document.getElementById('lat').value;
      const lng  = document.getElementById('lng').value;
      if(!name||!insta||!lat||!lng){alert('필수 정보를 모두 입력하세요.');return;}
      const store={name,insta,desc,lat,lng};
      const arr=JSON.parse(localStorage.getItem(KEY)||'[]');
      arr.push(store);
      localStorage.setItem(KEY,JSON.stringify(arr));
      alert('가게 정보가 저장되었습니다!');
      document.getElementById('storeForm').reset();
      if(marker) marker.setMap(null);
    });
  </script>
</body>
</html>
