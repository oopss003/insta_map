<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì „ì²´ ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ (ê´€ë¦¬ììš©)</title>

  <!-- âœ… Firebase SDK (compat ë²„ì „) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      margin: 0;
      padding: 24px;
      font-family: "Pretendard", sans-serif;
      background-color: #f5f6fb;
    }

    h1 {
      margin-top: 0;
      margin-bottom: 12px;
    }

    #storeSummary {
      margin: 0 0 16px 0;
      font-size: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      font-size: 14px;
    }

    thead {
      background: #f0f2f7;
    }

    th, td {
      border-bottom: 1px solid #eee;
      padding: 8px 10px;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
    }

    tr:last-child td {
      border-bottom: none;
    }

    /* ê²€ìƒ‰ì°½ / ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #storeSummary input[type="text"] {
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      min-width: 220px;
      font-size: 14px;
    }

    #storeSummary button {
      padding: 6px 12px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
      font-size: 14px;
    }

    #storeSummary button:hover {
      background: #f0f0f0;
    }

    .center {
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>ì „ì²´ ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ (ê´€ë¦¬ììš©)</h1>

  <!-- ğŸ”¢ ë“±ë¡ëœ ë§¤ì¥ ìˆ˜ + ğŸ” ê²€ìƒ‰ + âŸ³ ì´ˆê¸°í™” -->
  <p id="storeSummary" style="display:flex;align-items:center;gap:12px;">
    <span>ë“±ë¡ëœ ë§¤ì¥ ìˆ˜: <span id="storeCount">0</span></span>

    <!-- ğŸ” ê²€ìƒ‰ì°½ -->
    <input
      id="searchInput"
      type="text"
      placeholder="ë§¤ì¥ ì´ë¦„ / ì „í™”ë²ˆí˜¸ ê²€ìƒ‰"
    />
    <button id="searchBtn" type="button">ê²€ìƒ‰</button>
    <button id="resetBtn" type="button">ì´ˆê¸°í™”</button>
  </p>

  <!-- ğŸ“‹ ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” -->
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>ë§¤ì¥ì´ë¦„</th>
        <th>ì „í™”</th>
        <th>ìœ„ë„</th>
        <th>ê²½ë„</th>
        <th>ì§€ë„ë…¸ì¶œ</th>
        <th>ì›”</th>
        <th>í™”</th>
        <th>ìˆ˜</th>
        <th>ëª©</th>
        <th>ê¸ˆ</th>
        <th>í† </th>
        <th>ì¼</th>
      </tr>
    </thead>
    <tbody id="storeTableBody">
      <!-- Firestoreì—ì„œ ë¶ˆëŸ¬ì˜¨ í–‰ì´ ì—¬ê¸° ì¶”ê°€ë¨ -->
    </tbody>
  </table>

  <!-- (ì„ íƒ) í˜ì´ì§€ë„¤ì´ì…˜ ìë¦¬ -->
  <div style="margin-top:16px;" class="center">
    <button type="button">1</button>
  </div>

  <script>
    /************************************************************
     * 1. Firebase ì´ˆê¸°í™” (ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©)
     ************************************************************/
    const firebaseConfig = {
      apiKey: "AIzaSyDjxFnP5wEE6ivH6VSUHsu8nR_X8GkARB0",
      authDomain: "twopage-ea909.firebaseapp.com",
      projectId: "twopage-ea909",
      storageBucket: "twopage-ea909.firebasestorage.app",
      messagingSenderId: "398686352913",
      appId: "1:398686352913:web:0bb872aa1e71c62ad863b0",
      measurementId: "G-3F5QFJ0D2H"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    const storeTableBody = document.getElementById('storeTableBody');
    const storeCountEl   = document.getElementById('storeCount');

    /************************************************************
     * 2. Firestore ì—ì„œ ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°
     ************************************************************/
    function createTimeCell(hoursForDay) {
      // ì˜ˆì‹œ: "06:00 ~ 26:00" í˜•ì‹ìœ¼ë¡œë§Œ ê°„ë‹¨íˆ í‘œì‹œ
      if (!hoursForDay || !hoursForDay.time) return '-';
      const start = hoursForDay.time.start || '';
      const end   = hoursForDay.time.end   || '';
      if (!start && !end) return '-';
      return `${start} ~ ${end}`;
    }

    function renderStores() {
      db.collection('stores')
        .orderBy('name')
        .get()
        .then(snapshot => {
          storeTableBody.innerHTML = '';
          let index = 0;

          snapshot.forEach(doc => {
            index += 1;
            const data = doc.data();

            const tr = document.createElement('tr');

            // ğŸ”¹ hours êµ¬ì¡°: { "ì›”": {time:{start,end}, ...}, "í™”": {...}, ... } ë¼ê³  ê°€ì •
            const hours = data.hours || {};
            const days  = ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'];

            const dayCellsHtml = days.map(d => {
              return `<td>${createTimeCell(hours[d])}</td>`;
            }).join('');

            tr.innerHTML = `
              <td>${index}</td>
              <td class="col-name">${data.name || ''}</td>
              <td class="col-phone">${data.phone || ''}</td>
              <td>${data.lat || ''}</td>
              <td>${data.lng || ''}</td>
              <td>${data.exposeMap ? 'O' : ''}</td>
              ${dayCellsHtml}
            `;

            storeTableBody.appendChild(tr);
          });

          // ì „ì²´ ê°œìˆ˜ í‘œì‹œ
          storeCountEl.textContent = index;
        })
        .catch(err => {
          console.error('ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err);
          alert('ë§¤ì¥ ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    }

    // í˜ì´ì§€ ë¡œë“œì‹œ í•œ ë²ˆ ë¶ˆëŸ¬ì˜¤ê¸°
    renderStores();


    /************************************************************
     * 3. ğŸ” ê²€ìƒ‰ + âŸ³ ì´ˆê¸°í™” ê¸°ëŠ¥
     ************************************************************/
    const searchInput = document.getElementById('searchInput');
    const searchBtn   = document.getElementById('searchBtn');
    const resetBtn    = document.getElementById('resetBtn');

    // í˜„ì¬ í™”ë©´ì— "ë³´ì´ëŠ”" í–‰ ê°œìˆ˜ ê¸°ì¤€ìœ¼ë¡œ ìˆ«ì ì—…ë°ì´íŠ¸
    function updateVisibleCount() {
      const visibleRows = Array.from(storeTableBody.querySelectorAll('tr'))
        .filter(tr => tr.style.display !== 'none');

      storeCountEl.textContent = visibleRows.length;
    }

    // ğŸ” ë¶€ë¶„ì¼ì¹˜ + ì „í™”ë²ˆí˜¸ ìˆ«ì í¬í•¨ ê²€ìƒ‰
    function applySearch() {
      const keywordRaw = searchInput.value.trim();
      const rows = storeTableBody.querySelectorAll('tr');

      // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ì „ì²´ í‘œì‹œ
      if (!keywordRaw) {
        rows.forEach(tr => { tr.style.display = ''; });
        updateVisibleCount();
        return;
      }

      const keywordLower  = keywordRaw.toLowerCase();           // ì´ë¦„ ê²€ìƒ‰ìš©
      const keywordDigits = keywordRaw.replace(/[^0-9]/g, '');  // ìˆ«ìë§Œ ì¶”ì¶œ (ì „í™”ë²ˆí˜¸ ê²€ìƒ‰ìš©)

      rows.forEach(tr => {
        const nameText  = (tr.querySelector('.col-name')?.textContent  || '');
        const phoneText = (tr.querySelector('.col-phone')?.textContent || '');

        const nameLower  = nameText.toLowerCase();
        const phoneDigits = phoneText.replace(/[^0-9]/g, '');

        // âœ… ê°€ê²Œ ì´ë¦„ì— 'í…ŒìŠ¤íŠ¸'ê°€ ë“¤ì–´ê°€ë©´ ì „ë¶€ ë§¤ì¹­
        const nameMatch  = nameLower.includes(keywordLower);

        // âœ… ì „í™”ë²ˆí˜¸ë„ ìˆ«ì ê¸°ì¤€ìœ¼ë¡œ ë¶€ë¶„ ê²€ìƒ‰ ê°€ëŠ¥(ì˜ˆ: 8613, 010 ë“±)
        const phoneMatch = keywordDigits
          ? phoneDigits.includes(keywordDigits)
          : false;

        if (nameMatch || phoneMatch) {
          tr.style.display = '';
        } else {
          tr.style.display = 'none';
        }
      });

      updateVisibleCount();
    }

    // ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­
    searchBtn.addEventListener('click', applySearch);

    // ì—”í„°í‚¤ë¡œ ê²€ìƒ‰
    searchInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        applySearch();
      }
    });

    // ì´ˆê¸°í™” ë²„íŠ¼
    resetBtn.addEventListener('click', () => {
      searchInput.value = '';
      Array.from(storeTableBody.querySelectorAll('tr')).forEach(tr => {
        tr.style.display = '';
      });
      updateVisibleCount();
    });
  </script>
</body>
</html>

