<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>전체 매장 리스트</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: 'Pretendard', sans-serif; padding: 20px; background: #f5f5f5; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; font-size: 12px; vertical-align: top; }
    th { background: #eee; position: sticky; top: 0; z-index: 1; }
    tr:hover { background: #f0f0f0; }
    select.time-select { width: 80px; font-size: 12px; }
  </style>
</head>
<body>
  <h2>전체 매장 리스트 (관리자용)</h2>
  <table id="storeTable">
    <thead>
      <tr>
        <th>#</th>
        <th>매장이름</th>
        <th>전화</th>
        <th>위도</th>
        <th>경도</th>
        <th>지도노출</th>
        <th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th><th>일</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCVV1XUfsREQYnah3tbEKBTprgq9wRgiic",
      authDomain: "instamap-9b595.firebaseapp.com",
      projectId: "instamap-9b595",
      storageBucket: "instamap-9b595.firebasestorage.app",
      messagingSenderId: "280950399393",
      appId: "1:280950399393:web:8282e0d352e50c8bcd2be0"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const days = ['월','화','수','목','금','토','일'];
    const USER_EMAIL = "jhpark8271@gmail.com";

    function generateTimeOptions(selected) {
      let options = '<option value="">-</option>';
      for (let h = 0; h <= 30; h++) {
        for (let m of ["00", "30"]) {
          const hour = h.toString().padStart(2, '0');
          const value = `${hour}:${m}`;
          const label = `${hour}:${m}`;
          options += `<option value="${value}" ${selected === value ? 'selected' : ''}>${label}</option>`;
        }
      }
      return options;
    }

    function createTimeCell(day, h, docId) {
      return `
        <div>
          ⏰ <select class="time-select" data-doc="${docId}" data-day="${day}" data-field="start">${generateTimeOptions(h.time?.start)}</select>
              ~
              <select class="time-select" data-doc="${docId}" data-day="${day}" data-field="end">${generateTimeOptions(h.time?.end)}</select>
        </div>
        <div>
          ☕ <select class="time-select" data-doc="${docId}" data-day="${day}" data-field="break_start">${generateTimeOptions(h.break?.start)}</select>
              ~
              <select class="time-select" data-doc="${docId}" data-day="${day}" data-field="break_end">${generateTimeOptions(h.break?.end)}</select>
        </div>
        <div>
          🕘 <select class="time-select" data-doc="${docId}" data-day="${day}" data-field="lastOrder">${generateTimeOptions(h.lastOrder?.time)}</select>
        </div>
      `;
    }

    async function loadStores() {
      const snapshot = await db.collection("stores").get();
      const tbody = document.querySelector("#storeTable tbody");

      let index = 1;
      snapshot.forEach(doc => {
        const d = doc.data();
        const tr = document.createElement("tr");

        const display = (d.lat && d.lng) ? "O" : "X";

        const hoursCells = days.map(day => {
          const h = d.hours?.[day] || { time:{}, break:{}, lastOrder:{} };
          return `<td>${createTimeCell(day, h, doc.id)}</td>`;
        }).join("");

        tr.innerHTML = `
          <td>${index++}</td>
          <td>${d.name || ''}</td>
          <td>${d.phone || ''}</td>
          <td>${d.lat || ''}</td>
          <td>${d.lng || ''}</td>
          <td>${display}</td>
          ${hoursCells}
        `;
        tbody.appendChild(tr);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (USER_EMAIL === "jhpark8271@gmail.com") {
        loadStores();
      } else {
        document.body.innerHTML = '<h3>접근 권한이 없습니다.</h3>';
      }
    });
  </script>
</body>
</html>

