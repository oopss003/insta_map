<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë…¸ë² ì´ìŠ¤ ì½”ë“œ ìˆ˜ì • ë„ìš°ë¯¸ (Ver 2.0)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; background-color: #f0f2f5; }
        header { background-color: #333; color: white; padding: 10px 20px; text-align: center; font-weight: bold; }
        
        .container { display: flex; height: calc(100vh - 50px); }
        .panel { flex: 1; padding: 10px; display: flex; flex-direction: column; }
        .panel h3 { text-align: center; margin: 0 0 10px 0; color: #555; }
        textarea { flex: 1; padding: 10px; font-family: 'Consolas', monospace; font-size: 14px; border: 1px solid #ccc; border-radius: 5px; resize: none; line-height: 1.5; white-space: pre; overflow-wrap: normal; overflow-x: scroll; }
        
        .controls { flex: 0 0 350px; padding: 10px; background-color: #e9ecef; border-left: 2px solid #ddd; border-right: 2px solid #ddd; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        
        .control-box { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .control-box h4 { margin: 0 0 10px 0; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .control-box.delete { border-top: 5px solid #ff6b6b; }
        .control-box.replace { border-top: 5px solid #4dabf7; }
        .control-box.insert { border-top: 5px solid #51cf66; }

        label { display: block; margin-top: 8px; font-size: 12px; font-weight: bold; color: #666; }
        input[type="text"] { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-family: 'Consolas', monospace; }
        
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        button { flex: 1; padding: 8px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        
        .btn-find { background-color: #fcc419; color: #333; }
        .btn-del { background-color: #fa5252; color: white; }
        .btn-mod { background-color: #228be6; color: white; }
        .btn-add { background-color: #40c057; color: white; }
        
        button:hover { opacity: 0.8; }
        
        #status-msg { text-align: center; color: #d6336c; font-weight: bold; height: 20px; margin-top: 5px; font-size: 13px; }
    </style>
</head>
<body>

<header>ğŸ› ï¸ ë…¸ë² ì´ìŠ¤ ì½”ë“œ ìˆ˜ì • ë„ìš°ë¯¸ (Ver 2.0 - ìŠ¤ë§ˆíŠ¸ ê³µë°± ê°ì§€)</header>

<div class="container">
    <div class="panel">
        <h3>1. ì›ë³¸ ì½”ë“œ (ê¸°ì¤€)</h3>
        <textarea id="leftCode" placeholder="ì—¬ê¸°ì— ì›ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
    </div>

    <div class="controls">
        <div id="status-msg"></div>

        <div class="control-box delete">
            <h4>ğŸ—‘ï¸ ì½”ë“œ ì‚­ì œ</h4>
            <label>ì§€ìš¸ ì½”ë“œ (ê³µë°± ì‹ ê²½ì“°ì§€ ë§ê³  ë„£ìœ¼ì„¸ìš”)</label>
            <input type="text" id="delTarget" placeholder="ì˜ˆ: delay(1000);">
            <div class="btn-group">
                <button class="btn-find" onclick="smartFind('delTarget')">ğŸ” ìœ„ì¹˜ í™•ì¸</button>
                <button class="btn-del" onclick="smartDelete()">âŒ ì‚­ì œ ì‹¤í–‰</button>
            </div>
        </div>

        <div class="control-box replace">
            <h4>ğŸ”„ ì½”ë“œ ìˆ˜ì • (êµì²´)</h4>
            <label>ìˆ˜ì • ì „ ì½”ë“œ (ì°¾ì„ ë‚´ìš©)</label>
            <input type="text" id="modBefore" placeholder="ì˜ˆ: int a = 10;">
            <label>ìˆ˜ì • í›„ ì½”ë“œ (ë°”ê¿€ ë‚´ìš©)</label>
            <input type="text" id="modAfter" placeholder="ì˜ˆ: int a = 20;">
            <div class="btn-group">
                <button class="btn-find" onclick="smartFind('modBefore')">ğŸ” ìœ„ì¹˜ í™•ì¸</button>
                <button class="btn-mod" onclick="smartReplace()">ğŸ”„ êµì²´ ì‹¤í–‰</button>
            </div>
        </div>

        <div class="control-box insert">
            <h4>â• ì½”ë“œ ì¶”ê°€ (ë¼ì›Œë„£ê¸°)</h4>
            <label>ë°”ë¡œ ìœ—ì¤„ ì½”ë“œ (ê¸°ì¤€ì )</label>
            <input type="text" id="addAnchor" placeholder="ì˜ˆ: void setup() {">
            <label>ì¶”ê°€í•  ì½”ë“œ (ìƒˆ ë‚´ìš©)</label>
            <input type="text" id="addContent" placeholder="ì˜ˆ: Serial.begin(9600);">
            <div class="btn-group">
                <button class="btn-find" onclick="smartFind('addAnchor')">ğŸ” ìœ„ì¹˜ í™•ì¸</button>
                <button class="btn-add" onclick="smartInsert()">â• ì¶”ê°€ ì‹¤í–‰</button>
            </div>
        </div>
    </div>

    <div class="panel">
        <h3>3. ê²°ê³¼ ì½”ë“œ (ì™„ì„±ë³¸)</h3>
        <textarea id="rightCode" placeholder="ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì—¬ê¸°ì— ìˆ˜ì •ëœ ì½”ë“œê°€ ë‚˜ì˜µë‹ˆë‹¤."></textarea>
    </div>
</div>

<script>
    const leftArea = document.getElementById('leftCode');
    const rightArea = document.getElementById('rightCode');
    const msgArea = document.getElementById('status-msg');

    leftArea.addEventListener('input', function() {
        if(rightArea.value === "") { 
            rightArea.value = leftArea.value;
        }
    });

    // âœ¨ í•µì‹¬ ê¸°ëŠ¥: ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰ (ê³µë°± ë¬´ì‹œí•˜ê³  ì§„ì§œ ìœ„ì¹˜ ì°¾ê¸°)
    function findRealStringWithIndent(searchText, sourceCode) {
        if (!searchText) return null;
        
        // ì½”ë“œë¥¼ ì¤„ ë‹¨ìœ„ë¡œ ìª¼ê°­ë‹ˆë‹¤.
        const lines = sourceCode.split('\n');
        const trimmedSearch = searchText.trim(); // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì˜ ì•ë’¤ ê³µë°± ì œê±°

        for (let i = 0; i < lines.length; i++) {
            // ì›ë³¸ ì¤„ì˜ ê³µë°±ì„ ì œê±°í•˜ê³  ë¹„êµ
            if (lines[i].trim().includes(trimmedSearch)) {
                // ì°¾ì•˜ë‹¤ë©´, ê³µë°±ì´ í¬í•¨ëœ 'ì§„ì§œ ì›ë³¸ ì¤„'ì„ ë°˜í™˜
                return lines[i]; 
            }
        }
        return null;
    }

    // 1. ì°¾ê¸°
    function smartFind(inputId) {
        const inputVal = document.getElementById(inputId).value;
        const realLine = findRealStringWithIndent(inputVal, leftArea.value);

        if (realLine) {
            // ì§„ì§œ ìœ„ì¹˜(ê³µë°± í¬í•¨)ë¥¼ ì°¾ì•„ì„œ í•˜ì´ë¼ì´íŠ¸
            const index = leftArea.value.indexOf(realLine);
            leftArea.focus();
            leftArea.setSelectionRange(index, index + realLine.length);
            showMsg("âœ… ì°¾ì•˜ìŠµë‹ˆë‹¤! (ì•ì— ê³µë°±ì´ ìˆì–´ë„ ì°¾ìŒ)");
        } else {
            showMsg("âš ï¸ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì˜¤íƒ€ê°€ ìˆë‚˜ìš”?");
        }
    }

    // 2. ì‚­ì œ
    function smartDelete() {
        const inputVal = document.getElementById('delTarget').value;
        let currentCode = rightArea.value || leftArea.value;
        
        // ê³µë°± í¬í•¨ëœ ì§„ì§œ ë¬¸ìì—´ ì°¾ê¸°
        const realLine = findRealStringWithIndent(inputVal, currentCode);

        if (realLine) {
            rightArea.value = currentCode.replace(realLine, ""); // í•´ë‹¹ ì¤„ ì „ì²´ ì‚­ì œ
            showMsg("âœ… ì‚­ì œ ì™„ë£Œ!");
        } else {
            showMsg("âš ï¸ ì´ë¯¸ ì‚­ì œë˜ì—ˆê±°ë‚˜ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }

    // 3. ìˆ˜ì •
    function smartReplace() {
        const beforeVal = document.getElementById('modBefore').value;
        const afterVal = document.getElementById('modAfter').value;
        let currentCode = rightArea.value || leftArea.value;

        const realLine = findRealStringWithIndent(beforeVal, currentCode);

        if (realLine) {
            // ê¸°ì¡´ ë“¤ì—¬ì“°ê¸°(ê³µë°±)ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ ì•ë¶€ë¶„ ê³µë°±ì„ ê³„ì‚°
            const indent = realLine.substring(0, realLine.indexOf(realLine.trim()));
            const newLine = indent + afterVal; // ë“¤ì—¬ì“°ê¸° + ìƒˆ ì½”ë“œ

            rightArea.value = currentCode.replace(realLine, newLine);
            showMsg("âœ… ìˆ˜ì • ì™„ë£Œ! (ë“¤ì—¬ì“°ê¸° ìœ ì§€ë¨)");
        } else {
            showMsg("âš ï¸ ìˆ˜ì •í•  ëŒ€ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }

    // 4. ì¶”ê°€
    function smartInsert() {
        const anchorVal = document.getElementById('addAnchor').value;
        const contentVal = document.getElementById('addContent').value;
        let currentCode = rightArea.value || leftArea.value;

        const realLine = findRealStringWithIndent(anchorVal, currentCode);

        if (realLine) {
            // ê¸°ì¤€ ì¤„ì˜ ë“¤ì—¬ì“°ê¸°ë¥¼ íŒŒì•…í•´ì„œ ë˜‘ê°™ì´ ë§ì¶°ì¤Œ
            const indent = realLine.substring(0, realLine.indexOf(realLine.trim()));
            const newBlock = realLine + "\n" + indent + contentVal;
            
            rightArea.value = currentCode.replace(realLine, newBlock);
            showMsg("âœ… ì¶”ê°€ ì™„ë£Œ! (ì¤„ë§ì¶¤ ìë™ ì ìš©)");
        } else {
            showMsg("âš ï¸ ê¸°ì¤€ ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }

    function showMsg(text) {
        msgArea.innerText = text;
        setTimeout(() => { msgArea.innerText = ""; }, 3000);
    }
</script>

</body>
</html>
