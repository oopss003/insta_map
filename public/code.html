<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì½”ë“œ ë¹„êµ ë° ì €ì¥ ë„êµ¬</title>
  <style>
    body {
      font-family: 'Pretendard', monospace;
      padding: 20px;
      background: #f4f4f4;
    }

    .top-bar {
      margin-bottom: 12px;
    }

    .top-bar input {
      padding: 8px;
      width: 200px;
    }

    .top-bar button, select {
      padding: 8px 14px;
      margin-left: 5px;
      font-weight: bold;
    }

    .container {
      display: flex;
      gap: 20px;
    }

    .editor-wrapper {
      display: flex;
      width: 48%;
      height: 250px;
      border: 1px solid #ccc;
      background: white;
      font-family: monospace;
    }

    .line-numbers {
      width: 40px;
      background: #eee;
      text-align: right;
      padding: 10px 4px;
      color: #888;
      overflow: hidden;
      user-select: none;
      line-height: 1.4em;
    }

    textarea {
      flex: 1;
      border: none;
      resize: none;
      font-size: 14px;
      padding: 10px;
      line-height: 1.4em;
      outline: none;
    }

    .diff-result {
      margin-top: 20px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      font-family: monospace;
      white-space: pre-wrap;
    }

    .added {
      background-color: #ddffdd;
    }

    .removed {
      background-color: #ffdddd;
    }

    .line-number {
      color: gray;
      display: inline-block;
      width: 40px;
      text-align: right;
      margin-right: 8px;
      user-select: none;
    }
  </style>
</head>
<body>

  <div class="top-bar">
    <input type="text" id="codeName" placeholder="ì½”ë“œ ì´ë¦„ ì…ë ¥ (ì˜ˆ: ì½”ë“œ1)">
    <button onclick="compareCode()">ğŸ” ë¶„ì„</button>
    <button onclick="saveCode()">ğŸ’¾ ì €ì¥</button>
    <button onclick="loadSavedCodes()">ğŸ“‚ ì €ì¥ëœ ì½”ë“œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <select id="codeSelect"></select>
    <button onclick="exportCodeToFile()">ğŸ“¥ íŒŒì¼ë¡œ ì €ì¥</button>
  </div>

  <div class="container">
    <div class="editor-wrapper">
      <div class="line-numbers" id="oldLineNumbers">1</div>
      <textarea id="oldCode" oninput="updateLineNumbers('oldCode', 'oldLineNumbers')" placeholder="ì´ì „ ì½”ë“œ ì…ë ¥"></textarea>
    </div>
    <div class="editor-wrapper">
      <div class="line-numbers" id="newLineNumbers">1</div>
      <textarea id="newCode" oninput="updateLineNumbers('newCode', 'newLineNumbers')" placeholder="ì‹ ê·œ ì½”ë“œ ì…ë ¥"></textarea>
    </div>
  </div>

  <div id="diffOutput" class="diff-result"></div>

  <script>
    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    function pad(n) {
      return n.toString().padStart(2, '0');
    }

    function updateLineNumbers(textareaId, lineNumberId) {
      const textarea = document.getElementById(textareaId);
      const lineNumberDiv = document.getElementById(lineNumberId);
      const lines = textarea.value.split('\n').length;
      let html = '';
      for (let i = 1; i <= lines; i++) {
        html += i + '\n';
      }
      lineNumberDiv.textContent = html;
    }

    function compareCode() {
      const oldCode = document.getElementById("oldCode").value.trim().split('\n');
      const newCode = document.getElementById("newCode").value.trim().split('\n');

      const maxLines = Math.max(oldCode.length, newCode.length);
      let resultHTML = "";

      for (let i = 0; i < maxLines; i++) {
        const oldLine = oldCode[i] || "";
        const newLine = newCode[i] || "";
        const lineNum = `<span class="line-number">${i + 1}</span>`;

        if (oldLine === newLine) {
          resultHTML += `${lineNum}${escapeHtml(newLine)}\n`;
        } else if (oldLine && !newLine) {
          resultHTML += `<span class="removed">${lineNum}${escapeHtml(oldLine)}</span>\n`;
        } else if (!oldLine && newLine) {
          resultHTML += `<span class="added">${lineNum}${escapeHtml(newLine)}</span>\n`;
        } else {
          resultHTML += `<span class="removed">${lineNum}${escapeHtml(oldLine)}</span>\n`;
          resultHTML += `<span class="added">${lineNum}${escapeHtml(newLine)}</span>\n`;
        }
      }

      document.getElementById("diffOutput").innerHTML = `<pre>${resultHTML}</pre>`;
    }

    function saveCode() {
      const codeName = document.getElementById("codeName").value.trim();
      const newCode = document.getElementById("newCode").value;

      if (!codeName) {
        alert("ì½”ë“œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }

      let history = JSON.parse(localStorage.getItem("codeHistory") || "{}");
      history[codeName] = newCode;
      localStorage.setItem("codeHistory", JSON.stringify(history));

      alert(`'${codeName}' ì½”ë“œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    function loadSavedCodes() {
      const history = JSON.parse(localStorage.getItem("codeHistory") || "{}");
      const select = document.getElementById("codeSelect");
      select.innerHTML = "";

      Object.keys(history).forEach((name) => {
        const option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });

      select.onchange = function () {
        const selectedCode = select.value;
        document.getElementById("newCode").value = history[selectedCode];
        updateLineNumbers('newCode', 'newLineNumbers');
        alert(`'${selectedCode}' ì½”ë“œê°€ ë¶ˆëŸ¬ì™€ì¡ŒìŠµë‹ˆë‹¤.`);
      };
    }

    function exportCodeToFile() {
      const codeName = document.getElementById("codeName").value.trim();
      const codeText = document.getElementById("newCode").value;

      if (!codeName) {
        alert("ì½”ë“œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }

      const blob = new Blob([codeText], { type: "text/plain;charset=utf-8" });

      const now = new Date();
      const dateStr = `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}_${pad(now.getHours())}-${pad(now.getMinutes())}-${pad(now.getSeconds())}`;
      const filename = `${codeName}_${dateStr}.txt`;

      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = filename;
      link.click();
      URL.revokeObjectURL(link.href);
    }

    // ì´ˆê¸° ì¤„ ë²ˆí˜¸ í‘œì‹œ
    window.onload = () => {
      updateLineNumbers('oldCode', 'oldLineNumbers');
      updateLineNumbers('newCode', 'newLineNumbers');
    };
  </script>

</body>
</html>

