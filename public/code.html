<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ÏΩîÎìú ÎπÑÍµê ÎèÑÍµ¨</title>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background: #f5f6fb;
      margin: 0;
      padding: 20px;
    }

    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 10px;
      font-family: monospace;
    }

    .diff-result {
      border: 1px solid #ccc;
      padding: 10px;
      background: #fff;
      font-family: monospace;
      white-space: pre-wrap;
      margin-top: 20px;
      border-radius: 6px;
    }

    mark.del {
      background-color: #ffecec;
      color: #f00;
      text-decoration: line-through;
    }

    mark.add {
      background-color: #eaffea;
      color: #080;
    }

    .button-row {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h2>ÏΩîÎìú ÎπÑÍµê ÎèÑÍµ¨</h2>

  <input id="fileName" type="text" placeholder="ÌååÏùºÎ™Ö ÏûÖÎ†•" style="padding: 6px; width: 200px;" />

  <div class="button-row">
    <button onclick="analyze()">üîç Î∂ÑÏÑù</button>
    <button onclick="saveToLocal()">üíæ Ï†ÄÏû•</button>
    <button onclick="downloadFile()">üì• ÌååÏùºÎ°ú Ï†ÄÏû•</button>
  </div>

  <textarea id="oldCode" placeholder="Ïù¥Ï†Ñ ÏΩîÎìú ÏûÖÎ†•"></textarea>
  <textarea id="newCode" placeholder="Ïã†Í∑ú ÏΩîÎìú ÏûÖÎ†•"></textarea>

  <div id="result" class="diff-result"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch.js"></script>
  <script>
    function analyze() {
      const dmp = new diff_match_patch();
      const oldCode = document.getElementById('oldCode').value;
      const newCode = document.getElementById('newCode').value;
      const diff = dmp.diff_main(oldCode, newCode);
      dmp.diff_cleanupSemantic(diff);

      const resultHTML = diff.map(([op, data]) => {
        if (op === -1) return `<mark class="del">${data}</mark>`;
        if (op === 1) return `<mark class="add">${data}</mark>`;
        return data;
      }).join('');

      document.getElementById('result').innerHTML = resultHTML;
    }

    function saveToLocal() {
      const fileName = document.getElementById("fileName").value || "untitled";
      const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
      const fullName = `${fileName}_${timestamp}`;
      const code = document.getElementById("newCode").value;

      const history = JSON.parse(localStorage.getItem("codeHistory") || "{}");
      history[fullName] = code;
      localStorage.setItem("codeHistory", JSON.stringify(history));
      alert(`"${fullName}" Ï†ÄÏû• ÏôÑÎ£å`);
    }

    function downloadFile() {
      const fileName = document.getElementById("fileName").value || "untitled";
      const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
      const fullName = `${fileName}_${timestamp}.txt`;
      const text = document.getElementById("newCode").value;
      const blob = new Blob([text], { type: "text/plain" });

      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = fullName;
      a.click();
    }
  </script>
</body>
</html>
