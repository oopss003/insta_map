<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë…¸ë² ì´ìŠ¤ ì½”ë“œ ìˆ˜ì • ë„ìš°ë¯¸ (Ver 3.0 - ë©€í‹°ë¼ì¸ ì™„ë²½ ì§€ì›)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; background-color: #f0f2f5; }
        header { background-color: #333; color: white; padding: 10px 20px; text-align: center; font-weight: bold; }
        
        .container { display: flex; height: calc(100vh - 50px); }
        .panel { flex: 1; padding: 10px; display: flex; flex-direction: column; }
        .panel h3 { text-align: center; margin: 0 0 10px 0; color: #555; }
        
        /* í…ìŠ¤íŠ¸ ì—ë””í„° ìŠ¤íƒ€ì¼ í†µì¼ */
        textarea { flex: 1; padding: 10px; font-family: 'Consolas', monospace; font-size: 13px; border: 1px solid #ccc; border-radius: 5px; resize: none; line-height: 1.5; white-space: pre; overflow-wrap: normal; overflow-x: scroll; background-color: #fff; }
        
        /* ì¤‘ì•™ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .controls { flex: 0 0 380px; padding: 10px; background-color: #e9ecef; border-left: 2px solid #ddd; border-right: 2px solid #ddd; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        
        .control-box { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .control-box h4 { margin: 0 0 10px 0; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .control-box.delete { border-top: 5px solid #ff6b6b; }
        .control-box.replace { border-top: 5px solid #4dabf7; }
        .control-box.insert { border-top: 5px solid #51cf66; }

        label { display: block; margin-top: 8px; font-size: 12px; font-weight: bold; color: #666; }
        
        /* ì¤‘ìš”: ì…ë ¥ì°½ì„ inputì—ì„œ textareaë¡œ ë³€ê²½í•˜ì—¬ ì—¬ëŸ¬ ì¤„ ì…ë ¥ ê°€ëŠ¥í•˜ê²Œ í•¨ */
        .code-input { 
            width: 100%; height: 80px; /* ë†’ì´ í™•ë³´ */
            padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-family: 'Consolas', monospace; font-size: 12px;
            resize: vertical; /* ì„¸ë¡œë¡œ ëŠ˜ë¦¬ê¸° ê°€ëŠ¥ */
        }
        
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        button { flex: 1; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        
        .btn-find { background-color: #fcc419; color: #333; }
        .btn-del { background-color: #fa5252; color: white; }
        .btn-mod { background-color: #228be6; color: white; }
        .btn-add { background-color: #40c057; color: white; }
        
        button:hover { opacity: 0.8; }
        
        #status-msg { text-align: center; color: #d6336c; font-weight: bold; min-height: 20px; margin-top: 5px; font-size: 13px; }
    </style>
</head>
<body>

<header>ğŸ› ï¸ ë…¸ë² ì´ìŠ¤ ì½”ë“œ ìˆ˜ì • ë„ìš°ë¯¸ (Ver 3.0 - ê¸´ ì½”ë“œë„ í•œë°©ì—!)</header>

<div class="container">
    <div class="panel">
        <h3>1. ì›ë³¸ ì½”ë“œ (ê¸°ì¤€)</h3>
        <textarea id="leftCode" placeholder="ì—¬ê¸°ì— ì›ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
    </div>

    <div class="controls">
        <div id="status-msg"></div>

        <div class="control-box delete">
            <h4>ğŸ—‘ï¸ ì½”ë“œ ì‚­ì œ</h4>
            <label>ì§€ìš¸ ì½”ë“œ (ì—¬ëŸ¬ ì¤„ ë³µì‚¬í•´ë„ ë©ë‹ˆë‹¤)</label>
            <textarea id="delTarget" class="code-input" placeholder="function abc() { ... }"></textarea>
            <div class="btn-group">
                <button class="btn-find" onclick="findBlock('delTarget')">ğŸ” ìœ„ì¹˜ í™•ì¸</button>
                <button class="btn-del" onclick="deleteBlock()">âŒ ë©ì–´ë¦¬ ì‚­ì œ</button>
            </div>
        </div>

        <div class="control-box replace">
            <h4>ğŸ”„ ì½”ë“œ ìˆ˜ì • (êµì²´)</h4>
            <label>ìˆ˜ì • ì „ ì½”ë“œ (ì°¾ì„ ë‚´ìš©)</label>
            <textarea id="modBefore" class="code-input" placeholder="ê¸°ì¡´ ì½”ë“œ"></textarea>
            <label>ìˆ˜ì • í›„ ì½”ë“œ (ë°”ê¿€ ë‚´ìš©)</label>
            <textarea id="modAfter" class="code-input" placeholder="ìƒˆë¡œìš´ ì½”ë“œ"></textarea>
            <div class="btn-group">
                <button class="btn-find" onclick="findBlock('modBefore')">ğŸ” ìœ„ì¹˜ í™•ì¸</button>
                <button class="btn-mod" onclick="replaceBlock()">ğŸ”„ ë©ì–´ë¦¬ êµì²´</button>
            </div>
        </div>

        <div class="control-box insert">
            <h4>â• ì½”ë“œ ì¶”ê°€ (ë¼ì›Œë„£ê¸°)</h4>
            <label>ê¸°ì¤€ ì½”ë“œ (ì´ ì½”ë“œ ë°‘ì— ì¶”ê°€ë¨)</label>
            <textarea id="addAnchor" class="code-input" style="height:50px;" placeholder="ì˜ˆ: void setup() {"></textarea>
            <label>ì¶”ê°€í•  ì½”ë“œ</label>
            <textarea id="addContent" class="code-input" placeholder="ìƒˆë¡œìš´ ê¸°ëŠ¥..."></textarea>
            <div class="btn-group">
                <button class="btn-find" onclick="findBlock('addAnchor')">ğŸ” ìœ„ì¹˜ í™•ì¸</button>
                <button class="btn-add" onclick="insertBlock()">â• ì¶”ê°€ ì‹¤í–‰</button>
            </div>
        </div>
    </div>

    <div class="panel">
        <h3>3. ê²°ê³¼ ì½”ë“œ (ì™„ì„±ë³¸)</h3>
        <textarea id="rightCode" placeholder="ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì—¬ê¸°ì— ìˆ˜ì •ëœ ì½”ë“œê°€ ë‚˜ì˜µë‹ˆë‹¤."></textarea>
    </div>
</div>

<script>
    const leftArea = document.getElementById('leftCode');
    const rightArea = document.getElementById('rightCode');
    const msgArea = document.getElementById('status-msg');

    leftArea.addEventListener('input', function() {
        if(rightArea.value.trim() === "") { 
            rightArea.value = leftArea.value;
        }
    });

    // âœ¨ í•µì‹¬ ì—”ì§„: ê³µë°±/ì¤„ë°”ê¿ˆì„ ì‹¹ ë¬´ì‹œí•˜ê³  "ì˜ë¯¸"ë§Œ ë¹„êµí•˜ëŠ” ì •ê·œí™” í•¨ìˆ˜
    function normalize(str) {
        // ëª¨ë“  ê³µë°±(ìŠ¤í˜ì´ìŠ¤, íƒ­, ì¤„ë°”ê¿ˆ)ì„ ì œê±°í•˜ê³  í•œ ì¤„ë¡œ ë§Œë“¦
        return str.replace(/\s+/g, '');
    }

    // ë¸”ë¡ ì°¾ê¸° í•¨ìˆ˜ (ì›ë³¸ ì½”ë“œì—ì„œ ëª‡ ë²ˆì§¸ ì¤„ë¶€í„° ëª‡ ë²ˆì§¸ ì¤„ê¹Œì§€ì¸ì§€ ì°¾ìŒ)
    function findLineRange(searchText, sourceCode) {
        if (!searchText.trim()) return null;

        const sourceLines = sourceCode.split('\n');
        const searchLines = searchText.split('\n').filter(line => line.trim() !== ''); // ë¹ˆ ì¤„ì€ ê²€ìƒ‰ì—ì„œ ì œì™¸
        
        if (searchLines.length === 0) return null;

        // ì›ë³¸ ì½”ë“œë¥¼ í•œ ì¤„ì”© í›‘ìœ¼ë©´ì„œ ê²€ìƒ‰
        for (let i = 0; i < sourceLines.length; i++) {
            // 1. ì²« ì¤„ì´ ë§¤ì¹­ë˜ëŠ”ì§€ í™•ì¸ (ê³µë°± ë¬´ì‹œ)
            if (normalize(sourceLines[i]) === normalize(searchLines[0])) {
                
                // 2. ì²« ì¤„ì´ ê°™ë‹¤ë©´, ê·¸ ë‹¤ìŒ ì¤„ë“¤ë„ ì—°ì†ìœ¼ë¡œ ê°™ì€ì§€ í™•ì¸
                let isMatch = true;
                for (let j = 1; j < searchLines.length; j++) {
                    // ì›ë³¸ ì½”ë“œ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë©´ ë¶ˆì¼ì¹˜
                    if (i + j >= sourceLines.length) { isMatch = false; break; }
                    
                    // ë‹¤ìŒ ì¤„ ë¹„êµ
                    if (normalize(sourceLines[i + j]) !== normalize(searchLines[j])) {
                        isMatch = false;
                        break;
                    }
                }

                // 3. ëª¨ë“  ì¤„ì´ ì¼ì¹˜í•˜ë©´ ë²”ìœ„ ë°˜í™˜ (ì‹œì‘ì¤„ ì¸ë±ìŠ¤, ì¤„ ê°œìˆ˜)
                if (isMatch) {
                    return { start: i, count: searchLines.length, totalSearchLines: searchLines.length };
                }
            }
        }
        return null;
    }

    // 1. ì°¾ê¸° ë²„íŠ¼
    function findBlock(inputId) {
        const inputVal = document.getElementById(inputId).value;
        const currentCode = leftArea.value;
        const result = findLineRange(inputVal, currentCode);

        if (result) {
            // ì‹œê°ì  í•˜ì´ë¼ì´íŠ¸ (ì •í™•í•œ ë¬¸ì ìœ„ì¹˜ ê³„ì‚°ì€ ë³µì¡í•˜ë¯€ë¡œ ì¤„ ë‹¨ìœ„ë¡œ ì•Œë¦¼)
            showMsg(`âœ… ì°¾ì•˜ìŠµë‹ˆë‹¤! (ì›ë³¸ ì½”ë“œì˜ ${result.start + 1}ë²ˆì§¸ ì¤„ ê·¼ì²˜)`);
            
            // ëŒ€ëµì ì¸ ìœ„ì¹˜ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
            const lineHeight = 20; // ëŒ€ëµì ì¸ ì¤„ ë†’ì´
            leftArea.scrollTop = result.start * lineHeight;
            leftArea.focus();
        } else {
            showMsg("âš ï¸ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ë„ì–´ì“°ê¸°ëŠ” ìƒê´€ì—†ì§€ë§Œ ì˜¤íƒ€ë¥¼ í™•ì¸í•˜ì„¸ìš”)");
        }
    }

    // 2. ì‚­ì œ ì‹¤í–‰
    function deleteBlock() {
        const inputVal = document.getElementById('delTarget').value;
        let currentCode = rightArea.value || leftArea.value; // ìš°ì¸¡ ìš°ì„ 
        const result = findLineRange(inputVal, currentCode);

        if (result) {
            // ì¤„ ë‹¨ìœ„ë¡œ ìª¼ê°œì„œ í•´ë‹¹ ë²”ìœ„ ì‚­ì œ
            const lines = currentCode.split('\n');
            
            // ì‚­ì œ ë¡œì§: ì°¾ì€ ìœ„ì¹˜ì—ì„œ 'ê²€ìƒ‰ëœ ì¤„ ê°œìˆ˜'ë§Œí¼ ê±´ë„ˆë›°ê³  ë‚˜ë¨¸ì§€ ì¬ì¡°ë¦½
            // ì£¼ì˜: ì›ë³¸ ì½”ë“œì—ëŠ” ë¹ˆ ì¤„ì´ ì„ì—¬ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ë§¤ì¹­ëœ ì¤„ë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì°¾ì•„ì„œ ì§€ì›Œì•¼ í•¨.
            // í•˜ì§€ë§Œ ë³µì¡ì„±ì„ ì¤„ì´ê¸° ìœ„í•´ ë‹¨ìˆœ êµì²´ ë°©ì‹ì„ ì‚¬ìš© (normalize ê¸°ë°˜ replace)
            
            // ë” ê°•ë ¥í•œ ì‚­ì œ: í…ìŠ¤íŠ¸ ë©ì–´ë¦¬ êµì²´ ì‹œë„
            // (ì¤„ ë‹¨ìœ„ ë§¤ì¹­ëœ ë¶€ë¶„ì„ ì°¾ì•„ì„œ ì œê±°)
            let newLines = [];
            let skipCount = 0;
            const searchLines = inputVal.split('\n').filter(l => l.trim() !== '');

            for (let i = 0; i < lines.length; i++) {
                // ë§¤ì¹­ ì‹œì‘ ì§€ì  ë„ë‹¬
                if (i === result.start) {
                    // ì—¬ê¸°ì„œë¶€í„°ëŠ” ê±´ë„ˆëœ€ (ì‚­ì œ)
                    // ë‹¨, ì›ë³¸ ì½”ë“œì˜ ë¹ˆ ì¤„ ì—¬ë¶€ë¥¼ ê³ ë ¤í•´ì•¼ í•¨.
                    // í˜„ì¬ ì•Œê³ ë¦¬ì¦˜ì€ 'ë‚´ìš©ì´ ìˆëŠ” ì¤„' ê¸°ì¤€ì´ë¯€ë¡œ, 
                    // ê°„ë‹¨í•˜ê²Œ startë¶€í„° ëŒ€ëµì ì¸ ë²”ìœ„ë§Œí¼ ì§€ìš°ëŠ” ë°©ì‹ë³´ë‹¤ëŠ”
                    // ì •í™•íˆ ë§¤ì¹­ëœ êµ¬ê°„ì„ ë„ë ¤ë‚´ëŠ” ê²Œ ì•ˆì „í•¨.
                    
                    // ì—¬ê¸°ì„œëŠ” ì‹¬í”Œí•˜ê²Œ: "ì°¾ì€ ë¸”ë¡ê³¼ ë‚´ìš©ì´ ê°™ì€ ë¶€ë¶„ì„ ì§€ì›€"
                    let matchIdx = 0;
                    let scanning = i;
                    while(matchIdx < searchLines.length && scanning < lines.length) {
                        if (normalize(lines[scanning]) === normalize(searchLines[matchIdx])) {
                            // ì§€ìš¸ ëŒ€ìƒì„ -> newLinesì— ì•ˆ ë„£ìŒ
                            matchIdx++;
                        } else if (lines[scanning].trim() === '') {
                             // ë¹ˆ ì¤„ì€ ê·¸ëƒ¥ ë‘ ? ì•„ë‹ˆë©´ ê°™ì´ ì§€ì›€? -> ë³´í†µ ê°™ì´ ì§€ìš°ëŠ”ê²Œ ê¹”ë”í•¨
                             // ì—¬ê¸°ì„  ë¹ˆì¤„ë„ ì‚­ì œ ëŒ€ìƒì— í¬í•¨ëœë‹¤ê³  ê°€ì •
                        } else {
                            // ë§¤ì¹­ ì‹¤íŒ¨? (ì´ë¡ ìƒ ì•ˆ ì˜´)
                            newLines.push(lines[scanning]);
                        }
                        scanning++;
                    }
                    i = scanning - 1; // ë£¨í”„ ì¸ë±ìŠ¤ ì¡°ì •
                    showMsg("âœ… ì‚­ì œ ì™„ë£Œ!");
                } else {
                    newLines.push(lines[i]);
                }
            }
            rightArea.value = newLines.join('\n');

        } else {
            showMsg("âš ï¸ ì‚­ì œí•  ì½”ë“œë¥¼ ë³¸ë¬¸ì—ì„œ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    // 3. ìˆ˜ì • (êµì²´) ì‹¤í–‰
    function replaceBlock() {
        const beforeVal = document.getElementById('modBefore').value;
        const afterVal = document.getElementById('modAfter').value;
        let currentCode = rightArea.value || leftArea.value;
        const result = findLineRange(beforeVal, currentCode);

        if (result) {
            const lines = currentCode.split('\n');
            let newLines = [];
            const searchLines = beforeVal.split('\n').filter(l => l.trim() !== '');

            for (let i = 0; i < lines.length; i++) {
                if (i === result.start) {
                    // ë§¤ì¹­ëœ ë¶€ë¶„ ë°œê²¬ -> ì—¬ê¸°ì— ìƒˆ ì½”ë“œ ì‚½ì…
                    newLines.push(afterVal);
                    
                    // ê¸°ì¡´ ì½”ë“œëŠ” ê±´ë„ˆë›°ê¸°
                    let matchIdx = 0;
                    let scanning = i;
                    while(matchIdx < searchLines.length && scanning < lines.length) {
                        if (normalize(lines[scanning]) === normalize(searchLines[matchIdx])) {
                            matchIdx++;
                        }
                        scanning++;
                    }
                    i = scanning - 1;
                    showMsg("âœ… êµì²´ ì™„ë£Œ!");
                } else {
                    newLines.push(lines[i]);
                }
            }
            rightArea.value = newLines.join('\n');
        } else {
            showMsg("âš ï¸ êµì²´í•  ëŒ€ìƒì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    // 4. ì¶”ê°€ ì‹¤í–‰
    function insertBlock() {
        const anchorVal = document.getElementById('addAnchor').value;
        const contentVal = document.getElementById('addContent').value;
        let currentCode = rightArea.value || leftArea.value;
        const result = findLineRange(anchorVal, currentCode);

        if (result) {
             const lines = currentCode.split('\n');
             let newLines = [];
             // ê¸°ì¤€ ì½”ë“œì˜ ë§ˆì§€ë§‰ ì¤„ ì¸ë±ìŠ¤ë¥¼ ì°¾ì•„ì•¼ í•¨
             // result.startëŠ” ì‹œì‘ ì¤„. result.countëŠ” ì¤„ ìˆ˜.
             // í•˜ì§€ë§Œ ì¤‘ê°„ì— ë¹ˆ ì¤„ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì‹¤ì œ ìŠ¤ìº” í•„ìš”.
             
            const searchLines = anchorVal.split('\n').filter(l => l.trim() !== '');
            
            for (let i = 0; i < lines.length; i++) {
                newLines.push(lines[i]); // ì¼ë‹¨ í˜„ì¬ ì¤„ ë„£ê³ 

                if (i === result.start) {
                    // ì—¬ê¸°ê°€ ë§¤ì¹­ ì‹œì‘ì . 
                    // ê¸°ì¤€ ì½”ë“œ ë©ì–´ë¦¬ê°€ ëë‚˜ëŠ” ì§€ì ê¹Œì§€ ë£¨í”„ë¥¼ ë¯¸ë¦¬ ëŒë ¤ë´„?
                    // ì•„ë‹ˆ, ê°„ë‹¨í•˜ê²Œ: "ê¸°ì¤€ ì½”ë“œì˜ ì²« ì¤„"ì„ ì°¾ìœ¼ë©´, ê·¸ ë©ì–´ë¦¬ ë§¨ ë’¤ì— ì¶”ê°€í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼
                    // "ê¸°ì¤€ ì½”ë“œ ë©ì–´ë¦¬" ì „ì²´ë¥¼ ì°¾ì€ ë’¤ ê·¸ ë’¤ì— ì¶”ê°€í•´ì•¼ í•¨.
                    
                    // ë¡œì§ ë‹¨ìˆœí™”: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê¸°ì¤€ ì½”ë“œê°€ ë‹¤ ëë‚˜ëŠ” ì§€ì ì„ ì°¾ìŒ
                    let matchIdx = 1; // ì²« ì¤„ì€ ì´ë¯¸ iì—ì„œ ì°¾ìŒ
                    let scanning = i + 1;
                    
                    // ê¸°ì¤€ ì½”ë“œì˜ ë‚˜ë¨¸ì§€ ì¤„ë“¤ì„ íŒ¨ìŠ¤
                    while(matchIdx < searchLines.length && scanning < lines.length) {
                        if (normalize(lines[scanning]) === normalize(searchLines[matchIdx])) {
                            newLines.push(lines[scanning]); // ê¸°ì¡´ ì½”ë“œ ìœ ì§€
                            matchIdx++;
                        } else {
                             // ë¹ˆ ì¤„ ë“±ì€ ê·¸ëƒ¥ ìœ ì§€
                             newLines.push(lines[scanning]);
                        }
                        scanning++;
                    }
                    
                    // ê¸°ì¤€ ì½”ë“œê°€ ëë‚œ ì§í›„ì— ìƒˆ ì½”ë“œ ì‚½ì…
                    newLines.push(contentVal);
                    
                    i = scanning - 1; // ë©”ì¸ ë£¨í”„ ì¸ë±ìŠ¤ ì í”„
                    showMsg("âœ… ì¶”ê°€ ì™„ë£Œ!");
                }
            }
            rightArea.value = newLines.join('\n');
        } else {
             showMsg("âš ï¸ ê¸°ì¤€ ìœ„ì¹˜ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        }
    }

    function showMsg(text) {
        msgArea.innerText = text;
        setTimeout(() => { msgArea.innerText = ""; }, 5000);
    }
</script>

</body>
</html>
