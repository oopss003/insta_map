<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
  <title>ê°€ê²Œ ë“±ë¡</title>

  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=qpbrmxiff4"></script>

  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

  <style>
  body {
    font-family: 'Pretendard', sans-serif;
    background: #f5f6fb;
    margin: 0 auto;
    padding: 0;
    max-width: 480px;
  }

  #header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    box-sizing: border-box;
  }

  .back-button {
    width: 77px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 28px;
    text-decoration: none;
    color: #000;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }

  .store-button {
    width: 255px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    font-weight: 600;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }

  #header h2 {
    font-size: 18px;
    margin: 0;
  }

  #map {
    width: 344px;
    height: 344px;
    margin: 0 auto 16px;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }

  .btn-group {
    width: 344px;
    margin: 0 auto 16px;
    display: flex;
    justify-content: space-between;
    gap: 8px;
  }

  .main-btn {
    height: 35px;
    border-radius: 16px;
    font-size: 16px;
    font-weight: 600;
    padding: 0 16px;
    border: none;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    flex: 1;
  }

  #getLocBtn {
    background: #0F9ED5;
    color: white;
  }

  #helpVideoBtn {
    background: #999;
    color: white;
  }

  form#storeForm {
    width: 100%;
    max-width: 344px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center; /* ğŸ”¥ ì¤‘ì•™ ì •ë ¬ í•µì‹¬ */
    gap: 12px;
  }

  form#storeForm label {
    font-weight: 700;
    margin-top: 12px;
  }

  input,
  textarea,
  select {
    width: 100%;
    padding: 14px;
    border-radius: 16px;
    border: 1px solid #ddd;
    font-size: 15px;
    background: #fff;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
  }

  textarea {
    resize: none;
  }

  .off-days {
    display: grid;
    grid-template-columns: repeat(4, 77px);
    gap: 12px;
    justify-content: center;
    margin-top: 8px;
    margin-bottom: 20px;
  }

  .off-days label {
    width: 77px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    font-weight: 600;
    font-size: 16px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    position: relative;
    transition: all 0.2s ease
  }

  .off-days input[type="checkbox"] {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 16px;
    height: 16px;
    accent-color: #2d8cff; /* ì„ íƒ ì‹œ ìƒ‰ìƒ ì§€ì • */
    z-index: 1;
  }
    
  #saveBtn {
    width: 100%;
    background: #2d8cff;
    color: #fff;
    margin-top: 24px;
    padding: 16px;
    font-size: 16px;
    border-radius: 16px;
    border: none;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }
  .custom-field-box {
    width: 344px;
    height: 77px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    padding: 8px 12px;
    box-sizing: border-box;
    margin-bottom: 12px; /
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 4px;
  }
  .custom-field-box day {
    width: 344px;
    height: 300px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    padding: 8px 12px;
    box-sizing: border-box;
    margin-bottom: 12px; /
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 4px;
  }

  .custom-field-box label {
    font-size: 13px;
    font-weight: 600;
    color: #333;
    margin: 0;
  }

  .custom-field-box input,
  .custom-field-box textarea,
  .custom-field-box select {
    border: none;
    outline: none;
    font-size: 15px;
    padding: 4px 10;
    background: none;
    resize: none;
    box-sizing: border-box; /* ì´ê±°ë„ ì¶”ê°€ ì¶”ì²œ */
  }

  .custom-field-box select {
    width: 100%;
    height: 36px;
    padding: 4px 8px;
    border: none;
    background: transparent;
    font-size: 15px;
    color: #000;
    appearance: none; /* ê¸°ë³¸ ì…€ë ‰íŠ¸ í™”ì‚´í‘œ ì œê±° */
    -webkit-appearance: none;
    -moz-appearance: none;
  }
  .off-days {
    display: grid;
    grid-template-columns: repeat(4, 77px);
    gap: 12px;
    justify-content: center;
    margin-bottom: 12px;
  }

  .off-days label {
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    width: 77px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    position: relative;
  }

  .off-days input[type="checkbox"] {
    position: absolute;
    top: 8px;
    right: 8px;
    transform: scale(1.2);
  }
    
  .custom-header {
    width: 368px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 16px auto 12px;
    gap: 12px;
  }

  .back-button {
    background: #fff;
    border-radius: 16px;
    width: 77px;
    height: 77px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    flex-shrink: 0;
  }

  .greeting-box {
    width: 255px;
    height: 77px;
    background: #fff;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 0 12px;
    box-sizing: border-box;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    text-align: left;
  }

  .greeting-title {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 4px;
  }

  .greeting-sub {
    font-size: 14px;
    color: #888;
    line-height: 1.4;
  }

  .off-days {
    display: grid;
    grid-template-columns: repeat(4, 77px);
    gap: 12px;
    justify-content: center;
  }

  .day-box {
    display: inline-block;
    width: 77px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    text-align: center;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    position: relative;
    overflow: hidden;
  }

  /* ì²´í¬ë°•ìŠ¤ ìˆ¨ê¸°ê¸° */
  .day-box input[type="checkbox"] {
    display: none;
  }

  /* ì„ íƒëœ ê²½ìš° ìŠ¤íƒ€ì¼ ë³€ê²½ */
  .day-box input[type="checkbox"]:checked + span {
    background-color: #2d8cff;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    width: 100%;
    border-radius: 16px;
  }    

  .custom-button:active {
    transform: scale(0.96);
    transition: transform 0.05s ease-in-out;
  }
  
  .day-hours-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    margin-top: 20px;
  }
  
  .day-row {
    background-color: #fff;
    padding: 20px;
    width: 100%;
    max-width: 500px;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    box-sizing: border-box;
  }
  
  .day-name {
    font-weight: bold;
    font-size: 16px;
    margin-bottom: 12px;
  }
  
  .time-fields {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 16px;
  }
  
  .time-fields label {
    font-size: 13px;
    color: #555;
    margin-top: 4px;
  }
  
  .time-fields select {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
    background-color: #f9f9f9;
  }
  .day-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  
  #copyMonday {
    background-color: #f0f0f0;
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    font-weight: bold;
  } 
    .day-row {
    width: 344px;
    max-width: 100%;
    margin: 0 auto; /* ì¤‘ì•™ ì •ë ¬ ìœ ì§€ */
  }
  
  .dayoff-box {
  width: 344px;
  padding: 16px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  margin-top: 20px;
  margin-bottom: 24px;
  box-sizing: border-box;  /* âœ… ì´ ì¤„ ì¶”ê°€ */
}
  
  .dayoff-controls {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
  }
  
  .dayoff-controls select,
  .dayoff-controls button {
    flex: 1;
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 8px;
    border: 1px solid #ccc;
    background: #fff;
    box-shadow: 0 2px 3px rgba(0,0,0,0.1);
    cursor: pointer;
  }
    
  .dayoff-controls button {
    font-weight: bold;
  }
  
  .dayoff-list {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  
  .dayoff-list li {
    padding: 6px 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 6px;
    font-size: 14px;
    display: flex;
    align-items: center;
  }
    
  .fixed-344 {
    width: 344px;
    max-width: 100%;
    margin: 0 auto;
  }
  
  .input-344 {
    width: 344px;
    max-width: 100%;
    padding: 10px;
    margin-bottom: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  .remove-btn {
    color: red;
    font-weight: bold;
    margin-right: 8px;
    cursor: pointer;
  }
  .custom-marker {
    position: relative;
    transform: translate(-50%, -100%);
    background: #fff;
    color: #222;
    padding: 4px 10px;
    border: 2px solid #fff;
    border-radius: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    font-size: 12px;
    white-space: nowrap;
    cursor: pointer;
  }
  </style>

</head>
<body>
    <div id="loadingOverlay" style="display:none;">
    <div class="spinner"></div>
  </div>
    <div id="header" class="custom-header">
      <a href="https://inwave.ai.kr/mypage.html" class="back-button custom-button" aria-label="ë’¤ë¡œê°€ê¸°">
        <span>&lt;</span>
      </a>
    
      <div class="greeting-box">
        <div class="greeting-title">ë§¤ì¥ ë“±ë¡</div>
        <div class="greeting-sub">í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
      </div>
    </div>

  <div id="map"></div>
  
<div class="btn-group">
  <button type="button" id="getLocBtn" class="main-btn">í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°</button>
  <button type="button" id="helpVideoBtn" class="main-btn">ì°¸ê³  ì˜ìƒ</button>
</div>

  <form id="storeForm">
    <div class="custom-field-box">
      <label for="hashtags">í•´ì‹œíƒœê·¸ (ê³ ê°ì—ê²Œ ë…¸ì¶œë˜ëŠ” ë¬¸êµ¬)</label>
      <input name="hashtags" id="hashtags" placeholder="#ì§ê´€ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆëŠ” ì´ë¦„ìœ¼ë¡œ 5ê¸€ì ë¯¸ë§Œ" />
    </div>
    
    <div class="custom-field-box">
      <label for="name">ê°€ê²Œ ì´ë¦„</label>
      <input name="name" id="name" required />
    </div>

    <div class="custom-field-box">
      <label for="insta_id">ì¸ìŠ¤íƒ€ê·¸ë¨ ID (@ ì œì™¸)</label>
      <input name="insta_id" id="insta_id" required />
    </div>

    <div class="custom-field-box" style="height: auto; min-height: 120px;">
      <label for="desc">ê°€ê²Œ ì„¤ëª…</label>
      <textarea name="desc" id="desc" rows="4"></textarea>
    </div>

    <div class="custom-field-box">
      <label for="phone">ì „í™”ë²ˆí˜¸</label>
      <input name="phone" id="phone" type="tel" placeholder="ì˜ˆ: 010-1234-5678" />
    </div>
    
    <!-- ê°€ê²Œ ì‚¬ì§„ -->
    <div class="custom-field-box" style="height: auto;">
      <label for="photo">ê°€ê²Œ ì‚¬ì§„ (ì„ íƒ) <small style="font-weight:400">(ë©”ì¸ì´ë¯¸ì§€ë¡œ ë“±ë¡ë©ë‹ˆë‹¤.)</small></label>
      <input type="file" id="photo" accept="image/*" />
    </div>

    <!-- Vimeo ë™ì˜ìƒ -->
    <div class="custom-field-box">
      <label for="vimeo">Vimeo ë™ì˜ìƒ</label>
      <input name="vimeo" id="vimeo" type="text" placeholder="ë™ì˜ìƒì€ ê²€ìˆ˜ë¥¼ í†µí•´ ì—…ë¡œë“œ ë©ë‹ˆë‹¤." />
    </div>
  
    <div class="custom-field-box day">
      <label style="font-weight:700; margin-top: 24px;">ìš”ì¼ë³„ ì˜ì—…ì‹œê°„</label>
      <!-- ë‹¤ë¥¸ ìš”ì¼ì— ë³µì‚¬ ë²„íŠ¼ -->
      <button type="button" id="copyMonday">ë‹¤ë¥¸ìš”ì¼ì— ë³µì‚¬</button>
    </div>
      
      <div class="day-hours-wrapper">
        <div class="day-row" data-day="ì›”">
          <div class="day-name">ì›”</div>
          <div class="time-fields">
            <label>ì˜¤í”ˆ ì‹œê°„</label>
            <select name="ì›”_open"></select>
            <label>ë§ˆê° ì‹œê°„</label>
            <select name="ì›”_close"></select>
            <label>ë¸Œë ˆì´í¬ ì‹œì‘</label>
            <select name="ì›”_break_start"></select>
            <label>ë¸Œë ˆì´í¬ ì¢…ë£Œ</label>
            <select name="ì›”_break_end"></select>
            <label>ë¼ìŠ¤íŠ¸ì˜¤ë”</label>
            <select name="ì›”_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="í™”">
          <div class="day-name">í™”</div>
          <div class="time-fields">
            <label>ì˜¤í”ˆ ì‹œê°„</label>
            <select name="í™”_open"></select>
            <label>ë§ˆê° ì‹œê°„</label>
            <select name="í™”_close"></select>
            <label>ë¸Œë ˆì´í¬ ì‹œì‘</label>
            <select name="í™”_break_start"></select>
            <label>ë¸Œë ˆì´í¬ ì¢…ë£Œ</label>
            <select name="í™”_break_end"></select>
            <label>ë¼ìŠ¤íŠ¸ì˜¤ë”</label>
            <select name="í™”_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="ìˆ˜">
          <div class="day-name">ìˆ˜</div>
          <div class="time-fields">
            <label>ì˜¤í”ˆ ì‹œê°„</label>
            <select name="ìˆ˜_open"></select>
            <label>ë§ˆê° ì‹œê°„</label>
            <select name="ìˆ˜_close"></select>
            <label>ë¸Œë ˆì´í¬ ì‹œì‘</label>
            <select name="ìˆ˜_break_start"></select>
            <label>ë¸Œë ˆì´í¬ ì¢…ë£Œ</label>
            <select name="ìˆ˜_break_end"></select>
            <label>ë¼ìŠ¤íŠ¸ì˜¤ë”</label>
            <select name="ìˆ˜_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="ëª©">
          <div class="day-name">ëª©</div>
          <div class="time-fields">
            <label>ì˜¤í”ˆ ì‹œê°„</label>
            <select name="ëª©_open"></select>
            <label>ë§ˆê° ì‹œê°„</label>
            <select name="ëª©_close"></select>
            <label>ë¸Œë ˆì´í¬ ì‹œì‘</label>
            <select name="ëª©_break_start"></select>
            <label>ë¸Œë ˆì´í¬ ì¢…ë£Œ</label>
            <select name="ëª©_break_end"></select>
            <label>ë¼ìŠ¤íŠ¸ì˜¤ë”</label>
            <select name="ëª©_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="ê¸ˆ">
          <div class="day-name">ê¸ˆ</div>
          <div class="time-fields">
            <label>ì˜¤í”ˆ ì‹œê°„</label>
            <select name="ê¸ˆ_open"></select>
            <label>ë§ˆê° ì‹œê°„</label>
            <select name="ê¸ˆ_close"></select>
            <label>ë¸Œë ˆì´í¬ ì‹œì‘</label>
            <select name="ê¸ˆ_break_start"></select>
            <label>ë¸Œë ˆì´í¬ ì¢…ë£Œ</label>
            <select name="ê¸ˆ_break_end"></select>
            <label>ë¼ìŠ¤íŠ¸ì˜¤ë”</label>
            <select name="ê¸ˆ_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="í† ">
          <div class="day-name">í† </div>
          <div class="time-fields">
            <label>ì˜¤í”ˆ ì‹œê°„</label>
            <select name="í† _open"></select>
            <label>ë§ˆê° ì‹œê°„</label>
            <select name="í† _close"></select>
            <label>ë¸Œë ˆì´í¬ ì‹œì‘</label>
            <select name="í† _break_start"></select>
            <label>ë¸Œë ˆì´í¬ ì¢…ë£Œ</label>
            <select name="í† _break_end"></select>
            <label>ë¼ìŠ¤íŠ¸ì˜¤ë”</label>
            <select name="í† _last_order"></select>
          </div>
        </div>
                <div class="day-row" data-day="ì¼">
          <div class="day-name">ì¼</div>
          <div class="time-fields">
            <label>ì˜¤í”ˆ ì‹œê°„</label>
            <select name="ì¼_open"></select>
            <label>ë§ˆê° ì‹œê°„</label>
            <select name="ì¼_close"></select>
            <label>ë¸Œë ˆì´í¬ ì‹œì‘</label>
            <select name="ì¼_break_start"></select>
            <label>ë¸Œë ˆì´í¬ ì¢…ë£Œ</label>
            <select name="ì¼_break_end"></select>
            <label>ë¼ìŠ¤íŠ¸ì˜¤ë”</label>
            <select name="ì¼_last_order"></select>
          </div>
        </div>
      </div>

      <!-- ì‰¬ëŠ”ë‚  ì„¤ì • ì˜ì—­ -->
      <div class="dayoff-box fixed-344">
        <div class="dayoff-controls">
          <select id="daySelect">
            <option value="">ìš”ì¼</option>
            <option value="ì›”">ì›”ìš”ì¼</option>
            <option value="í™”">í™”ìš”ì¼</option>
            <option value="ìˆ˜">ìˆ˜ìš”ì¼</option>
            <option value="ëª©">ëª©ìš”ì¼</option>
            <option value="ê¸ˆ">ê¸ˆìš”ì¼</option>
            <option value="í† ">í† ìš”ì¼</option>
            <option value="ì¼">ì¼ìš”ì¼</option>
          </select>
          <select id="repeatSelect">
            <option value="">ì„ íƒ ì•ˆí•¨</option>
            <option value="ë§¤ì£¼">ë§¤ì£¼</option>
            <option value="1ì£¼ì°¨">1ì£¼ì°¨</option>
            <option value="2ì£¼ì°¨">2ì£¼ì°¨</option>
            <option value="3ì£¼ì°¨">3ì£¼ì°¨</option>
            <option value="4ì£¼ì°¨">4ì£¼ì°¨</option>
            <option value="1,3ì£¼ì°¨">1,3ì£¼ì°¨</option>
            <option value="2,4ì£¼ì°¨">2,4ì£¼ì°¨</option>
            <option value="ë§ˆì§€ë§‰ì£¼">ë§ˆì§€ë§‰ì£¼</option>
          </select>
          <button id="addDayOff" type="button">ì €ì¥</button>
        </div>
      
        <ul id="dayoffList" class="dayoff-list"></ul>
      </div>

    <label>ìœ„ë„</label>
    <input id="lat" readonly required />
    <label>ê²½ë„</label>
    <input id="lng" readonly required />

    <button id="saveBtn" type="button">ì €ì¥</button>

  </form>

  <script>
    // Firebase ì´ˆê¸°í™”ëŠ” í•œ ë²ˆë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.
    const firebaseConfig = {
      apiKey: "AIzaSyCVV1XUfsREQYnah3tbEKBTprgq9wRgiic",
      authDomain: "instamap-9b595.firebaseapp.com",
      projectId: "instamap-9b595",
      storageBucket: "instamap-9b595.firebasestorage.app",
      messagingSenderId: "280950399393",
      appId: "1:280950399393:web:8282e0d352e50c8bcd2be0"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // currentUser ì„ ì–¸ì„ ì „ì—­ ìŠ¤ì½”í”„ì—ì„œ í•œ ë²ˆë§Œ í•©ë‹ˆë‹¤.
    let currentUser = null; // ì´ ì¤„ì„ ê¸°ì¡´ì˜ ì¤‘ë³µ ì„ ì–¸ë“¤ì„ ì œê±°í•˜ê³  í•œ ê³³ì—ë§Œ ë‚¨ê²¨ë‘¡ë‹ˆë‹¤.

    let marker = null;  
    
    const map = new naver.maps.Map('map', {
      center: new naver.maps.LatLng(37.4986526,126.7756436),
      zoom: 15
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì—¬ê¸°ì— ì¶”ê°€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /**
     * text: ë§ˆì»¤ì— í‘œì‹œí•  ë¬¸ìì—´
     */
    function createMarkerIconWithText(text) {
      return {
        content: `<div class="custom-marker">${text}</div>`,
        size: new naver.maps.Size(0, 0),
        anchor: new naver.maps.Point(0, 0)
      };
    }
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì¶”ê°€ ë â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    // 3) ëª¨ë“  ê°€ê²Œ ë°ì´í„° ë¶ˆëŸ¬ì™€ ë§ˆì»¤ í‘œì‹œ
    db.collection('stores').get()
      .then(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();
          const lat = parseFloat(data.lat), lng = parseFloat(data.lng);
          if (isNaN(lat) || isNaN(lng)) return;
  
          // ê¸°ì¡´ new naver.maps.Marker ëŒ€ì‹  iconì— helper ì‚¬ìš©
          const storeMarker = new naver.maps.Marker({
            position: new naver.maps.LatLng(lat, lng),
            map: map,
            icon: createMarkerIconWithText(data.name)  // ì—¬ê¸°ì— ë§¤ì¥ ì´ë¦„(text)ì„ ë„£ì–´ì¤ë‹ˆë‹¤
          });
  
          storeMarker.setCursor('pointer');
          storeMarker.addListener('click', () => {
            // í´ë¦­ëœ ë¬¸ì„œ IDì™€ ë°ì´í„°ë¥¼ loadStoreToFormì— ë„˜ê²¨ì¤Œ
            editingId = doc.id;
            loadStoreToForm({ id: doc.id, data: () => data });
          });
        });
      })
      .catch(err => console.error('ê°€ê²Œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', err));

    function setLatLng(lat, lng) {
      document.getElementById('lat').value = lat;
      document.getElementById('lng').value = lng;
      if (marker) marker.setMap(null);
      marker = new naver.maps.Marker({
        position: new naver.maps.LatLng(lat, lng),
        map: map
      });
    }

    naver.maps.Event.addListener(map, 'click', e => setLatLng(e.coord.lat(), e.coord.lng()));
    document.getElementById('getLocBtn').onclick = () => {
      navigator.geolocation?.getCurrentPosition(pos => {
        const { latitude, longitude } = pos.coords;
        setLatLng(latitude, longitude);
        map.setCenter(new naver.maps.LatLng(latitude, longitude));
        map.setZoom(18);
      }, () => alert('ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.'));
    };

    function compressImage(file, maxBytes = 1000000) {
      return new Promise(resolve => {
        const img = new Image();
        const reader = new FileReader();
        reader.onload = e => {
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const maxW = 500;
            const scale = Math.min(1, maxW / img.width);
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            let quality = 0.8;
            function exportBlob() {
              canvas.toBlob(blob => {
                if (blob.size <= maxBytes || quality < 0.4) {
                  resolve(blob);
                } else {
                  quality -= 0.1;
                  exportBlob();
                }
              }, 'image/jpeg', quality);
            }
            exportBlob();
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    function parseVimeoInput(input) {
      input = input.replace(/<script[\s\S]*?<\/script>/gi, "");
      const iframeMatch = input.match(/<iframe[^>]+src=["']([^"']+)["']/i);
      if (iframeMatch) return iframeMatch[1];
      const embedMatch = input.match(/^(https?:\/\/player\.vimeo\.com\/video\/\d+(?:\?.*)?)/i);
      if (embedMatch) return embedMatch[1];
      const shareMatch = input.match(/^https?:\/\/vimeo\.com\/(\d+)/i);
      if (shareMatch) return `https://player.vimeo.com/video/${shareMatch[1]}`;
      return "";
      }

    function loadStoreToForm(doc) {
      const data = doc.data();

      document.querySelector('[name=name]').value = data.name;
      document.querySelector('[name=insta_id]').value = data.insta;
      document.querySelector('[name=desc]').value = data.desc;
      document.querySelector('[name=phone]').value = data.phone || ""; // âœ… ì¶”ê°€
      document.getElementById('lat').value = data.lat;
      document.getElementById('lng').value = data.lng;
      document.querySelector('[name=vimeo]').value = data.vimeo || "";
      // í•´ì‹œíƒœê·¸ ë¡œë“œ (ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´ë¡œ ë³€í™˜)
      document.querySelector('[name=hashtags]').value = (data.hashtags || []).join(', ');

      // ì˜¤í”ˆ/ë§ˆê° ì‹œê°„, ë¸Œë ˆì´í¬ íƒ€ì„, ì‰¬ëŠ” ë‚  ë¡œë“œ

      // --- ìš”ì¼ë³„ ì…€ë ‰íŠ¸ ë°•ìŠ¤ì— ê°’ ì±„ìš°ê¸° ---
      const days = ['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'];
      days.forEach(day => {
        const h = data.hours?.[day] || { time: {}, break: {}, lastOrder: {} };
        // open / close
        const selOpen  = document.querySelector(`select[name="${day}_open"]`);
        const selClose = document.querySelector(`select[name="${day}_close"]`);
        if (selOpen)  selOpen.value  = h.time.start    || '';
        if (selClose) selClose.value = h.time.end      || '';
        // break start / end
        const selBgn = document.querySelector(`select[name="${day}_break_start"]`);
        const selEnd = document.querySelector(`select[name="${day}_break_end"]`);
        if (selBgn) selBgn.value = h.break.start || '';
        if (selEnd) selEnd.value = h.break.end   || '';
        // last order
        const selLo = document.querySelector(`select[name="${day}_last_order"]`);
        if (selLo) selLo.value = h.lastOrder.time || '';
      });
      
      // ì‰¬ëŠ” ë‚  ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™” ë° ì²´í¬
      document.querySelectorAll('[name="offDays[]"]').forEach(cb => cb.checked = false);
      (data.offDays || []).forEach(day => {
        const checkbox = document.querySelector(`[name="offDays[]"][value="${day}"]`);
        if (checkbox) checkbox.checked = true;
      });

      setLatLng(data.lat, data.lng);
      document.getElementById('saveBtn').textContent = "ìˆ˜ì • ì €ì¥";
    }

    document.getElementById('saveBtn').addEventListener('click', async () => {
      overlay.style.display = 'flex';
      saveBtn.disabled = true;

      try {
        const raw = document.querySelector('[name=hashtags]').value;
        const tags = raw.split(',').map(t => t.trim()).filter(Boolean);
        const invalid = tags.filter(t => Array.from(t).length > 6);
        if (invalid.length) {
          alert(`ë‹¤ìŒ í•´ì‹œíƒœê·¸ëŠ” 6ê¸€ìë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤:\n${invalid.join(', ')}`);
          return;
        }

        const rawInput = document.querySelector('[name=vimeo]').value.trim();
        const vimeoUrl = rawInput ? parseVimeoInput(rawInput) : "";
        if (rawInput && !vimeoUrl) {
          alert('ìœ íš¨í•œ Vimeo ë§í¬ë‚˜ <iframe> ì½”ë“œë¥¼ ë„£ì–´ì£¼ì„¸ìš”.');
          return;
        }

        const openTime = document.querySelector('[name=openTime]').value;
        const closeTime = document.querySelector('[name=closeTime]').value;
        const breakStart = document.querySelector('[name=breakStart]').value;
        const breakEnd = document.querySelector('[name=breakEnd]').value;
        const offDays = Array.from(document.querySelectorAll('[name="offDays[]"]:checked')).map(cb => cb.value);


        // currentUserê°€ nullì¼ ê²½ìš° ë‹¤ì‹œ ë¡œê·¸ì¸ ê²½ê³  ë° ë¦¬í„´
        if (!currentUser) {
          alert('ë¡œê·¸ì¸ í›„ ë“±ë¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
          window.location.href = "/login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¶”ê°€
          return;
        }

        const days = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
        const hours = {};
        days.forEach(day => {
          hours[day] = {
            time: {
              start: document.querySelector(`[name="${day}_open"]`)?.value || "",
              end: document.querySelector(`[name="${day}_close"]`)?.value || ""
            },
            break: {
              start: document.querySelector(`[name="${day}_break_start"]`)?.value || "",
              end: document.querySelector(`[name="${day}_break_end"]`)?.value || ""
            },
            lastOrder: {
              time: document.querySelector(`[name="${day}_last_order"]`)?.value || ""
            }
          };
        });
        const dayOff = offDays.map(day => ({
          day,
          repeat: "ë§¤ì£¼"
        }));
        
        const store = {
          name: document.querySelector('[name=name]').value.trim(),
          insta: document.querySelector('[name=insta_id]').value.trim(),
          desc: document.querySelector('[name=desc]').value.trim(),
          phone: document.querySelector('[name=phone]').value.trim(),
          lat: parseFloat(document.getElementById('lat').value),
          lng: parseFloat(document.getElementById('lng').value),
          photo: "",
          vimeo: vimeoUrl,
          hashtags: tags,
          hours,         // âœ… ìƒˆ êµ¬ì¡° ë°˜ì˜
          dayOff,        // âœ… ì‰¬ëŠ” ë‚  êµ¬ì¡°
          userEmail: currentUser.email,
          created: firebase.firestore.FieldValue.serverTimestamp()
        };

        if (!store.name || !store.insta || isNaN(store.lat) || isNaN(store.lng) || !openTime || !closeTime) {
          alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        const file = document.getElementById('photo').files[0];
        if (file) {
          const blob = await compressImage(file);
          const filename = `store_photos/${Date.now()}_${file.name.replace(/\s+/g, '')}`;
          const ref = storage.ref().child(filename);
          await ref.put(blob);
          store.photo = await ref.getDownloadURL();
        }

        const storeRef = db.collection('stores').doc(currentUser.email);
        if (editingId) {
          // ì‚¬ì§„ì„ ìƒˆë¡œ ì—…ë¡œë“œí•˜ì§€ ì•Šì•˜ë‹¤ë©´ ê¸°ì¡´ photo í•„ë“œ ìœ ì§€
          if (!file) {
             const existingStore = await storeRef.get();
             if (existingStore.exists) {
               store.photo = existingStore.data().photo || "";
             }
          }
          await storeRef.update(store);
          alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
          window.location.href = "/mypage.html";  // âœ… ìˆ˜ì • í›„ ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™
        } else {
          const exists = await storeRef.get();
          if (exists.exists) {
            alert("ì´ë¯¸ ë“±ë¡ëœ ê°€ê²Œì…ë‹ˆë‹¤. ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜ë©ë‹ˆë‹¤.");
            loadStoreToForm({ id: currentUser.email, data: () => exists.data() });
            return;
          }
          await storeRef.set(store);
          alert('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
          window.location.href = "/mypage.html";  // âœ… ì‹ ê·œ ë“±ë¡ í›„ ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™
        }

        // í¼ ì´ˆê¸°í™” ë° ì§€ë„ ë§ˆì»¤ ì œê±°
        document.getElementById('storeForm').reset();
        if (marker) marker.setMap(null);
        editingId = "";
        saveBtn.textContent = "ì €ì¥";

      } catch (err) {
        console.error(err);
        alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      } finally {
        overlay.style.display = 'none';
        saveBtn.disabled = false;
      }
    });
  </script>

  
  <div id="videoModal" class="modal">
  <div class="modal-content">
    <button id="closeVideo">&times;</button>
    <iframe
      id="videoFrame"
      src=""
      frameborder="0"
      allow="autoplay; fullscreen"
      allowfullscreen></iframe>
  </div>
</div>
<script>
/* === ì°¸ê³  ì˜ìƒ ëª¨ë‹¬ === */
const videoModal = document.getElementById('videoModal');
const videoFrame = document.getElementById('videoFrame');
const helpBtn    = document.getElementById('helpVideoBtn');
const closeBtn   = document.getElementById('closeVideo');

helpBtn.addEventListener('click', () => {
  const url = 'https://player.vimeo.com/video/1091824548?h=bfd071815a&autoplay=1&muted=1';
  videoFrame.src = url;
  videoModal.style.display = 'flex';
});

function hideModal() {
  videoFrame.src = '';
  videoModal.style.display = 'none';
}
closeBtn.addEventListener('click', hideModal);
videoModal.addEventListener('click', e => {
  if (e.target === videoModal) hideModal();
});
</script>
<!-- ê¸°ì¡´ ëª¨ë‹¬ ë° ê¸°íƒ€ ìŠ¤í¬ë¦½íŠ¸ ì•„ë˜ì— ì¶”ê°€ -->
<script>
// ğŸ‘‰ ì—¬ê¸° ë¶™ì—¬ë„£ê¸°
const timeOptions = [];
for (let h = 0; h <= 27; h++) {
  const label = h < 10 ? `0${h}:00` : `${h}:00`;
  timeOptions.push(`<option value="${label}">${label}</option>`);
}

['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'].forEach(day => {
  ['open', 'close', 'break_start', 'break_end', 'last_order'].forEach(type => {
    const sel = document.querySelector(`select[name="${day}_${type}"]`);
    if (sel) sel.innerHTML = `<option value="">ì„ íƒ ì•ˆí•¨</option>` + timeOptions.join('');
  });
});
document.getElementById("copyMonday").addEventListener("click", () => {
  const fields = ["open", "close", "break_start", "break_end", "last_order"];
  const days = ["í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† ", "ì¼"];

  fields.forEach(field => {
    const monVal = document.querySelector(`select[name="ì›”_${field}"]`)?.value || "";
    days.forEach(day => {
      const target = document.querySelector(`select[name="${day}_${field}"]`);
      if (target) target.value = monVal;
    });
  });

  alert("ì›”ìš”ì¼ì˜ ì‹œê°„ì´ í™”~ì¼ìš”ì¼ì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
});

const daySelect = document.getElementById("daySelect");
const repeatSelect = document.getElementById("repeatSelect");
const addBtn = document.getElementById("addDayOff");
const list = document.getElementById("dayoffList");

addBtn.addEventListener("click", () => {
  const day = daySelect.value;
  const repeat = repeatSelect.value;

  if (!day || !repeat) {
    alert("ìš”ì¼ê³¼ ë°˜ë³µ ì¡°ê±´ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
    return;
  }

  const key = `${day}-${repeat}`;
  if ([...list.children].some(li => li.dataset.key === key)) {
    alert("ì´ë¯¸ ì¶”ê°€ëœ í•­ëª©ì…ë‹ˆë‹¤.");
    return;
  }

  const li = document.createElement("li");
  li.dataset.key = key;
  li.innerHTML = `
    <span class="remove-btn">âˆ’</span> ${day}ìš”ì¼ ${repeat}
  `;
  li.querySelector(".remove-btn").addEventListener("click", () => li.remove());

  list.appendChild(li);
});

</script>

</body>
</html>
