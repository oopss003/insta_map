<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
  <title>Í∞ÄÍ≤å Îì±Î°ù</title>

  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=qpbrmxiff4"></script>

  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

  <style>
  body {
    font-family: 'Pretendard', sans-serif;
    background: #f5f6fb;
    margin: 0 auto;
    padding: 0;
    max-width: 480px;
  }

  #header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    box-sizing: border-box;
  }

  .back-button {
    width: 77px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 28px;
    text-decoration: none;
    color: #000;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }

  .store-button {
    width: 255px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    font-weight: 600;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }

  #header h2 {
    font-size: 18px;
    margin: 0;
  }

  #map {
    width: 344px;
    height: 344px;
    margin: 0 auto 16px;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }

  .btn-group {
    width: 344px;
    margin: 0 auto 16px;
    display: flex;
    justify-content: space-between;
    gap: 8px;
  }

  .main-btn {
    height: 35px;
    border-radius: 16px;
    font-size: 16px;
    font-weight: 600;
    padding: 0 16px;
    border: none;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    flex: 1;
  }

  #getLocBtn {
    background: #0F9ED5;
    color: white;
  }

  #helpVideoBtn {
    background: #999;
    color: white;
  }

  form#storeForm {
    width: 100%;
    max-width: 344px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center; /* üî• Ï§ëÏïô Ï†ïÎ†¨ ÌïµÏã¨ */
    gap: 12px;
  }

  form#storeForm label {
    font-weight: 700;
    margin-top: 12px;
  }

  input,
  textarea,
  select {
    width: 100%;
    padding: 14px;
    border-radius: 16px;
    border: 1px solid #ddd;
    font-size: 15px;
    background: #fff;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
  }

  textarea {
    resize: none;
  }

  .off-days {
    display: grid;
    grid-template-columns: repeat(4, 77px);
    gap: 12px;
    justify-content: center;
    margin-top: 8px;
    margin-bottom: 20px;
  }

  .off-days label {
    width: 77px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    font-weight: 600;
    font-size: 16px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    position: relative;
    transition: all 0.2s ease
  }

  .off-days input[type="checkbox"] {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 16px;
    height: 16px;
    accent-color: #2d8cff; /* ÏÑ†ÌÉù Ïãú ÏÉâÏÉÅ ÏßÄÏ†ï */
    z-index: 1;
  }
    
  #saveBtn {
    width: 100%;
    background: #2d8cff;
    color: #fff;
    margin-top: 24px;
    padding: 16px;
    font-size: 16px;
    border-radius: 16px;
    border: none;
    cursor: pointer;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }
  .custom-field-box {
    width: 344px;
    height: 77px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    padding: 8px 12px;
    box-sizing: border-box;
    margin-bottom: 12px; /
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 4px;
  }
  .custom-field-box day {
    width: 344px;
    height: 300px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    padding: 8px 12px;
    box-sizing: border-box;
    margin-bottom: 12px; /
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    gap: 4px;
  }

  .custom-field-box label {
    font-size: 13px;
    font-weight: 600;
    color: #333;
    margin: 0;
  }

  .custom-field-box input,
  .custom-field-box textarea,
  .custom-field-box select {
    border: none;
    outline: none;
    font-size: 15px;
    padding: 4px 10;
    background: none;
    resize: none;
    box-sizing: border-box; /* Ïù¥Í±∞ÎèÑ Ï∂îÍ∞Ä Ï∂îÏ≤ú */
  }

  .custom-field-box select {
    width: 100%;
    height: 36px;
    padding: 4px 8px;
    border: none;
    background: transparent;
    font-size: 15px;
    color: #000;
    appearance: none; /* Í∏∞Î≥∏ ÏÖÄÎ†âÌä∏ ÌôîÏÇ¥Ìëú Ï†úÍ±∞ */
    -webkit-appearance: none;
    -moz-appearance: none;
  }
  .off-days {
    display: grid;
    grid-template-columns: repeat(4, 77px);
    gap: 12px;
    justify-content: center;
    margin-bottom: 12px;
  }

  .off-days label {
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    width: 77px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    position: relative;
  }

  .off-days input[type="checkbox"] {
    position: absolute;
    top: 8px;
    right: 8px;
    transform: scale(1.2);
  }
    
  .custom-header {
    width: 368px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 16px auto 12px;
    gap: 12px;
  }

  .back-button {
    background: #fff;
    border-radius: 16px;
    width: 77px;
    height: 77px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    flex-shrink: 0;
  }

  .greeting-box {
    width: 255px;
    height: 77px;
    background: #fff;
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 0 12px;
    box-sizing: border-box;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    text-align: left;
  }

  .greeting-title {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 4px;
  }

  .greeting-sub {
    font-size: 14px;
    color: #888;
    line-height: 1.4;
  }

  .off-days {
    display: grid;
    grid-template-columns: repeat(4, 77px);
    gap: 12px;
    justify-content: center;
  }

  .day-box {
    display: inline-block;
    width: 77px;
    height: 77px;
    border-radius: 16px;
    background: #fff;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    text-align: center;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    position: relative;
    overflow: hidden;
  }

  /* Ï≤¥ÌÅ¨Î∞ïÏä§ Ïà®Í∏∞Í∏∞ */
  .day-box input[type="checkbox"] {
    display: none;
  }

  /* ÏÑ†ÌÉùÎêú Í≤ΩÏö∞ Ïä§ÌÉÄÏùº Î≥ÄÍ≤Ω */
  .day-box input[type="checkbox"]:checked + span {
    background-color: #2d8cff;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    width: 100%;
    border-radius: 16px;
  }    

  .custom-button:active {
    transform: scale(0.96);
    transition: transform 0.05s ease-in-out;
  }
  
  .day-hours-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    margin-top: 20px;
  }
  
  .day-row {
    background-color: #fff;
    padding: 20px;
    width: 100%;
    max-width: 500px;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    box-sizing: border-box;
  }
  
  .day-name {
    font-weight: bold;
    font-size: 16px;
    margin-bottom: 12px;
  }
  
  .time-fields {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px 16px;
  }
  
  .time-fields label {
    font-size: 13px;
    color: #555;
    margin-top: 4px;
  }
  
  .time-fields select {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 14px;
    background-color: #f9f9f9;
  }
  .day-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  
  #copyMonday {
    background-color: #f0f0f0;
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    font-weight: bold;
  } 
    .day-row {
    width: 344px;
    max-width: 100%;
    margin: 0 auto; /* Ï§ëÏïô Ï†ïÎ†¨ Ïú†ÏßÄ */
  }
  
  .dayoff-box {
  width: 344px;
  padding: 16px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  margin-top: 20px;
  margin-bottom: 24px;
  box-sizing: border-box;  /* ‚úÖ Ïù¥ Ï§Ñ Ï∂îÍ∞Ä */
}
  
  .dayoff-controls {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
  }
  
  .dayoff-controls select,
  .dayoff-controls button {
    flex: 1;
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 8px;
    border: 1px solid #ccc;
    background: #fff;
    box-shadow: 0 2px 3px rgba(0,0,0,0.1);
    cursor: pointer;
  }
    
  .dayoff-controls button {
    font-weight: bold;
  }
  
  .dayoff-list {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  
  .dayoff-list li {
    padding: 6px 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 6px;
    font-size: 14px;
    display: flex;
    align-items: center;
  }
    
  .fixed-344 {
    width: 344px;
    max-width: 100%;
    margin: 0 auto;
  }
  
  .input-344 {
    width: 344px;
    max-width: 100%;
    padding: 10px;
    margin-bottom: 16px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  .remove-btn {
    color: red;
    font-weight: bold;
    margin-right: 8px;
    cursor: pointer;
  }
  .custom-marker {
    position: relative;
    transform: translate(-50%, -100%);
    background: #fff;
    color: #222;
    padding: 4px 10px;
    border: 2px solid #fff;
    border-radius: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
    font-size: 12px;
    white-space: nowrap;
    cursor: pointer;
  }
  </style>

</head>
<body>
    <div id="loadingOverlay" style="display:none;">
    <div class="spinner"></div>
  </div>
    <div id="header" class="custom-header">
      <a href="https://inwave.ai.kr/mypage.html" class="back-button custom-button" aria-label="Îí§Î°úÍ∞ÄÍ∏∞">
        <span>&lt;</span>
      </a>
    
      <div class="greeting-box">
        <div class="greeting-title">Îß§Ïû• Îì±Î°ù</div>
        <div class="greeting-sub">ÌïÑÏàò Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</div>
      </div>
    </div>

  <div id="map"></div>
  
<div class="btn-group">
  <button type="button" id="getLocBtn" class="main-btn">ÌòÑÏû¨ ÏúÑÏπò Í∞ÄÏ†∏Ïò§Í∏∞</button>
  <button type="button" id="helpVideoBtn" class="main-btn">Ï∞∏Í≥† ÏòÅÏÉÅ</button>
</div>

  <form id="storeForm">
    <div class="custom-field-box">
      <label for="hashtags">Ìï¥ÏãúÌÉúÍ∑∏ (Í≥†Í∞ùÏóêÍ≤å ÎÖ∏Ï∂úÎêòÎäî Î¨∏Íµ¨)</label>
      <input name="hashtags" id="hashtags" placeholder="#ÏßÅÍ¥ÄÏ†ÅÏúºÎ°ú Î≥º Ïàò ÏûàÎäî Ïù¥Î¶ÑÏúºÎ°ú 5Í∏ÄÏûê ÎØ∏Îßå" />
    </div>
    
    <div class="custom-field-box">
      <label for="name">Í∞ÄÍ≤å Ïù¥Î¶Ñ</label>
      <input name="name" id="name" required />
    </div>

    <div class="custom-field-box">
      <label for="insta_id">Ïù∏Ïä§ÌÉÄÍ∑∏Îû® ID (@ Ï†úÏô∏)</label>
      <input name="insta_id" id="insta_id" required />
    </div>

    <div class="custom-field-box" style="height: auto; min-height: 120px;">
      <label for="desc">Í∞ÄÍ≤å ÏÑ§Î™Ö</label>
      <textarea name="desc" id="desc" rows="4"></textarea>
    </div>

    <div class="custom-field-box">
      <label for="phone">Ï†ÑÌôîÎ≤àÌò∏</label>
      <input name="phone" id="phone" type="tel" placeholder="Ïòà: 010-1234-5678" />
    </div>
    
    <!-- Í∞ÄÍ≤å ÏÇ¨ÏßÑ -->
    <div class="custom-field-box" style="height: auto;">
      <label for="photo">Í∞ÄÍ≤å ÏÇ¨ÏßÑ (ÏÑ†ÌÉù) <small style="font-weight:400">(Î©îÏù∏Ïù¥ÎØ∏ÏßÄÎ°ú Îì±Î°ùÎê©ÎãàÎã§.)</small></label>
      <input type="file" id="photo" accept="image/*" />
    </div>

    <!-- Vimeo ÎèôÏòÅÏÉÅ -->
    <div class="custom-field-box">
      <label for="vimeo">Vimeo ÎèôÏòÅÏÉÅ</label>
      <input name="vimeo" id="vimeo" type="text" placeholder="ÎèôÏòÅÏÉÅÏùÄ Í≤ÄÏàòÎ•º ÌÜµÌï¥ ÏóÖÎ°úÎìú Îê©ÎãàÎã§." />
    </div>
  
    <div class="custom-field-box day">
      <label style="font-weight:700; margin-top: 24px;">ÏöîÏùºÎ≥Ñ ÏòÅÏóÖÏãúÍ∞Ñ</label>
      <!-- Îã§Î•∏ ÏöîÏùºÏóê Î≥µÏÇ¨ Î≤ÑÌäº -->
      <button type="button" id="copyMonday">Îã§Î•∏ÏöîÏùºÏóê Î≥µÏÇ¨</button>
    </div>
      
      <div class="day-hours-wrapper">
        <div class="day-row" data-day="Ïõî">
          <div class="day-name">Ïõî</div>
          <div class="time-fields">
            <label>Ïò§Ìîà ÏãúÍ∞Ñ</label>
            <select name="Ïõî_open"></select>
            <label>ÎßàÍ∞ê ÏãúÍ∞Ñ</label>
            <select name="Ïõî_close"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ ÏãúÏûë</label>
            <select name="Ïõî_break_start"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ Ï¢ÖÎ£å</label>
            <select name="Ïõî_break_end"></select>
            <label>ÎùºÏä§Ìä∏Ïò§Îçî</label>
            <select name="Ïõî_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="Ìôî">
          <div class="day-name">Ìôî</div>
          <div class="time-fields">
            <label>Ïò§Ìîà ÏãúÍ∞Ñ</label>
            <select name="Ìôî_open"></select>
            <label>ÎßàÍ∞ê ÏãúÍ∞Ñ</label>
            <select name="Ìôî_close"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ ÏãúÏûë</label>
            <select name="Ìôî_break_start"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ Ï¢ÖÎ£å</label>
            <select name="Ìôî_break_end"></select>
            <label>ÎùºÏä§Ìä∏Ïò§Îçî</label>
            <select name="Ìôî_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="Ïàò">
          <div class="day-name">Ïàò</div>
          <div class="time-fields">
            <label>Ïò§Ìîà ÏãúÍ∞Ñ</label>
            <select name="Ïàò_open"></select>
            <label>ÎßàÍ∞ê ÏãúÍ∞Ñ</label>
            <select name="Ïàò_close"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ ÏãúÏûë</label>
            <select name="Ïàò_break_start"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ Ï¢ÖÎ£å</label>
            <select name="Ïàò_break_end"></select>
            <label>ÎùºÏä§Ìä∏Ïò§Îçî</label>
            <select name="Ïàò_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="Î™©">
          <div class="day-name">Î™©</div>
          <div class="time-fields">
            <label>Ïò§Ìîà ÏãúÍ∞Ñ</label>
            <select name="Î™©_open"></select>
            <label>ÎßàÍ∞ê ÏãúÍ∞Ñ</label>
            <select name="Î™©_close"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ ÏãúÏûë</label>
            <select name="Î™©_break_start"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ Ï¢ÖÎ£å</label>
            <select name="Î™©_break_end"></select>
            <label>ÎùºÏä§Ìä∏Ïò§Îçî</label>
            <select name="Î™©_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="Í∏à">
          <div class="day-name">Í∏à</div>
          <div class="time-fields">
            <label>Ïò§Ìîà ÏãúÍ∞Ñ</label>
            <select name="Í∏à_open"></select>
            <label>ÎßàÍ∞ê ÏãúÍ∞Ñ</label>
            <select name="Í∏à_close"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ ÏãúÏûë</label>
            <select name="Í∏à_break_start"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ Ï¢ÖÎ£å</label>
            <select name="Í∏à_break_end"></select>
            <label>ÎùºÏä§Ìä∏Ïò§Îçî</label>
            <select name="Í∏à_last_order"></select>
          </div>
        </div>
        <div class="day-row" data-day="ÌÜ†">
          <div class="day-name">ÌÜ†</div>
          <div class="time-fields">
            <label>Ïò§Ìîà ÏãúÍ∞Ñ</label>
            <select name="ÌÜ†_open"></select>
            <label>ÎßàÍ∞ê ÏãúÍ∞Ñ</label>
            <select name="ÌÜ†_close"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ ÏãúÏûë</label>
            <select name="ÌÜ†_break_start"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ Ï¢ÖÎ£å</label>
            <select name="ÌÜ†_break_end"></select>
            <label>ÎùºÏä§Ìä∏Ïò§Îçî</label>
            <select name="ÌÜ†_last_order"></select>
          </div>
        </div>
                <div class="day-row" data-day="Ïùº">
          <div class="day-name">Ïùº</div>
          <div class="time-fields">
            <label>Ïò§Ìîà ÏãúÍ∞Ñ</label>
            <select name="Ïùº_open"></select>
            <label>ÎßàÍ∞ê ÏãúÍ∞Ñ</label>
            <select name="Ïùº_close"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ ÏãúÏûë</label>
            <select name="Ïùº_break_start"></select>
            <label>Î∏åÎ†àÏù¥ÌÅ¨ Ï¢ÖÎ£å</label>
            <select name="Ïùº_break_end"></select>
            <label>ÎùºÏä§Ìä∏Ïò§Îçî</label>
            <select name="Ïùº_last_order"></select>
          </div>
        </div>
      </div>

      <!-- Ïâ¨ÎäîÎÇ† ÏÑ§Ï†ï ÏòÅÏó≠ -->
      <div class="dayoff-box fixed-344">
        <div class="dayoff-controls">
          <select id="daySelect">
            <option value="">ÏöîÏùº</option>
            <option value="Ïõî">ÏõîÏöîÏùº</option>
            <option value="Ìôî">ÌôîÏöîÏùº</option>
            <option value="Ïàò">ÏàòÏöîÏùº</option>
            <option value="Î™©">Î™©ÏöîÏùº</option>
            <option value="Í∏à">Í∏àÏöîÏùº</option>
            <option value="ÌÜ†">ÌÜ†ÏöîÏùº</option>
            <option value="Ïùº">ÏùºÏöîÏùº</option>
          </select>
          <select id="repeatSelect">
            <option value="">ÏÑ†ÌÉù ÏïàÌï®</option>
            <option value="Îß§Ï£º">Îß§Ï£º</option>
            <option value="1Ï£ºÏ∞®">1Ï£ºÏ∞®</option>
            <option value="2Ï£ºÏ∞®">2Ï£ºÏ∞®</option>
            <option value="3Ï£ºÏ∞®">3Ï£ºÏ∞®</option>
            <option value="4Ï£ºÏ∞®">4Ï£ºÏ∞®</option>
            <option value="1,3Ï£ºÏ∞®">1,3Ï£ºÏ∞®</option>
            <option value="2,4Ï£ºÏ∞®">2,4Ï£ºÏ∞®</option>
            <option value="ÎßàÏßÄÎßâÏ£º">ÎßàÏßÄÎßâÏ£º</option>
          </select>
          <button id="addDayOff" type="button">Ï†ÄÏû•</button>
        </div>
      
        <ul id="dayoffList" class="dayoff-list"></ul>
      </div>

    <label>ÏúÑÎèÑ</label>
    <input id="lat" readonly required />
    <label>Í≤ΩÎèÑ</label>
    <input id="lng" readonly required />

    <button id="saveBtn" type="button">Ï†ÄÏû•</button>

  </form>

  <script>
    // Firebase Ï¥àÍ∏∞ÌôîÎäî Ìïú Î≤àÎßå ÏàòÌñâÌï©ÎãàÎã§.
    const firebaseConfig = {
      apiKey: "AIzaSyCVV1XUfsREQYnah3tbEKBTprgq9wRgiic",
      authDomain: "instamap-9b595.firebaseapp.com",
      projectId: "instamap-9b595",
      storageBucket: "instamap-9b595.firebasestorage.app",
      messagingSenderId: "280950399393",
      appId: "1:280950399393:web:8282e0d352e50c8bcd2be0"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // currentUser ÏÑ†Ïñ∏ÏùÑ Ï†ÑÏó≠ Ïä§ÏΩîÌîÑÏóêÏÑú Ìïú Î≤àÎßå Ìï©ÎãàÎã§.
    let currentUser = null; // Ïù¥ Ï§ÑÏùÑ Í∏∞Ï°¥Ïùò Ï§ëÎ≥µ ÏÑ†Ïñ∏Îì§ÏùÑ Ï†úÍ±∞ÌïòÍ≥† Ìïú Í≥≥ÏóêÎßå ÎÇ®Í≤®Îë°ÎãàÎã§.

    let marker = null;  
    
    const map = new naver.maps.Map('map', {
      center: new naver.maps.LatLng(37.4986526,126.7756436),
      zoom: 15
    });

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Ïó¨Í∏∞Ïóê Ï∂îÍ∞Ä ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    /**
     * text: ÎßàÏª§Ïóê ÌëúÏãúÌï† Î¨∏ÏûêÏó¥
     */
    function createMarkerIconWithText(text) {
      return {
        content: `<div class="custom-marker">${text}</div>`,
        size: new naver.maps.Size(0, 0),
        anchor: new naver.maps.Point(0, 0)
      };
    }
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Ï∂îÍ∞Ä ÎÅù ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    
    // 3) Î™®Îì† Í∞ÄÍ≤å Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨ÏôÄ ÎßàÏª§ ÌëúÏãú
    db.collection('stores').get()
      .then(snapshot => {
        snapshot.forEach(doc => {
          const data = doc.data();
          const lat = parseFloat(data.lat), lng = parseFloat(data.lng);
          if (isNaN(lat) || isNaN(lng)) return;
  
          // Í∏∞Ï°¥ new naver.maps.Marker ÎåÄÏã† iconÏóê helper ÏÇ¨Ïö©
          const storeMarker = new naver.maps.Marker({
            position: new naver.maps.LatLng(lat, lng),
            map: map,
            icon: createMarkerIconWithText(data.name)  // Ïó¨Í∏∞Ïóê Îß§Ïû• Ïù¥Î¶Ñ(text)ÏùÑ ÎÑ£Ïñ¥Ï§çÎãàÎã§
          });
  
          storeMarker.setCursor('pointer');
          storeMarker.addListener('click', () => {
            // ÌÅ¥Î¶≠Îêú Î¨∏ÏÑú IDÏôÄ Îç∞Ïù¥ÌÑ∞Î•º loadStoreToFormÏóê ÎÑòÍ≤®Ï§å
            editingId = doc.id;
            loadStoreToForm({ id: doc.id, data: () => data });
          });
        });
      })
      .catch(err => console.error('Í∞ÄÍ≤å Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:', err));

    function setLatLng(lat, lng) {
      document.getElementById('lat').value = lat;
      document.getElementById('lng').value = lng;
      if (marker) marker.setMap(null);
      marker = new naver.maps.Marker({
        position: new naver.maps.LatLng(lat, lng),
        map: map
      });
    }

    naver.maps.Event.addListener(map, 'click', e => setLatLng(e.coord.lat(), e.coord.lng()));
    document.getElementById('getLocBtn').onclick = () => {
      navigator.geolocation?.getCurrentPosition(pos => {
        const { latitude, longitude } = pos.coords;
        setLatLng(latitude, longitude);
        map.setCenter(new naver.maps.LatLng(latitude, longitude));
        map.setZoom(18);
      }, () => alert('ÏúÑÏπò Í∂åÌïúÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.'));
    };

    function compressImage(file, maxBytes = 1000000) {
      return new Promise(resolve => {
        const img = new Image();
        const reader = new FileReader();
        reader.onload = e => {
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const maxW = 500;
            const scale = Math.min(1, maxW / img.width);
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            let quality = 0.8;
            function exportBlob() {
              canvas.toBlob(blob => {
                if (blob.size <= maxBytes || quality < 0.4) {
                  resolve(blob);
                } else {
                  quality -= 0.1;
                  exportBlob();
                }
              }, 'image/jpeg', quality);
            }
            exportBlob();
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    function parseVimeoInput(input) {
      input = input.replace(/<script[\s\S]*?<\/script>/gi, "");
      const iframeMatch = input.match(/<iframe[^>]+src=["']([^"']+)["']/i);
      if (iframeMatch) return iframeMatch[1];
      const embedMatch = input.match(/^(https?:\/\/player\.vimeo\.com\/video\/\d+(?:\?.*)?)/i);
      if (embedMatch) return embedMatch[1];
      const shareMatch = input.match(/^https?:\/\/vimeo\.com\/(\d+)/i);
      if (shareMatch) return `https://player.vimeo.com/video/${shareMatch[1]}`;
      return "";
      }

    function loadStoreToForm(doc) {
      const data = doc.data();

      document.querySelector('[name=name]').value = data.name;
      document.querySelector('[name=insta_id]').value = data.insta;
      document.querySelector('[name=desc]').value = data.desc;
      document.querySelector('[name=phone]').value = data.phone || ""; // ‚úÖ Ï∂îÍ∞Ä
      document.getElementById('lat').value = data.lat;
      document.getElementById('lng').value = data.lng;
      document.querySelector('[name=vimeo]').value = data.vimeo || "";
      // Ìï¥ÏãúÌÉúÍ∑∏ Î°úÎìú (ÏΩ§ÎßàÎ°ú Íµ¨Î∂ÑÎêú Î¨∏ÏûêÏó¥Î°ú Î≥ÄÌôò)
      document.querySelector('[name=hashtags]').value = (data.hashtags || []).join(', ');

      // Ïò§Ìîà/ÎßàÍ∞ê ÏãúÍ∞Ñ, Î∏åÎ†àÏù¥ÌÅ¨ ÌÉÄÏûÑ, Ïâ¨Îäî ÎÇ† Î°úÎìú

      // --- ÏöîÏùºÎ≥Ñ ÏÖÄÎ†âÌä∏ Î∞ïÏä§Ïóê Í∞í Ï±ÑÏö∞Í∏∞ ---
      const days = ['Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†','Ïùº'];
      days.forEach(day => {
        const h = data.hours?.[day] || { time: {}, break: {}, lastOrder: {} };
        // open / close
        const selOpen  = document.querySelector(`select[name="${day}_open"]`);
        const selClose = document.querySelector(`select[name="${day}_close"]`);
        if (selOpen)  selOpen.value  = h.time.start    || '';
        if (selClose) selClose.value = h.time.end      || '';
        // break start / end
        const selBgn = document.querySelector(`select[name="${day}_break_start"]`);
        const selEnd = document.querySelector(`select[name="${day}_break_end"]`);
        if (selBgn) selBgn.value = h.break.start || '';
        if (selEnd) selEnd.value = h.break.end   || '';
        // last order
        const selLo = document.querySelector(`select[name="${day}_last_order"]`);
        if (selLo) selLo.value = h.lastOrder.time || '';
      });
      
      // Ïâ¨Îäî ÎÇ† Ï≤¥ÌÅ¨Î∞ïÏä§ Ï¥àÍ∏∞Ìôî Î∞è Ï≤¥ÌÅ¨
      document.querySelectorAll('[name="offDays[]"]').forEach(cb => cb.checked = false);
      (data.offDays || []).forEach(day => {
        const checkbox = document.querySelector(`[name="offDays[]"][value="${day}"]`);
        if (checkbox) checkbox.checked = true;
      });

      setLatLng(data.lat, data.lng);
      document.getElementById('saveBtn').textContent = "ÏàòÏ†ï Ï†ÄÏû•";
    }

    document.getElementById('saveBtn').addEventListener('click', async () => {
      overlay.style.display = 'flex';
      saveBtn.disabled = true;

      try {
        const raw = document.querySelector('[name=hashtags]').value;
        const tags = raw.split(',').map(t => t.trim()).filter(Boolean);
        const invalid = tags.filter(t => Array.from(t).length > 6);
        if (invalid.length) {
          alert(`Îã§Ïùå Ìï¥ÏãúÌÉúÍ∑∏Îäî 6Í∏ÄÏûêÎ•º Ï¥àÍ≥ºÌï©ÎãàÎã§:\n${invalid.join(', ')}`);
          return;
        }

        const rawInput = document.querySelector('[name=vimeo]').value.trim();
        const vimeoUrl = rawInput ? parseVimeoInput(rawInput) : "";
        if (rawInput && !vimeoUrl) {
          alert('Ïú†Ìö®Ìïú Vimeo ÎßÅÌÅ¨ÎÇò <iframe> ÏΩîÎìúÎ•º ÎÑ£Ïñ¥Ï£ºÏÑ∏Ïöî.');
          return;
        }

        const openTime = document.querySelector('[name=openTime]').value;
        const closeTime = document.querySelector('[name=closeTime]').value;
        const breakStart = document.querySelector('[name=breakStart]').value;
        const breakEnd = document.querySelector('[name=breakEnd]').value;
        const offDays = Array.from(document.querySelectorAll('[name="offDays[]"]:checked')).map(cb => cb.value);


        // currentUserÍ∞Ä nullÏùº Í≤ΩÏö∞ Îã§Ïãú Î°úÍ∑∏Ïù∏ Í≤ΩÍ≥† Î∞è Î¶¨ÌÑ¥
        if (!currentUser) {
          alert('Î°úÍ∑∏Ïù∏ ÌõÑ Îì±Î°ùÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.');
          window.location.href = "/login.html"; // Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Î¶¨Îã§Ïù¥Î†âÌä∏ Ï∂îÍ∞Ä
          return;
        }

        const days = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'];
        const hours = {};
        days.forEach(day => {
          hours[day] = {
            time: {
              start: document.querySelector(`[name="${day}_open"]`)?.value || "",
              end: document.querySelector(`[name="${day}_close"]`)?.value || ""
            },
            break: {
              start: document.querySelector(`[name="${day}_break_start"]`)?.value || "",
              end: document.querySelector(`[name="${day}_break_end"]`)?.value || ""
            },
            lastOrder: {
              time: document.querySelector(`[name="${day}_last_order"]`)?.value || ""
            }
          };
        });
        const dayOff = offDays.map(day => ({
          day,
          repeat: "Îß§Ï£º"
        }));
        
        const store = {
          name: document.querySelector('[name=name]').value.trim(),
          insta: document.querySelector('[name=insta_id]').value.trim(),
          desc: document.querySelector('[name=desc]').value.trim(),
          phone: document.querySelector('[name=phone]').value.trim(),
          lat: parseFloat(document.getElementById('lat').value),
          lng: parseFloat(document.getElementById('lng').value),
          photo: "",
          vimeo: vimeoUrl,
          hashtags: tags,
          hours,         // ‚úÖ ÏÉà Íµ¨Ï°∞ Î∞òÏòÅ
          dayOff,        // ‚úÖ Ïâ¨Îäî ÎÇ† Íµ¨Ï°∞
          userEmail: currentUser.email,
          created: firebase.firestore.FieldValue.serverTimestamp()
        };

        if (!store.name || !store.insta || isNaN(store.lat) || isNaN(store.lng) || !openTime || !closeTime) {
          alert('ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
          return;
        }

        const file = document.getElementById('photo').files[0];
        if (file) {
          const blob = await compressImage(file);
          const filename = `store_photos/${Date.now()}_${file.name.replace(/\s+/g, '')}`;
          const ref = storage.ref().child(filename);
          await ref.put(blob);
          store.photo = await ref.getDownloadURL();
        }

        const storeRef = db.collection('stores').doc(currentUser.email);
        if (editingId) {
          // ÏÇ¨ÏßÑÏùÑ ÏÉàÎ°ú ÏóÖÎ°úÎìúÌïòÏßÄ ÏïäÏïòÎã§Î©¥ Í∏∞Ï°¥ photo ÌïÑÎìú Ïú†ÏßÄ
          if (!file) {
             const existingStore = await storeRef.get();
             if (existingStore.exists) {
               store.photo = existingStore.data().photo || "";
             }
          }
          await storeRef.update(store);
          alert('ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§!');
          window.location.href = "/mypage.html";  // ‚úÖ ÏàòÏ†ï ÌõÑ ÎßàÏù¥ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        } else {
          const exists = await storeRef.get();
          if (exists.exists) {
            alert("Ïù¥ÎØ∏ Îì±Î°ùÎêú Í∞ÄÍ≤åÏûÖÎãàÎã§. ÏàòÏ†ï Î™®ÎìúÎ°ú Ï†ÑÌôòÎê©ÎãàÎã§.");
            loadStoreToForm({ id: currentUser.email, data: () => exists.data() });
            return;
          }
          await storeRef.set(store);
          alert('Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!');
          window.location.href = "/mypage.html";  // ‚úÖ Ïã†Í∑ú Îì±Î°ù ÌõÑ ÎßàÏù¥ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
        }

        // Ìèº Ï¥àÍ∏∞Ìôî Î∞è ÏßÄÎèÑ ÎßàÏª§ Ï†úÍ±∞
        document.getElementById('storeForm').reset();
        if (marker) marker.setMap(null);
        editingId = "";
        saveBtn.textContent = "Ï†ÄÏû•";

      } catch (err) {
        console.error(err);
        alert('Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
      } finally {
        overlay.style.display = 'none';
        saveBtn.disabled = false;
      }
    });
  </script>

  
  <div id="videoModal" class="modal">
  <div class="modal-content">
    <button id="closeVideo">&times;</button>
    <iframe
      id="videoFrame"
      src=""
      frameborder="0"
      allow="autoplay; fullscreen"
      allowfullscreen></iframe>
  </div>
</div>
<script>
/* === Ï∞∏Í≥† ÏòÅÏÉÅ Î™®Îã¨ === */
const videoModal = document.getElementById('videoModal');
const videoFrame = document.getElementById('videoFrame');
const helpBtn    = document.getElementById('helpVideoBtn');
const closeBtn   = document.getElementById('closeVideo');

helpBtn.addEventListener('click', () => {
  const url = 'https://player.vimeo.com/video/1091824548?h=bfd071815a&autoplay=1&muted=1';
  videoFrame.src = url;
  videoModal.style.display = 'flex';
});

function hideModal() {
  videoFrame.src = '';
  videoModal.style.display = 'none';
}
closeBtn.addEventListener('click', hideModal);
videoModal.addEventListener('click', e => {
  if (e.target === videoModal) hideModal();
});
</script>
<!-- Í∏∞Ï°¥ Î™®Îã¨ Î∞è Í∏∞ÌÉÄ Ïä§ÌÅ¨Î¶ΩÌä∏ ÏïÑÎûòÏóê Ï∂îÍ∞Ä -->
<script>
// üëâ Ïó¨Í∏∞ Î∂ôÏó¨ÎÑ£Í∏∞
const timeOptions = [];
for (let h = 0; h <= 27; h++) {
  const label = h < 10 ? `0${h}:00` : `${h}:00`;
  timeOptions.push(`<option value="${label}">${label}</option>`);
}

['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†', 'Ïùº'].forEach(day => {
  ['open', 'close', 'break_start', 'break_end', 'last_order'].forEach(type => {
    const sel = document.querySelector(`select[name="${day}_${type}"]`);
    if (sel) sel.innerHTML = `<option value="">ÏÑ†ÌÉù ÏïàÌï®</option>` + timeOptions.join('');
  });
});
document.getElementById("copyMonday").addEventListener("click", () => {
  const fields = ["open", "close", "break_start", "break_end", "last_order"];
  const days = ["Ìôî", "Ïàò", "Î™©", "Í∏à", "ÌÜ†", "Ïùº"];

  fields.forEach(field => {
    const monVal = document.querySelector(`select[name="Ïõî_${field}"]`)?.value || "";
    days.forEach(day => {
      const target = document.querySelector(`select[name="${day}_${field}"]`);
      if (target) target.value = monVal;
    });
  });

  alert("ÏõîÏöîÏùºÏùò ÏãúÍ∞ÑÏù¥ Ìôî~ÏùºÏöîÏùºÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§.");
});

const daySelect = document.getElementById("daySelect");
const repeatSelect = document.getElementById("repeatSelect");
const addBtn = document.getElementById("addDayOff");
const list = document.getElementById("dayoffList");

addBtn.addEventListener("click", () => {
  const day = daySelect.value;
  const repeat = repeatSelect.value;

  if (!day || !repeat) {
    alert("ÏöîÏùºÍ≥º Î∞òÎ≥µ Ï°∞Í±¥ÏùÑ Î™®Îëê ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
    return;
  }

  const key = `${day}-${repeat}`;
  if ([...list.children].some(li => li.dataset.key === key)) {
    alert("Ïù¥ÎØ∏ Ï∂îÍ∞ÄÎêú Ìï≠Î™©ÏûÖÎãàÎã§.");
    return;
  }

  const li = document.createElement("li");
  li.dataset.key = key;
  li.innerHTML = `
    <span class="remove-btn">‚àí</span> ${day}ÏöîÏùº ${repeat}
  `;
  li.querySelector(".remove-btn").addEventListener("click", () => li.remove());

  list.appendChild(li);
});

</script>

</body>
</html>
