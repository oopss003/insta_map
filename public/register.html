<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
  <title>ê°€ê²Œ ë“±ë¡</title>

  <!-- 1. Kakao SDK ë¶ˆëŸ¬ì˜¤ê¸° ë° ì´ˆê¸°í™” -->
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script> <!-- 1-1) ì¹´ì¹´ì˜¤ JavaScript SDK ë¡œë“œ -->
  <script>
    Kakao.init('4e1dd9cccad37f9748bb3a3254b88491'); /* 1-2) ì¹´ì¹´ì˜¤ ì•± í‚¤ë¡œ SDK ì´ˆê¸°í™” */
    console.log('Kakao SDK Initialized:', Kakao.isInitialized()); /* 1-3) ì´ˆê¸°í™” ì—¬ë¶€ ì½˜ì†” ì¶œë ¥ */
  </script>

  <!-- 2. Naver Maps SDK ë¡œë“œ -->
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=qpbrmxiff4"></script> <!-- 2-1) ë„¤ì´ë²„ ì§€ë„ API ì‚¬ìš©ì„ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ í¬í•¨ -->

  <!-- 3. Firebase SDK ë¡œë“œ (Firestore, Storage) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>         <!-- 3-1) Firebase ì•± ì´ˆê¸°í™”ìš© SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>   <!-- 3-2) Firestore ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ìš© SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>     <!-- 3-3) Storage(ì´ë¯¸ì§€ ì €ì¥) ì‚¬ìš©ìš© SDK -->

  <style>
    /* 4. ê³µí†µ ìŠ¤íƒ€ì¼ ì •ì˜
       4-1) body: ê¸°ë³¸ í°íŠ¸, ìµœëŒ€ ë„ˆë¹„, ì¤‘ì•™ ì •ë ¬, íŒ¨ë”©
       4-2) #map: ì§€ë„ ì˜ì—­ í¬ê¸°, í…Œë‘ë¦¬, ë‘¥ê·¼ ëª¨ì„œë¦¬, ë§ˆì§„
       4-3) label, input, textarea, select: í¼ ìš”ì†Œ ìŠ¤íƒ€ì¼
    */                         /* â† ì—¬ê¸°ì— ë‹«ëŠ” ì£¼ì„ ì¶”ê°€ */
    input,textarea,select{
    box-sizing: border-box;  /* â† ì´ ì¤„ ì¶”ê°€ */
      width:100%;
      padding:8px;
      margin-top:4px;
      border:1px solid #bbb;
      border-radius:4px;
      font-size:14px;
     }
    /* 
       4-4) button: ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼
       4-5) #getLocBtn, #saveBtn: ë²„íŠ¼ë³„ ë°°ê²½ìƒ‰ ì§€ì •
       4-6) #header, #authButtons: í—¤ë” ì˜ì—­ ì •ë ¬ ë° ë²„íŠ¼ ìŠ¤íƒ€ì¼
    */
    body{font-family:sans-serif;max-width:640px;margin:24px auto;padding:0 12px} /* 4-1 */
    #map{width:100%;height:320px;border:1px solid #ccc;border-radius:6px;margin-bottom:16px} /* 4-2 */
    label{display:block;margin-top:12px;font-weight:700} /* 4-3 */
    input,textarea,select{width:100%;padding:8px;margin-top:4px;border:1px solid #bbb;border-radius:4px;font-size:14px} /* 4-3 */
      .off-days {
        display: flex;
        align-items: center;
        gap: 16px;
        flex-wrap: wrap;
      }
      .off-days label {
        display: flex;
        align-items: center;
        gap: 4px;
        font-weight: 500;
      }
      .off-days input[type="checkbox"] {
        width: 16px;
        height: 16px;
      }

    button{margin-top:14px;padding:10px 18px;font-size:15px;border:none;border-radius:4px;cursor:pointer} /* 4-4 */
    #getLocBtn{background:#28a745;color:#fff} /* 4-5 */
    #saveBtn{background:#2d8cff;color:#fff}  /* 4-5 */
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4-6) í—¤ë” ì˜ì—­ & ë²„íŠ¼ ìŠ¤íƒ€ì¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* margin-bottom:12px;  â† í•„ìš” ì—†ìœ¼ë©´ ì§€ì›Œë„ ë©ë‹ˆë‹¤ */
      height: 60px;            /* í—¤ë” ë†’ì´ ê³ ì • */
      padding: 0 12px;         /* ì¢Œìš° ì—¬ë°± */
      box-sizing: border-box;  /* padding í¬í•¨í•˜ì—¬ ê³„ì‚° */
    }

    /* ì œëª© ê°€ìš´ë° ì •ë ¬ */
    #header h2 {
      margin: 0;
      line-height: 60px;       /* #header ë†’ì´ì™€ ì¼ì¹˜ */
      font-size: 1.25rem;
    }

    /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ë„ í—¤ë” ë†’ì´ì— ë§ì¶°ì„œ */
    .back-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 100%;          /* í—¤ë” ë†’ì´(60px)ë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¦„ */
      padding: 0 8px;        /* í´ë¦­ ì˜ì—­ í™•ë³´ */
  
      font-size: 32px;       /* í™”ì‚´í‘œ í¬ê¸° */
      line-height: 1;        /* í…ìŠ¤íŠ¸ê°€ ë„˜ì¹˜ì§€ ì•Šë„ë¡ */
      color: var(--text);
      text-decoration: none;
      margin-right: 8px;
    }

    /* ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ ë†’ì´ ê³ ì • */
    #authButtons button {
      background: #FEE500;
      border: none;
      border-radius: 8px;
      height: 36px;            /* ë²„íŠ¼ ë†’ì´ ê³ ì • */
      line-height: 36px;       /* í…ìŠ¤íŠ¸ ìˆ˜ì§ ì¤‘ì•™ */
      padding: 0 12px;         /* ì¢Œìš° íŒ¨ë”© */
      margin-left: 6px;
      cursor: pointer;
      font-weight: bold;
      display: flex;
      align-items: center;
    }

    /* ë²„íŠ¼ ì•„ì´ì½˜ ìˆ˜ì§ ì¤‘ì•™ */
    #authButtons button img {
      height: 20px;
      margin-right: 6px;
      vertical-align: middle;
    }

    #kakaoLogoutBtn {
      background: #ddd;
    }

  </style>
</head>
<body>
  <!-- 5. í—¤ë” ì˜ì—­ (ì œëª© + ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼) -->
  <div id="header">
    <!-- ë’¤ë¡œê°€ê¸° í™”ì‚´í‘œ -->
    <a href="https://inwave.ai.kr/view_stores.html" class="back-button" aria-label="ë’¤ë¡œê°€ê¸°">&lt;</a>
    <h2>ğŸ“ ê°€ê²Œ ë“±ë¡</h2> <!-- 5-1) í˜ì´ì§€ ì œëª© -->
    <div id="authButtons">
      <button id="kakaoLoginBtn"> <!-- 5-2-1) ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ -->
        <img src="https://raw.githubusercontent.com/oopss003/insta_map/main/public/image/kakao_login.png" alt="ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸">
        <span>ì¹´ì¹´ì˜¤ë¡œ ë¡œê·¸ì¸</span>
      </button>
      <button id="kakaoLogoutBtn" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button> <!-- 5-2-2) ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ (ì´ˆê¸°ì—” ìˆ¨ê¹€) -->
    </div>
  </div>

  <!-- 6. ì§€ë„ ì˜ì—­ ë° í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ -->
  <div id="map"></div> <!-- 6-1) ë„¤ì´ë²„ ì§€ë„ê°€ ë Œë”ë§ë  ì˜ì—­ -->
  <button id="getLocBtn">í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°</button> <!-- 6-2) í´ë¦­ ì‹œ Geolocation APIë¡œ í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° -->

    <!-- 8. ë“±ë¡/ìˆ˜ì • í¼ (í•œ ë²ˆë§Œ ì“°ê¸°) -->
    <label>ê°€ê²Œ ì´ë¦„</label> <!-- 8-1) ê°€ê²Œ ì´ë¦„ ë¼ë²¨ -->
    <input name="name" required /> <!-- 8-2) ê°€ê²Œ ì´ë¦„ ì…ë ¥ í•„ë“œ -->

    <label>ì¸ìŠ¤íƒ€ê·¸ë¨ ID (@ ì œì™¸)</label> <!-- 8-3) ì¸ìŠ¤íƒ€ê·¸ë¨ ID ë¼ë²¨ -->
    <input name="insta_id" required /> <!-- 8-4) ì¸ìŠ¤íƒ€ê·¸ë¨ ID ì…ë ¥ í•„ë“œ -->

    <label>ê°€ê²Œ ì„¤ëª…</label> <!-- 8-5) ê°€ê²Œ ì„¤ëª… ë¼ë²¨ -->
    <textarea name="desc" rows="4"></textarea> <!-- 8-6) ê°€ê²Œ ì„¤ëª… ì…ë ¥ í•„ë“œ -->

    <label>ê°€ê²Œ ì‚¬ì§„ (ì„ íƒ) <small style="font-weight:400">(ìë™ìœ¼ë¡œ 1 MB ë¯¸ë§Œìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤)</small></label> <!-- 8-7) ì‚¬ì§„ ì—…ë¡œë“œ ë¼ë²¨ -->
    <input type="file" id="photo" accept="image/*" /> <!-- 8-8) ì‚¬ì§„ ì„ íƒ í•„ë“œ -->

    <label>Vimeo ë™ì˜ìƒ ë§í¬ (ì„ íƒ, iframe ì½”ë“œ ê°€ëŠ¥)</label> <!-- 8-9) Vimeo ë§í¬ ë¼ë²¨ -->
    <input name="vimeo" type="text"
           placeholder="ë™ì˜ìƒì€ ê²€ìˆ˜ë¥¼ í†µí•´ ì—…ë¡œë“œ ë©ë‹ˆë‹¤. ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì „ì†¡í•´ì£¼ì‹œë©´ ê²€ìˆ˜í›„ ì—…ë¡œë“œ ì§„í–‰í•©ë‹ˆë‹¤." /> <!-- 8-10) Vimeo ì…ë ¥ í•„ë“œ -->
    <label>í•´ì‹œíƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>             <!-- ì£¼ì„ 8-11) í•´ì‹œíƒœê·¸ ë¼ë²¨ -->
    <input name="hashtags" placeholder="#ìŒì‹, #ì¹´í˜ ë“± ì§ê´€ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆëŠ” ì´ë¦„ìœ¼ë¡œ 5ê¸€ì ë¯¸ë§Œë§Œ" />
    <!-- ì˜¤í”ˆ/ë§ˆê° ì‹œê°„ ì…ë ¥ í•„ë“œ ì‹œì‘ -->
    <label>ì˜¤í”ˆ ì‹œê°„ (24ì‹œê°„ ê¸°ì¤€, 30ë¶„ ë‹¨ìœ„)</label>      <!-- ì£¼ì„ 8-12) ì˜¤í”ˆ ì‹œê°„ ë¼ë²¨ -->
    <select name="openTime">                               <!-- ì£¼ì„ 8-13) ì˜¤í”ˆ ì‹œê°„ ì…€ë ‰íŠ¸ -->
      <option value="0:00">0:00</option>
      <option value="0:30">0:30</option>
      <option value="1:00">1:00</option>
      <option value="1:30">1:30</option>
      <option value="2:00">2:00</option>
      <option value="2:30">2:30</option>
      <option value="3:00">3:00</option>
      <option value="3:30">3:30</option>
      <option value="4:00">4:00</option>
      <option value="4:30">4:30</option>
      <option value="5:00">5:00</option>
      <option value="5:30">5:30</option>
      <option value="6:00">6:00</option>
      <option value="6:30">6:30</option>
      <option value="7:00">7:00</option>
      <option value="7:30">7:30</option>
      <option value="8:00">8:00</option>
      <option value="8:30">8:30</option>
      <option value="9:00">9:00</option>
      <option value="9:30">9:30</option>
      <option value="10:00">10:00</option>
      <option value="10:30">10:30</option>
      <option value="11:00">11:00</option>
      <option value="11:30">11:30</option>
      <option value="12:00">12:00</option>
      <option value="12:30">12:30</option>
      <option value="13:00">13:00</option>
      <option value="13:30">13:30</option>
      <option value="14:00">14:00</option>
      <option value="14:30">14:30</option>
      <option value="15:00">15:00</option>
      <option value="15:30">15:30</option>
      <option value="16:00">16:00</option>
      <option value="16:30">16:30</option>
      <option value="17:00">17:00</option>
      <option value="17:30">17:30</option>
      <option value="18:00">18:00</option>
      <option value="18:30">18:30</option>
      <option value="19:00">19:00</option>
      <option value="19:30">19:30</option>
      <option value="20:00">20:00</option>
      <option value="20:30">20:30</option>
      <option value="21:00">21:00</option>
      <option value="21:30">21:30</option>
      <option value="22:00">22:00</option>
      <option value="22:30">22:30</option>
      <option value="23:00">23:00</option>
      <option value="23:30">23:30</option>
    </select>

    <label>ë§ˆê° ì‹œê°„ (24ì‹œê°„ ê¸°ì¤€, 30ë¶„ ë‹¨ìœ„)</label>      <!-- ì£¼ì„ 8-14) ë§ˆê° ì‹œê°„ ë¼ë²¨ -->
    <select name="closeTime">                              <!-- ì£¼ì„ 8-15) ë§ˆê° ì‹œê°„ ì…€ë ‰íŠ¸ -->
      <option value="0:00">0:00</option>
      <option value="0:30">0:30</option>
      <option value="1:00">1:00</option>
      <option value="1:30">1:30</option>
      <option value="2:00">2:00</option>
      <option value="2:30">2:30</option>
      <option value="3:00">3:00</option>
      <option value="3:30">3:30</option>
      <option value="4:00">4:00</option>
      <option value="4:30">4:30</option>
      <option value="5:00">5:00</option>
      <option value="5:30">5:30</option>
      <option value="6:00">6:00</option>
      <option value="6:30">6:30</option>
      <option value="7:00">7:00</option>
      <option value="7:30">7:30</option>
      <option value="8:00">8:00</option>
      <option value="8:30">8:30</option>
      <option value="9:00">9:00</option>
      <option value="9:30">9:30</option>
      <option value="10:00">10:00</option>
      <option value="10:30">10:30</option>
      <option value="11:00">11:00</option>
      <option value="11:30">11:30</option>
      <option value="12:00">12:00</option>
      <option value="12:30">12:30</option>
      <option value="13:00">13:00</option>
      <option value="13:30">13:30</option>
      <option value="14:00">14:00</option>
      <option value="14:30">14:30</option>
      <option value="15:00">15:00</option>
      <option value="15:30">15:30</option>
      <option value="16:00">16:00</option>
      <option value="16:30">16:30</option>
      <option value="17:00">17:00</option>
      <option value="17:30">17:30</option>
      <option value="18:00">18:00</option>
      <option value="18:30">18:30</option>
      <option value="19:00">19:00</option>
      <option value="19:30">19:30</option>
      <option value="20:00">20:00</option>
      <option value="20:30">20:30</option>
      <option value="21:00">21:00</option>
      <option value="21:30">21:30</option>
      <option value="22:00">22:00</option>
      <option value="22:30">22:30</option>
      <option value="23:00">23:00</option>
      <option value="23:30">23:30</option>
    </select>

      <!-- 1) ì‰¬ëŠ” ë‚  ì²´í¬ë°•ìŠ¤ -->
    <label>ì‰¬ëŠ” ë‚ </label>
    <div class="off-days">
      <label><input type="checkbox" name="offDays[]" value="ì›”"> ì›”ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="í™”"> í™”ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="ìˆ˜"> ìˆ˜ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="ëª©"> ëª©ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="ê¸ˆ"> ê¸ˆìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="í† "> í† ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="ì¼"> ì¼ìš”ì¼</label>
    </div>

    <!-- 2) ë¸Œë ˆì´í¬ íƒ€ì„ -->
    <label>ë¸Œë ˆì´í¬ íƒ€ì„ ì‹œì‘ (24ì‹œê°„ ê¸°ì¤€, 30ë¶„ ë‹¨ìœ„)</label>
    <select name="breakStart">
      <option value="">ì„ íƒ ì•ˆí•¨</option>
      <option value="00:00">00:00</option>
      <option value="0:30">0:30</option>
      <option value="1:00">1:00</option>
      <option value="1:30">1:30</option>
      <option value="2:00">2:00</option>
      <option value="2:30">2:30</option>
      <option value="3:00">3:00</option>
      <option value="3:30">3:30</option>
      <option value="4:00">4:00</option>
      <option value="4:30">4:30</option>
      <option value="5:00">5:00</option>
      <option value="5:30">5:30</option>
      <option value="6:00">6:00</option>
      <option value="6:30">6:30</option>
      <option value="7:00">7:00</option>
      <option value="7:30">7:30</option>
      <option value="8:00">8:00</option>
      <option value="8:30">8:30</option>
      <option value="9:00">9:00</option>
      <option value="9:30">9:30</option>
      <option value="10:00">10:00</option>
      <option value="10:30">10:30</option>
      <option value="11:00">11:00</option>
      <option value="11:30">11:30</option>
      <option value="12:00">12:00</option>
      <option value="12:30">12:30</option>
      <option value="13:00">13:00</option>
      <option value="13:30">13:30</option>
      <option value="14:00">14:00</option>
      <option value="14:30">14:30</option>
      <option value="15:00">15:00</option>
      <option value="15:30">15:30</option>
      <option value="16:00">16:00</option>
      <option value="16:30">16:30</option>
      <option value="17:00">17:00</option>
      <option value="17:30">17:30</option>
      <option value="18:00">18:00</option>
      <option value="18:30">18:30</option>
      <option value="19:00">19:00</option>
      <option value="19:30">19:30</option>
      <option value="20:00">20:00</option>
      <option value="20:30">20:30</option>
      <option value="21:00">21:00</option>
      <option value="21:30">21:30</option>
      <option value="22:00">22:00</option>
      <option value="22:30">22:30</option>
      <option value="23:00">23:00</option>
      <option value="23:30">23:30</option>
    </select>

    <label>ë¸Œë ˆì´í¬ íƒ€ì„ ì¢…ë£Œ (24ì‹œê°„ ê¸°ì¤€, 30ë¶„ ë‹¨ìœ„)</label>
    <select name="breakEnd">
      <option value="">ì„ íƒ ì•ˆí•¨</option>
      <option value="00:00">00:00</option>
      <option value="0:30">0:30</option>
      <option value="1:00">1:00</option>
      <option value="1:30">1:30</option>
      <option value="2:00">2:00</option>
      <option value="2:30">2:30</option>
      <option value="3:00">3:00</option>
      <option value="3:30">3:30</option>
      <option value="4:00">4:00</option>
      <option value="4:30">4:30</option>
      <option value="5:00">5:00</option>
      <option value="5:30">5:30</option>
      <option value="6:00">6:00</option>
      <option value="6:30">6:30</option>
      <option value="7:00">7:00</option>
      <option value="7:30">7:30</option>
      <option value="8:00">8:00</option>
      <option value="8:30">8:30</option>
      <option value="9:00">9:00</option>
      <option value="9:30">9:30</option>
      <option value="10:00">10:00</option>
      <option value="10:30">10:30</option>
      <option value="11:00">11:00</option>
      <option value="11:30">11:30</option>
      <option value="12:00">12:00</option>
      <option value="12:30">12:30</option>
      <option value="13:00">13:00</option>
      <option value="13:30">13:30</option>
      <option value="14:00">14:00</option>
      <option value="14:30">14:30</option>
      <option value="15:00">15:00</option>
      <option value="15:30">15:30</option>
      <option value="16:00">16:00</option>
      <option value="16:30">16:30</option>
      <option value="17:00">17:00</option>
      <option value="17:30">17:30</option>
      <option value="18:00">18:00</option>
      <option value="18:30">18:30</option>
      <option value="19:00">19:00</option>
      <option value="19:30">19:30</option>
      <option value="20:00">20:00</option>
      <option value="20:30">20:30</option>
      <option value="21:00">21:00</option>
      <option value="21:30">21:30</option>
      <option value="22:00">22:00</option>
      <option value="22:30">22:30</option>
      <option value="23:00">23:00</option>
      <option value="23:30">23:30</option>
    </select>
    
    <!-- ì˜¤í”ˆ/ë§ˆê° ì‹œê°„ ì…ë ¥ í•„ë“œ ë -->
    <label>ìœ„ë„</label> <!-- 8-16) ìœ„ë„ ë¼ë²¨ -->
    <input id="lat" readonly required /> <!-- 8-17) ìœ„ë„ ê°’ í‘œì‹œ í•„ë“œ (ì½ê¸° ì „ìš©) -->
    <label>ê²½ë„</label> <!-- 8-18) ê²½ë„ ë¼ë²¨ -->
    <input id="lng" readonly required /> <!-- 8-19) ê²½ë„ ê°’ í‘œì‹œ í•„ë“œ (ì½ê¸° ì „ìš©) -->

    <button id="saveBtn" type="button">ì €ì¥</button> <!-- 8-20) ì €ì¥ ë²„íŠ¼ -->
  </form> <!-- 7-5) ìµœìƒìœ„ form ë‹«ê¸° -->

  <script>
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 9. Firebase ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const firebaseConfig = { /* 9-1) Firebase í”„ë¡œì íŠ¸ ì„¤ì • ì •ë³´ */
      apiKey: "AIzaSyCVYV1UxfSREQYnah3tBEKBTprgq9wRgii",
      authDomain: "instamap-9b595.firebaseapp.com",
      projectId: "instamap-9b595",
      storageBucket: "instamap-9b595.firebasestorage.app",
      messagingSenderId: "280950399933",
      appId: "1:280950399933:web:8282e0d352e50c8bcd2be0"
    };
    firebase.initializeApp(firebaseConfig); /* 9-2) Firebase ì•± ì´ˆê¸°í™” */
    const db       = firebase.firestore(); /* 9-3) Firestore ì¸ìŠ¤í„´ìŠ¤ ìƒì„± */
    const storage  = firebase.storage();   /* 9-4) Storage ì¸ìŠ¤í„´ìŠ¤ ìƒì„± */

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10. ì§€ë„ & ìœ„ì¹˜ ì„ íƒ ê¸°ëŠ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    let isLoggedIn = false; /* 10-1) ë¡œê·¸ì¸ ìƒíƒœ ë³€ìˆ˜ */
    const map = new naver.maps.Map('map',{center:new naver.maps.LatLng(37.5665,126.9780),zoom:15}); /* 10-2) ë„¤ì´ë²„ ì§€ë„ ìƒì„± (ê¸°ë³¸ ì¤‘ì‹¬: ì„œìš¸ ì‹œì²­) */
    let marker = null; /* 10-3) ë§ˆì»¤ ë³€ìˆ˜ ì´ˆê¸°ê°’ null */

    function setLatLng(lat,lng){ /* 10-4) ìœ„ë„/ê²½ë„ ë°›ì•„ì„œ inputì— ì„¤ì • ë° ë§ˆì»¤ í‘œì‹œ */
      document.getElementById('lat').value = lat;
      document.getElementById('lng').value = lng;
      if(marker) marker.setMap(null); /* ê¸°ì¡´ ë§ˆì»¤ ì œê±° */
      marker = new naver.maps.Marker({position:new naver.maps.LatLng(lat,lng),map:map}); /* ìƒˆë¡œìš´ ë§ˆì»¤ ìƒì„± */
    }
    naver.maps.Event.addListener(map,'click',e=>setLatLng(e.coord.lat(),e.coord.lng())); /* 10-5) ì§€ë„ í´ë¦­ ì‹œ ì¢Œí‘œ ê°€ì ¸ì™€ setLatLng í˜¸ì¶œ */
    document.getElementById('getLocBtn').onclick = () =>{ /* 10-6) í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ */
      navigator.geolocation?.getCurrentPosition(pos=>{ /* ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ */
        const {latitude,longitude}=pos.coords;
        setLatLng(latitude,longitude); /* ë§ˆì»¤ ì´ë™ ë° input ê°’ ì„¤ì • */
        map.setCenter(new naver.maps.LatLng(latitude,longitude)); /* ì§€ë„ ì¤‘ì‹¬ ì´ë™ */
        map.setZoom(18); /* í™•ëŒ€ ë ˆë²¨ 18ë¡œ ì„¤ì • */
      },()=>alert('ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.')); /* ê¶Œí•œ ê±°ë¶€ ì‹œ ì•Œë¦¼ */
    };

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 11. Kakao ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    document.getElementById('kakaoLoginBtn').addEventListener('click',()=>{ /* 11-1) ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ */
      Kakao.Auth.login({
        scope:'profile_nickname,account_email', /* 11-1-1) ìš”ì²­í•  ë™ì˜ ë²”ìœ„ */
        success:authObj=>{ /* 11-1-2) ë¡œê·¸ì¸ ì„±ê³µ ì‹œ */
          Kakao.API.request({
            url:'/v2/user/me', /* ì‚¬ìš©ì í”„ë¡œí•„ ì •ë³´ ìš”ì²­ */
            success:res=>{ /* 11-1-3) í”„ë¡œí•„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì„±ê³µ */
              alert(`ì•ˆë…•í•˜ì„¸ìš”, ${res.kakao_account.profile.nickname}ë‹˜!`); /* ë‹‰ë„¤ì„ í‘œì‹œ */
              isLoggedIn=true; /* 11-1-4) ë¡œê·¸ì¸ ìƒíƒœ true */
              document.getElementById('kakaoLoginBtn').style.display='none'; /* ë¡œê·¸ì¸ ë²„íŠ¼ ìˆ¨ê¹€ */
              document.getElementById('kakaoLogoutBtn').style.display='inline-block'; /* ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í‘œì‹œ */
            },
            fail:e=>console.error('ì‚¬ìš©ì ì •ë³´ ì‹¤íŒ¨',e) /* í”„ë¡œí•„ ì •ë³´ ìš”ì²­ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë¡œê·¸ */
          });
        },
        fail:e=>console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨',e) /* ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë¡œê·¸ */
      });
    });
    document.getElementById('kakaoLogoutBtn').addEventListener('click',()=>{ /* 11-2) ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ */
      Kakao.Auth.logout(()=>{ /* ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ API í˜¸ì¶œ */
        alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
        isLoggedIn=false; /* ë¡œê·¸ì¸ ìƒíƒœ false */
        document.getElementById('kakaoLoginBtn').style.display='inline-block'; /* ë¡œê·¸ì¸ ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ */
        document.getElementById('kakaoLogoutBtn').style.display='none'; /* ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ìˆ¨ê¹€ */
      });
    });

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 12. ì´ë¯¸ì§€ ì••ì¶• í•¨ìˆ˜ (<=1MB) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function compressImage(file,maxBytes=1_000_000){ /* 12-1) compressImage í•¨ìˆ˜ ì •ì˜ */
      return new Promise(resolve=>{
        const img = new Image();
        const reader = new FileReader();
        reader.onload = e => {
          img.onload = () => {
            const canvas = document.createElement('canvas');
            /* 12-2) ê°€ë¡œ ìµœëŒ€ 1024px ë¹„ìœ¨ ê³„ì‚° */
            const maxW = 1024;
            const scale = Math.min(1, maxW / img.width);
            canvas.width  = img.width  * scale;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img,0,0,canvas.width,canvas.height);

            let quality = 0.8;
            function exportBlob(){
              canvas.toBlob(blob=>{
                /* 12-3) blob í¬ê¸°ê°€ maxBytes ì´í•˜ ë˜ëŠ” í’ˆì§ˆì´ 0.4 ë¯¸ë§Œì´ë©´ resolve */
                if(blob.size <= maxBytes || quality < 0.4){
                  resolve(blob);
                }else{
                  quality -= 0.1; /* 12-4) í’ˆì§ˆ 0.1ì”© ë‚®ì¶”ê¸° */
                  exportBlob();
                }
              },'image/jpeg',quality);
            }
            exportBlob();
          };
          img.src = e.target.result; /* 12-5) FileReader ê²°ê³¼ë¥¼ img.srcì— ì„¤ì • */
        };
        reader.readAsDataURL(file); /* 12-6) íŒŒì¼ì„ DataURLë¡œ ë³€í™˜ */
      });
    }

    /**
     * 13. parseVimeoInput í•¨ìˆ˜: ì‚¬ìš©ìê°€ ì…ë ¥í•œ Vimeo ê°’(iframe ì½”ë“œ, embed URL, ê³µìœ  URL)ì—ì„œ
     *    ì‹¤ì œ ì¬ìƒìš© player src URLë§Œ ì¶”ì¶œí•˜ì—¬ ë°˜í™˜
     */
    function parseVimeoInput(input) {
      // 13-1) <script> íƒœê·¸ ì œê±°
      input = input.replace(/<script[\s\S]*?<\/script>/gi, "");

      // 13-2) iframe src ì†ì„± ì¶”ì¶œ (iframe ì½”ë“œì¸ ê²½ìš°)
      const iframeMatch = input.match(/<iframe[^>]+src=["']([^"']+)["']/i);
      if (iframeMatch) {
        return iframeMatch[1];
      }
      // 13-3) player.vimeo.com Embed URL í˜•ì‹ ê²€ì¦
      const embedMatch = input.match(/^(https?:\/\/player\.vimeo\.com\/video\/\d+(?:\?.*)?)/i);
      if (embedMatch) {
        return embedMatch[1];
      }

      // 13-4) ê³µìœ ìš© Vimeo URL(vimeo.com/ID) í˜•ì‹ ê²€ì¦
      const shareMatch = input.match(/^https?:\/\/vimeo\.com\/(\d+)/i);
      if (shareMatch) {
        return `https://player.vimeo.com/video/${shareMatch[1]}`;
      }

      // 13-5) ìœ„ ì¡°ê±´ ëª¨ë‘ í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
      return "";
    }  /* 13 ì¢…ë£Œ */

    // 14-3) ì„ íƒí•œ ì—…ì²´ë¥¼ í¼ì— ë¡œë“œ: Firestore ë¬¸ì„œ ë°ì´í„°ë¥¼ ê°ê°ì˜ ì…ë ¥ í•„ë“œì— ì±„ìš°ê³  ë§ˆì»¤ ì´ë™
    function loadStoreToForm(doc) {
      const data = doc.data();
      editingId = doc.id; /* 14-3-1) ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜: ì„ íƒí•œ ë¬¸ì„œ ID ì €ì¥ */
      document.querySelector('[name=name]').value     = data.name;  /* 14-3-2) ê°€ê²Œ ì´ë¦„ ì„¤ì • */
      document.querySelector('[name=insta_id]').value = data.insta; /* 14-3-3) ì¸ìŠ¤íƒ€ ID ì„¤ì • */
      document.querySelector('[name=desc]').value     = data.desc;  /* 14-3-4) ì„¤ëª… ì„¤ì • */
      document.getElementById('lat').value           = data.lat;   /* 14-3-5) ìœ„ë„ ì„¤ì • */
      document.getElementById('lng').value           = data.lng;   /* 14-3-6) ê²½ë„ ì„¤ì • */
      document.querySelector('[name=vimeo]').value    = data.vimeo || ""; /* 14-3-7) Vimeo í•„ë“œ ì„¤ì • */
      setLatLng(data.lat, data.lng); /* 14-3-8) ë§ˆì»¤ ìœ„ì¹˜ ì¬ì„¤ì • */
      document.getElementById('saveBtn').textContent = "ìˆ˜ì • ì €ì¥"; /* 14-3-9) ì €ì¥ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ */
    }
      document
        .getElementById('saveBtn')
        .addEventListener('click', async () => {
          if (!isLoggedIn) {
            alert('ë¡œê·¸ì¸ í›„ ë“±ë¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            return;
          }

      /* 15-3. Vimeo ì…ë ¥ê°’ íŒŒì‹± ë° ê²€ì¦ */
        const rawInput = document.querySelector('[name=vimeo]').value; /* 15-3-1) ì‚¬ìš©ìê°€ ì…ë ¥í•œ Vimeo ë¬¸ìì—´ */
        const vimeoUrl = parseVimeoInput(rawInput.trim()); /* 15-3-2) parseVimeoInput í•¨ìˆ˜ í˜¸ì¶œ */
          if (rawInput.trim() !== '' && !vimeoUrl) { /* 15-3-3) ì…ë ¥ê°’ì´ ë¹„ì–´ ìˆì§€ ì•Šìœ¼ë‚˜ íŒŒì‹± ê²°ê³¼ê°€ ì—†ìœ¼ë©´ */
          alert('ìœ íš¨í•œ Vimeo ë§í¬ë‚˜ <iframe> ì½”ë“œë¥¼ ë„£ì–´ì£¼ì„¸ìš”.');
          return;
        }
        /* 15-3. Vimeo ì…ë ¥ê°’ íŒŒì‹±/ê²€ì¦ ëë‚œ ë’¤ */

        // â–¼ ì—¬ê¸°ë¶€í„° í•´ì‹œíƒœê·¸ ë° ì‹œê°„ ì…ë ¥ê°’ ìˆ˜ì§‘ â–¼
        const rawHashtags = document.querySelector('[name=hashtags]').value.trim();  // 15-3-1) í•´ì‹œíƒœê·¸ ì›ì‹œ ë¬¸ìì—´
        // ì‰¼í‘œ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ë°°ì—´ë¡œ ë³€í™˜ (ê³µë°± ì œê±°)
        const hashtagsArray = rawHashtags === ''
          ? []
          : rawHashtags.split(',').map(tag => tag.trim()).filter(tag => tag !== '');

        const openTime = document.querySelector('[name=openTime]').value;    // 15-3-2) ì˜¤í”ˆ ì‹œê°„ (ë¬¸ìì—´, ex: "09:30")
        const closeTime = document.querySelector('[name=closeTime]').value;  // 15-3-3) ë§ˆê° ì‹œê°„ (ë¬¸ìì—´, ex: "21:00")
        // 1) ë¸Œë ˆì´í¬ íƒ€ì„
        const breakStart = document.querySelector('[name=breakStart]').value;
        const breakEnd   = document.querySelector('[name=breakEnd]').value;
        // 2) ì‰¬ëŠ” ë‚ (ì²´í¬ëœ ê²ƒë§Œ ë°°ì—´ë¡œ)
        const offDays = Array.from(
          document.querySelectorAll('[name="offDays[]"]:checked')
        ).map(cb => cb.value);

        // (ë””ë²„ê¹…ìš© ë¡œê·¸)
        console.log('breakStart â†’', breakStart);
        console.log('breakEnd   â†’', breakEnd);
        console.log('offDays    â†’', offDays);

        // â–¼ ì—¬ê¸°ê¹Œì§€ í•´ì‹œíƒœê·¸ ë° ì‹œê°„ ìˆ˜ì§‘ â–¼
        console.log('openTime â†’', openTime);
        console.log('closeTime â†’', closeTime);
        /* 15-4. Firestoreì— ì €ì¥í•  ê°ì²´ ìƒì„± */
        const store = {
          name   : document.querySelector('[name=name]').value.trim(),       /* 15-4-1) ê°€ê²Œ ì´ë¦„ */
          insta  : document.querySelector('[name=insta_id]').value.trim(),   /* 15-4-2) ì¸ìŠ¤íƒ€ê·¸ë¨ ID */
          desc   : document.querySelector('[name=desc]').value.trim(),       /* 15-4-3) ê°€ê²Œ ì„¤ëª… */
          lat    : parseFloat(document.getElementById('lat').value),         /* 15-4-4) ìœ„ë„ (ìˆ«ì) */
          lng    : parseFloat(document.getElementById('lng').value),         /* 15-4-5) ê²½ë„ (ìˆ«ì) */
          photo  : '',   /* 15-4-6) ì´ë¯¸ì§€ URL (ë‚˜ì¤‘ì— ì„¤ì •) */
          vimeo  : vimeoUrl,   /* 15-4-7) íŒŒì‹±ëœ Vimeo URL */
          created: firebase.firestore.FieldValue.serverTimestamp(), /* 15-4-8) ì„œë²„ íƒ€ì„ìŠ¤íƒ¬í”„ */
            // â–¼ ì—¬ê¸°ì— ìƒˆë¡œ ì¶”ê°€í•  ì†ì„± â–¼
          hashtags : hashtagsArray,  // 15-4-1) í•´ì‹œíƒœê·¸ ë°°ì—´
          openTime : openTime,       // 15-4-2) ì˜¤í”ˆ ì‹œê°„ ë¬¸ìì—´
          closeTime: closeTime,       // 15-4-3) ë§ˆê° ì‹œê°„ ë¬¸ìì—´
          breakStart: breakStart,   // ì¶”ê°€ëœ ë¸Œë ˆì´í¬ ì‹œì‘ ì‹œê°„
          breakEnd:   breakEnd,     // ì¶”ê°€ëœ ë¸Œë ˆì´í¬ ì¢…ë£Œ ì‹œê°„
          offDays:    offDays,      // ì¶”ê°€ëœ ì‰¬ëŠ” ë‚  ë°°ì—´
          // â–¼ ì¶”ê°€ ë â–¼
          /* 15-4-9) ê¸°ì¡´ ìœ íš¨ì„± ê²€ì‚¬ ë‹¤ìŒ ë“± ë¡œì§ ê³„ì†â€¦ */
        };
        if (!store.name || !store.insta || isNaN(store.lat) || isNaN(store.lng) || !openTime || !closeTime) {/* 15-4-9) í•„ìˆ˜ í•­ëª© ìœ íš¨ì„± ê²€ì‚¬ */
          alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }

        /* 15-5. (ì„ íƒ) ì‚¬ì§„ ì²˜ë¦¬ */
        const fileInput = document.getElementById('photo');
        const file = fileInput.files[0]; /* 15-5-1) íŒŒì¼ ì„ íƒ ì—¬ë¶€ í™•ì¸ */
        try{
          if(file){
            /* 15-5-2) ì´ë¯¸ì§€ ì••ì¶• */
            const compressedBlob = await compressImage(file);
            /* 15-5-3) Storage ì—…ë¡œë“œìš© íŒŒì¼ëª… ìƒì„± */
            const filename = `store_photos/${Date.now()}_${file.name.replace(/\s+/g,'')}`;
            const ref = storage.ref().child(filename);
            await ref.put(compressedBlob); /* 15-5-4) Firebase Storageì— Blob ì—…ë¡œë“œ */
            store.photo = await ref.getDownloadURL(); /* 15-5-5) ì—…ë¡œë“œ í›„ ë‹¤ìš´ë¡œë“œ URL ì €ì¥ */
          }

          /* 15-6. Firestore ì €ì¥: ì‹ ê·œ ë“±ë¡ vs ìˆ˜ì • ë¶„ê¸° */
          if (editingId) { /* 15-6-1) ìˆ˜ì • ëª¨ë“œ */
            await db.collection('stores').doc(editingId).update(store); /* ë¬¸ì„œ ì—…ë°ì´íŠ¸ */
            alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
          } else { /* 15-6-2) ì‹ ê·œ ë“±ë¡ ëª¨ë“œ */
            await db.collection('stores').add(store); /* ìƒˆ ë¬¸ì„œ ì¶”ê°€ */
            alert('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
          }
          document.getElementById('storeForm').reset(); /* 15-6-3) í¼ ë¦¬ì…‹ */
          if(marker) marker.setMap(null); /* ë§ˆì»¤ ì œê±° */
        }catch(err){
          console.error(err); /* 15-6-4) ì˜¤ë¥˜ ë°œìƒ ì‹œ ì½˜ì†” ë¡œê·¸ ì¶œë ¥ */
          alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      });
  </script>
</body>
</html>