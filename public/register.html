<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ê°€ê²Œ ë“±ë¡</title>

  <!-- ë„¤ì´ë²„ ì§€ë„ -->
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=qpbrmxiff4"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <style>
    body{font-family:sans-serif;max-width:640px;margin:24px auto;padding:0 12px}
    #map{width:100%;height:320px;border:1px solid #ccc;border-radius:6px;margin-bottom:16px}
    label{display:block;margin-top:12px;font-weight:700}
    input,textarea,select{width:100%;padding:8px;margin-top:4px;border:1px solid #bbb;border-radius:4px;font-size:14px}
    button{margin-top:14px;padding:10px 18px;font-size:15px;border:none;border-radius:4px;cursor:pointer}
    #getLocBtn{background:#28a745;color:#fff}
    #saveBtn{background:#2d8cff;color:#fff}
  </style>
</head>
<body>
  <h2>ğŸ“ ê°€ê²Œ ë“±ë¡</h2>
  <div id="map"></div>

  <button id="getLocBtn">í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°</button>

  <form id="storeForm" onsubmit="return false;">
    <label>ê°€ê²Œ ì´ë¦„</label>
    <input name="name" required />

    <label>ì¸ìŠ¤íƒ€ê·¸ë¨ ID (@ ì œì™¸)</label>
    <input name="insta_id" required />

    <label>ê°€ê²Œ ì„¤ëª…</label>
    <textarea name="desc" rows="4"></textarea>

    <label>ìœ„ë„</label>
    <input id="lat" readonly required />

    <label>ê²½ë„</label>
    <input id="lng" readonly required />

    <button id="saveBtn" type="submit">ì €ì¥</button>
  </form>

<script>
/* ---------- Firebase ì´ˆê¸°í™” ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCVYV1UxfSREQYnah3tBEKBTprgq9wRgii",
  authDomain: "instamap-9b595.firebaseapp.com",
  projectId: "instamap-9b595",
  storageBucket: "instamap-9b595.appspot.com",
  messagingSenderId: "280950399933",
  appId: "1:280950399933:web:8282e0d352e50c8bcd2be0"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ---------- ë„¤ì´ë²„ ì§€ë„ & ë§ˆì»¤ ë¯¸ë¦¬ë³´ê¸° ---------- */
const map = new naver.maps.Map('map',{
  center: new naver.maps.LatLng(37.5665,126.9780),
  zoom: 15
});
let marker = null;

function setLatLng(lat, lng){
  document.getElementById('lat').value = lat;
  document.getElementById('lng').value = lng;

  // ê¸°ì¡´ ë§ˆì»¤ ì§€ìš°ê¸°
  if(marker) marker.setMap(null);

  // ë§ˆì»¤ ì°ê¸° (ë§¥ì£¼ë³‘ ì´ë¯¸ì§€ ì‚¬ìš©)
  marker = new naver.maps.Marker({
    position: new naver.maps.LatLng(lat, lng),
    map: map,
    icon: {
      url: 'https://insta-map-three.vercel.app/image/beer-marker.png',
      size: new naver.maps.Size(32, 32),
      anchor: new naver.maps.Point(16, 32)
    }
  });
}

// ì§€ë„ í´ë¦­ ì‹œ ìœ„ì¹˜ ì„¤ì •
naver.maps.Event.addListener(map, 'click', e => {
  setLatLng(e.coord.lat(), e.coord.lng());
});

// í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼
document.getElementById('getLocBtn').onclick = () => {
  navigator.geolocation?.getCurrentPosition(pos => {
    const {latitude, longitude} = pos.coords;
    setLatLng(latitude, longitude);
    map.setCenter(new naver.maps.LatLng(latitude, longitude));
  }, ()=>alert('ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.'));
};

/* ---------- Firestore ì €ì¥ ---------- */
document.getElementById('storeForm').addEventListener('submit', async () => {
  const store = {
    name    : document.querySelector('[name=name]').value.trim(),
    insta   : document.querySelector('[name=insta_id]').value.trim(),
    desc    : document.querySelector('[name=desc]').value.trim(),
    lat     : parseFloat(document.getElementById('lat').value),
    lng     : parseFloat(document.getElementById('lng').value),
    created : firebase.firestore.FieldValue.serverTimestamp()
  };
  // ê²€ì¦
  if (!store.name || !store.insta || isNaN(store.lat) || isNaN(store.lng)) {
    alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  try {
    await db.collection('stores').add(store);
    alert('Firebaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    document.getElementById('storeForm').reset();
    if(marker) marker.setMap(null);
  } catch(err) {
    console.error(err);
    alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  }
});
</script>
</body>
</html>
ì´ ì½”ë“œì— 
  <!-- ê¸°ì¡´ Firestore ì €ì¥ ë¡œì§ ë -->
  document.getElementById('storeForm').addEventListener('submit', async () => {
    // â€¦ ê¸°ì¡´ ì½”ë“œ â€¦
  });

  /* â† ì—¬ê¸°ì— ë¶™ì—¬ ë„£ê¸° ì‹œì‘ */
  /* ---------- ğŸ”´ ì¸ìŠ¤íƒ€ í”„ë¡œí•„ ì›í˜• ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì¶”ê°€ ---------- */
  async function fetchAvatar(id){ /* â€¦ */ }
  // â€¦ì¤‘ëµâ€¦
  setLatLng = function(lat, lng){ /* â€¦ */ };
  /* â† ì—¬ê¸°ì— ë¶™ì—¬ ë„£ê¸° ë */

  </script>  <!-- â† ì´ íƒœê·¸ ì§ì „! -->
</body>
</html>  