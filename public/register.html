<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
  <title>ê°€ê²Œ ë“±ë¡</title>

  <!-- 2. Naver Maps SDK ë¡œë“œ -->
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=qpbrmxiff4"></script> <!-- 2-1) ë„¤ì´ë²„ ì§€ë„ API ì‚¬ìš©ì„ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ í¬í•¨ -->

  <!-- 3. Firebase SDK ë¡œë“œ (Firestore, Storage) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>         <!-- 3-1) Firebase ì•± ì´ˆê¸°í™”ìš© SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>   <!-- 3-2) Firestore ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©ìš© SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>     <!-- 3-3) Storage(ì´ë¯¸ì§€ ì €ì¥) ì‚¬ìš©ìš© SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

  <style>
    /* 4. ê³µí†µ ìŠ¤íƒ€ì¼ ì •ì˜
       4-1) body: ê¸°ë³¸ í°íŠ¸, ìµœëŒ€ ë„ˆë¹„, ì¤‘ì•™ ì •ë ¬, íŒ¨ë”©
       4-2) #map: ì§€ë„ ì˜ì—­ í¬ê¸°, í…Œë‘ë¦¬, ë‘¥ê·¼ ëª¨ì„œë¦¬, ë§ˆì§„
       4-3) label, input, textarea, select: í¼ ìš”ì†Œ ìŠ¤íƒ€ì¼
    */                         /* â† ì—¬ê¸°ì— ë‹«ëŠ” ì£¼ì„ ì¶”ê°€ */
    input,textarea,select{
    box-sizing: border-box;  /* â† ì´ ì¤„ ì¶”ê°€ */
      width:100%;
      padding:8px;
      margin-top:4px;
      border:1px solid #bbb;
      border-radius:4px;
      font-size:14px;
     }
    /* 
       4-4) button: ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼
       4-5) #getLocBtn, #saveBtn: ë²„íŠ¼ë³„ ë°°ê²½ìƒ‰ ì§€ì •
       4-6) #header, #authButtons: í—¤ë” ì˜ì—­ ì •ë ¬ ë° ë²„íŠ¼ ìŠ¤íƒ€ì¼
    */
    body{font-family:sans-serif;max-width:640px;margin:24px auto;padding:0 12px} /* 4-1 */
    #map{width:100%;height:320px;border:1px solid #ccc;border-radius:6px;margin-bottom:16px} /* 4-2 */
    label{display:block;margin-top:12px;font-weight:700} /* 4-3 */
      .off-days {
        display: flex;
        align-items: center;
        gap: 16px;
        flex-wrap: wrap;
      }
      .off-days label {
        display: flex;
        align-items: center;
        gap: 4px;
        font-weight: 500;
      }
      .off-days input[type="checkbox"] {
        width: 16px;
        height: 16px;
      }

    button{margin-top:14px;padding:10px 18px;font-size:15px;border:none;border-radius:4px;cursor:pointer} /* 4-4 */
    #getLocBtn{background:#28a745;color:#fff} /* 4-5 */
    #saveBtn{background:#2d8cff;color:#fff}  /* 4-5 */
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4-6) í—¤ë” ì˜ì—­ & ë²„íŠ¼ ìŠ¤íƒ€ì¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* margin-bottom:12px;  â† í•„ìš” ì—†ìœ¼ë©´ ì§€ì›Œë„ ë©ë‹ˆë‹¤ */
      height: 60px;            /* í—¤ë” ë†’ì´ ê³ ì • */
      box-sizing: border-box;  /* padding í¬í•¨í•˜ì—¬ ê³„ì‚° */
    }

    /* ì œëª© ê°€ìš´ë° ì •ë ¬ */
    #header h2 {
      margin: 0;
      line-height: 60px;       /* #header ë†’ì´ì™€ ì¼ì¹˜ */
      font-size: 1.25rem;
    }

    /* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ë„ í—¤ë” ë†’ì´ì— ë§ì¶°ì„œ */
    .back-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 100%;          /* í—¤ë” ë†’ì´(60px)ë¥¼ ê·¸ëŒ€ë¡œ ë”°ë¦„ */
      padding: 0 8px;        /* í´ë¦­ ì˜ì—­ í™•ë³´ */
  
      font-size: 32px;       /* í™”ì‚´í‘œ í¬ê¸° */
      line-height: 1;        /* í…ìŠ¤íŠ¸ê°€ ë„˜ì¹˜ì§€ ì•Šë„ë¡ */
      color: var(--text);
      text-decoration: none;
      margin-right: 8px;
    }

    /* â”€â”€â”€ ë¡œë”© ì˜¤ë²„ë ˆì´ ìŠ¤íƒ€ì¼ â”€â”€â”€ */
    #loadingOverlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    /* â”€â”€â”€ ìŠ¤í”¼ë„ˆ ì• ë‹ˆë©”ì´ì…˜ â”€â”€â”€ */
    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(255,255,255,0.6);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
      /* ë²„íŠ¼ ê·¸ë£¹ ì •ë ¬ */
    .btn-group {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      justify-content:space-between;
    }
    /* â‘¡ ì°¸ê³  ì˜ìƒ ë²„íŠ¼ */
    #helpVideoBtn{
    margin-left:auto;      /* â† ìš°ì¸¡ìœ¼ë¡œ ë°€ì°© */
    }
    .main-btn {
      padding: 8px 16px;
      background: #0F9ED5;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    /* â”€â”€â”€ ëª¨ë‹¬ ë°°ê²½ (ê·¸ëŒ€ë¡œ) â”€â”€â”€ */
    .modal{
      position:fixed;inset:0;display:none;
      justify-content:center;align-items:center;
      background:rgba(0,0,0,.8);z-index:2000;
    }

    .modal-content{
      position:relative;
      width :min(90vw,calc(90vh*9/16));   /* ê°€ë¡œ,ì„¸ë¡œ ì¤‘ ì‘ì€ ê°’ ì„ íƒ */
      height:min(90vh,calc(90vw*16/9));   /* â†’ í•­ìƒ 9:16 ìœ ì§€       */
      border-radius:16px; overflow:hidden;
    }

    /* â”€â”€â”€ iframe ê°€ë“ ì±„ìš°ê¸° â”€â”€â”€ */
    #videoFrame{width:100%;height:100%;border:0;}

    /* â”€â”€â”€ ë‹«ê¸°(X) ë²„íŠ¼ â”€â”€â”€ */
    #closeVideo{
      position:absolute; top:8px; right:8px;
      width:40px; height:40px; border:none;
      border-radius:50%; background:#fff;
      font-size:24px; line-height:1; 
      display:flex;                    /* â‘  */
      align-items:center;              /* â‘¡ ìˆ˜ì§ ì¤‘ì•™ */
      justify-content:center;          /* â‘¢ ìˆ˜í‰ ì¤‘ì•™ */
      cursor:pointer;
      box-shadow:0 2px 6px rgba(0,0,0,.3);
    }
  </style>
</head>
<body>
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="loadingOverlay" style="display:none;">
    <div class="spinner"></div>
  </div>
  <!-- 5. í—¤ë” ì˜ì—­ (ì œëª© + ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼) -->
  <div id="header">
    <!-- ë’¤ë¡œê°€ê¸° í™”ì‚´í‘œ -->
    <a href="https://inwave.ai.kr/view_stores.html" class="back-button" aria-label="ë’¤ë¡œê°€ê¸°">&lt;</a>
      <div style="display: flex; align-items: center; gap: 6px;">
      <img src="images/store.svg" alt="ë§¤ì¥ ë“±ë¡" style="width: 24px; height: 24px;" />
      <h2 style="margin: 0; font-size: 1.1rem;">ë§¤ì¥ ë“±ë¡</h2>
    </div>

  </div>

  <!-- 6. ì§€ë„ ì˜ì—­ ë° í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ -->
  <div id="map"></div> <!-- 6-1) ë„¤ì´ë²„ ì§€ë„ê°€ ë Œë”ë§ë  ì˜ì—­ -->  
 
<div class="btn-group">
  <button type="button" id="getLocBtn" class="main-btn">í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°</button>
  <button type="button" id="helpVideoBtn" class="main-btn">ì°¸ê³  ì˜ìƒ</button>
</div>

  <!-- í¼ ì‹œì‘: ì´ ì¤„ì„ ê¼­ ì¶”ê°€ -->
  <form id="storeForm">
    <!-- 8. ë“±ë¡/ìˆ˜ì • í¼ (í•œ ë²ˆë§Œ ì“°ê¸°) -->
    <label>ê°€ê²Œ ì´ë¦„</label> <!-- 8-1) ê°€ê²Œ ì´ë¦„ ë¼ë²¨ -->
    <input name="name" required /> <!-- 8-2) ê°€ê²Œ ì´ë¦„ ì…ë ¥ í•„ë“œ -->

    <label>ì¸ìŠ¤íƒ€ê·¸ë¨ ID (@ ì œì™¸)</label> <!-- 8-3) ì¸ìŠ¤íƒ€ê·¸ë¨ ID ë¼ë²¨ -->
    <input name="insta_id" required /> <!-- 8-4) ì¸ìŠ¤íƒ€ê·¸ë¨ ID ì…ë ¥ í•„ë“œ -->

    <label>ê°€ê²Œ ì„¤ëª…</label> <!-- 8-5) ê°€ê²Œ ì„¤ëª… ë¼ë²¨ -->
    <textarea name="desc" rows="4"></textarea> <!-- 8-6) ê°€ê²Œ ì„¤ëª… ì…ë ¥ í•„ë“œ -->

    <label>ê°€ê²Œ ì‚¬ì§„ (ì„ íƒ) <small style="font-weight:400">(ìë™ìœ¼ë¡œ 1 MB ë¯¸ë§Œìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤)</small></label> <!-- 8-7) ì‚¬ì§„ ì—…ë¡œë“œ ë¼ë²¨ -->
    <input type="file" id="photo" accept="image/*" /> <!-- 8-8) ì‚¬ì§„ ì„ íƒ í•„ë“œ -->

    <label>Vimeo ë™ì˜ìƒ</label> <!-- 8-9) Vimeo ë§í¬ ë¼ë²¨ -->
    <input name="vimeo" type="text"
           placeholder="ë™ì˜ìƒì€ ê²€ìˆ˜ë¥¼ í†µí•´ ì—…ë¡œë“œ ë©ë‹ˆë‹¤." /> <!-- 8-10) Vimeo ì…ë ¥ í•„ë“œ -->
    <label>í•´ì‹œíƒœê·¸ (ê³ ê°ì—ê²Œ ë…¸ì¶œë˜ëŠ” ë¬¸êµ¬)</label>             <!-- ì£¼ì„ 8-11) í•´ì‹œíƒœê·¸ ë¼ë²¨ -->
    <input name="hashtags" placeholder="#ìŒì‹, #ì¹´í˜ ë“± ì§ê´€ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆëŠ” ì´ë¦„ìœ¼ë¡œ 5ê¸€ì ë¯¸ë§Œ" />
    <!-- ì˜¤í”ˆ/ë§ˆê° ì‹œê°„ ì…ë ¥ í•„ë“œ ì‹œì‘ -->
    <label>ì˜¤í”ˆ ì‹œê°„ (24ì‹œê°„ ê¸°ì¤€, 30ë¶„ ë‹¨ìœ„)</label>      <!-- ì£¼ì„ 8-12) ì˜¤í”ˆ ì‹œê°„ ë¼ë²¨ -->
    <select name="openTime">                               <!-- ì£¼ì„ 8-13) ì˜¤í”ˆ ì‹œê°„ ì…€ë ‰íŠ¸ -->
      <option value="3:00">3:00</option>
      <option value="3:30">3:30</option>
      <option value="4:00">4:00</option>
      <option value="4:30">4:30</option>
      <option value="5:00">5:00</option>
      <option value="5:30">5:30</option>
      <option value="6:00">6:00</option>
      <option value="6:30">6:30</option>
      <option value="7:00">7:00</option>
      <option value="7:30">7:30</option>
      <option value="8:00">8:00</option>
      <option value="8:30">8:30</option>
      <option value="9:00">9:00</option>
      <option value="9:30">9:30</option>
      <option value="10:00">10:00</option>
      <option value="10:30">10:30</option>
      <option value="11:00">11:00</option>
      <option value="11:30">11:30</option>
      <option value="12:00">12:00</option>
      <option value="12:30">12:30</option>
      <option value="13:00">13:00</option>
      <option value="13:30">13:30</option>
      <option value="14:00">14:00</option>
      <option value="14:30">14:30</option>
      <option value="15:00">15:00</option>
      <option value="15:30">15:30</option>
      <option value="16:00">16:00</option>
      <option value="16:30">16:30</option>
      <option value="17:00">17:00</option>
      <option value="17:30">17:30</option>
      <option value="18:00">18:00</option>
      <option value="18:30">18:30</option>
      <option value="19:00">19:00</option>
      <option value="19:30">19:30</option>
      <option value="20:00">20:00</option>
      <option value="20:30">20:30</option>
      <option value="21:00">21:00</option>
      <option value="21:30">21:30</option>
      <option value="22:00">22:00</option>
      <option value="22:30">22:30</option>
      <option value="23:00">23:00</option>
      <option value="23:30">23:30</option>
    </select>

    <label>ë§ˆê° ì‹œê°„ (24ì‹œê°„ ê¸°ì¤€, 30ë¶„ ë‹¨ìœ„)</label>      <!-- ì£¼ì„ 8-14) ë§ˆê° ì‹œê°„ ë¼ë²¨ -->
    <select name="closeTime">                              <!-- ì£¼ì„ 8-15) ë§ˆê° ì‹œê°„ ì…€ë ‰íŠ¸ -->
      <option value="3:00">3:00</option>
      <option value="3:30">3:30</option>
      <option value="4:00">4:00</option>
      <option value="4:30">4:30</option>
      <option value="5:00">5:00</option>
      <option value="5:30">5:30</option>
      <option value="6:00">6:00</option>
      <option value="6:30">6:30</option>
      <option value="7:00">7:00</option>
      <option value="7:30">7:30</option>
      <option value="8:00">8:00</option>
      <option value="8:30">8:30</option>
      <option value="9:00">9:00</option>
      <option value="9:30">9:30</option>
      <option value="10:00">10:00</option>
      <option value="10:30">10:30</option>
      <option value="11:00">11:00</option>
      <option value="11:30">11:30</option>
      <option value="12:00">12:00</option>
      <option value="12:30">12:30</option>
      <option value="13:00">13:00</option>
      <option value="13:30">13:30</option>
      <option value="14:00">14:00</option>
      <option value="14:30">14:30</option>
      <option value="15:00">15:00</option>
      <option value="15:30">15:30</option>
      <option value="16:00">16:00</option>
      <option value="16:30">16:30</option>
      <option value="17:00">17:00</option>
      <option value="17:30">17:30</option>
      <option value="18:00">18:00</option>
      <option value="18:30">18:30</option>
      <option value="19:00">19:00</option>
      <option value="19:30">19:30</option>
      <option value="20:00">20:00</option>
      <option value="20:30">20:30</option>
      <option value="21:00">21:00</option>
      <option value="21:30">21:30</option>
      <option value="22:00">22:00</option>
      <option value="22:30">22:30</option>
      <option value="23:00">23:00</option>
      <option value="23:30">23:30</option>
      <option value="24:00">24:00 (ë‹¤ìŒë‚  0:00)</option>
      <option value="24:30">24:30 (ë‹¤ìŒë‚  0:30)</option>
      <option value="25:00">25:00 (ë‹¤ìŒë‚  1:00)</option>
      <option value="25:30">25:30 (ë‹¤ìŒë‚  1:30)</option>
      <option value="26:00">26:00 (ë‹¤ìŒë‚  2:00)</option>
      <option value="26:30">26:30 (ë‹¤ìŒë‚  2:30)</option>
      <option value="27:00">27:00 (ë‹¤ìŒë‚  3:00)</option>
    </select>

      <!-- 1) ì‰¬ëŠ” ë‚  ì²´í¬ë°•ìŠ¤ -->
    <label>ì‰¬ëŠ” ë‚ </label>
    <div class="off-days">
      <label><input type="checkbox" name="offDays[]" value="ì›”"> ì›”ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="í™”"> í™”ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="ìˆ˜"> ìˆ˜ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="ëª©"> ëª©ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="ê¸ˆ"> ê¸ˆìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="í† "> í† ìš”ì¼</label>
      <label><input type="checkbox" name="offDays[]" value="ì¼"> ì¼ìš”ì¼</label>
    </div>

    <!-- 2) ë¸Œë ˆì´í¬ íƒ€ì„ -->
    <label>ë¸Œë ˆì´í¬ íƒ€ì„ ì‹œì‘ (24ì‹œê°„ ê¸°ì¤€, 30ë¶„ ë‹¨ìœ„)</label>
    <select name="breakStart">
      <option value="">ì„ íƒ ì•ˆí•¨</option>
      <option value="00:00">00:00</option>
      <option value="0:30">0:30</option>
      <option value="1:00">1:00</option>
      <option value="1:30">1:30</option>
      <option value="2:00">2:00</option>
      <option value="2:30">2:30</option>
      <option value="3:00">3:00</option>
      <option value="3:30">3:30</option>
      <option value="4:00">4:00</option>
      <option value="4:30">4:30</option>
      <option value="5:00">5:00</option>
      <option value="5:30">5:30</option>
      <option value="6:00">6:00</option>
      <option value="6:30">6:30</option>
      <option value="7:00">7:00</option>
      <option value="7:30">7:30</option>
      <option value="8:00">8:00</option>
      <option value="8:30">8:30</option>
      <option value="9:00">9:00</option>
      <option value="9:30">9:30</option>
      <option value="10:00">10:00</option>
      <option value="10:30">10:30</option>
      <option value="11:00">11:00</option>
      <option value="11:30">11:30</option>
      <option value="12:00">12:00</option>
      <option value="12:30">12:30</option>
      <option value="13:00">13:00</option>
      <option value="13:30">13:30</option>
      <option value="14:00">14:00</option>
      <option value="14:30">14:30</option>
      <option value="15:00">15:00</option>
      <option value="15:30">15:30</option>
      <option value="16:00">16:00</option>
      <option value="16:30">16:30</option>
      <option value="17:00">17:00</option>
      <option value="17:30">17:30</option>
      <option value="18:00">18:00</option>
      <option value="18:30">18:30</option>
      <option value="19:00">19:00</option>
      <option value="19:30">19:30</option>
      <option value="20:00">20:00</option>
      <option value="20:30">20:30</option>
      <option value="21:00">21:00</option>
      <option value="21:30">21:30</option>
      <option value="22:00">22:00</option>
      <option value="22:30">22:30</option>
      <option value="23:00">23:00</option>
      <option value="23:30">23:30</option>
    </select>

    <label>ë¸Œë ˆì´í¬ íƒ€ì„ ì¢…ë£Œ (24ì‹œê°„ ê¸°ì¤€, 30ë¶„ ë‹¨ìœ„)</label>
    <select name="breakEnd">
      <option value="">ì„ íƒ ì•ˆí•¨</option>
      <option value="00:00">00:00</option>
      <option value="0:30">0:30</option>
      <option value="1:00">1:00</option>
      <option value="1:30">1:30</option>
      <option value="2:00">2:00</option>
      <option value="2:30">2:30</option>
      <option value="3:00">3:00</option>
      <option value="3:30">3:30</option>
      <option value="4:00">4:00</option>
      <option value="4:30">4:30</option>
      <option value="5:00">5:00</option>
      <option value="5:30">5:30</option>
      <option value="6:00">6:00</option>
      <option value="6:30">6:30</option>
      <option value="7:00">7:00</option>
      <option value="7:30">7:30</option>
      <option value="8:00">8:00</option>
      <option value="8:30">8:30</option>
      <option value="9:00">9:00</option>
      <option value="9:30">9:30</option>
      <option value="10:00">10:00</option>
      <option value="10:30">10:30</option>
      <option value="11:00">11:00</option>
      <option value="11:30">11:30</option>
      <option value="12:00">12:00</option>
      <option value="12:30">12:30</option>
      <option value="13:00">13:00</option>
      <option value="13:30">13:30</option>
      <option value="14:00">14:00</option>
      <option value="14:30">14:30</option>
      <option value="15:00">15:00</option>
      <option value="15:30">15:30</option>
      <option value="16:00">16:00</option>
      <option value="16:30">16:30</option>
      <option value="17:00">17:00</option>
      <option value="17:30">17:30</option>
      <option value="18:00">18:00</option>
      <option value="18:30">18:30</option>
      <option value="19:00">19:00</option>
      <option value="19:30">19:30</option>
      <option value="20:00">20:00</option>
      <option value="20:30">20:30</option>
      <option value="21:00">21:00</option>
      <option value="21:30">21:30</option>
      <option value="22:00">22:00</option>
      <option value="22:30">22:30</option>
      <option value="23:00">23:00</option>
      <option value="23:30">23:30</option>
    </select>
    
    <!-- ì˜¤í”ˆ/ë§ˆê° ì‹œê°„ ì…ë ¥ í•„ë“œ ë -->
    <label>ìœ„ë„</label> <!-- 8-16) ìœ„ë„ ë¼ë²¨ -->
    <input id="lat" readonly required /> <!-- 8-17) ìœ„ë„ ê°’ í‘œì‹œ í•„ë“œ (ì½ê¸° ì „ìš©) -->
    <label>ê²½ë„</label> <!-- 8-18) ê²½ë„ ë¼ë²¨ -->
    <input id="lng" readonly required /> <!-- 8-19) ê²½ë„ ê°’ í‘œì‹œ í•„ë“œ (ì½ê¸° ì „ìš©) -->

    <button id="saveBtn" type="button">ì €ì¥</button> <!-- 8-20) ì €ì¥ ë²„íŠ¼ -->

  </form> <!-- 7-5) ìµœìƒìœ„ form ë‹«ê¸° -->

  <script>

  /* â€¦ ì´ì–´ì„œ Firebase / ì§€ë„ / saveBtn í´ë¦­ í•¸ë“¤ëŸ¬ ë“± ê¸°ì¡´ ì½”ë“œ â€¦ */

    const overlay = document.getElementById('loadingOverlay');
    const saveBtn  = document.getElementById('saveBtn');
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 14-1) ìˆ˜ì • ëª¨ë“œ ID ë³€ìˆ˜ ì„ ì–¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let editingId = "";   // â† ì´ ì¤„ì„ ì¶”ê°€í•˜ì„¸ìš”
    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 9. Firebase ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const firebaseConfig = { /* 9-1) Firebase í”„ë¡œì íŠ¸ ì„¤ì • ì •ë³´ */
      apiKey: "AIzaSyCVV1XUfsREQYnah3tbEKBTprgq9wRgiic",
      authDomain: "instamap-9b595.firebaseapp.com",
      projectId: "instamap-9b595",
      storageBucket: "instamap-9b595.firebasestorage.app",
      messagingSenderId: "280950399393",
      appId: "1:280950399393:web:8282e0d352e50c8bcd2be0",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();
    const auth = firebase.auth();

    let currentUser = null;

    firebase.auth().onAuthStateChanged(async user => {
      if (!user) {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        return window.location.href = "/login.html";
      }

      currentUser = user;
      const email = user.email.toLowerCase();
      localStorage.setItem("userEmail", email);

      try {
        const userDoc = await db.collection("users").doc(email).get();
        if (!userDoc.exists || userDoc.data().agreedToTerms !== true) {
          alert("ì•½ê´€ ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.");
          return window.location.href = "/terms.html";
        }

        const storeDoc = await db.collection("stores").doc(user.email).get();
        if (storeDoc.exists) {
          loadStoreToForm({ id: user.email, data: () => storeDoc.data() });
        }
      } catch (err) {
        console.error("ğŸ”¥ Firestore ì ‘ê·¼ ì˜¤ë¥˜:", err);
        alert("ë°ì´í„° ì ‘ê·¼ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    });

    auth.onAuthStateChanged(async user => {
      if (!user) {
        window.location.href = "login.html";  // ë˜ëŠ” ë¡œê·¸ì¸ í˜ì´ì§€
        return;
      }

      currentUser = user;
      console.log("âœ… ë¡œê·¸ì¸ë¨:", user.email);

      const docRef = db.collection("stores").doc(user.email);
      const docSnap = await docRef.get();
      if (docSnap.exists) {
        loadStoreToForm({ id: user.email, data: () => docSnap.data() });
      }
    });


    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10. ì§€ë„ & ìœ„ì¹˜ ì„ íƒ ê¸°ëŠ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    const map = new naver.maps.Map('map',{center:new naver.maps.LatLng(37.5665,126.9780),zoom:15}); /* 10-2) ë„¤ì´ë²„ ì§€ë„ ìƒì„± (ê¸°ë³¸ ì¤‘ì‹¬: ì„œìš¸ ì‹œì²­) */
    let marker = null; /* 10-3) ë§ˆì»¤ ë³€ìˆ˜ ì´ˆê¸°ê°’ null */

    function setLatLng(lat,lng){ /* 10-4) ìœ„ë„/ê²½ë„ ë°›ì•„ì„œ inputì— ì„¤ì • ë° ë§ˆì»¤ í‘œì‹œ */
      document.getElementById('lat').value = lat;
      document.getElementById('lng').value = lng;
      if(marker) marker.setMap(null); /* ê¸°ì¡´ ë§ˆì»¤ ì œê±° */
      marker = new naver.maps.Marker({position:new naver.maps.LatLng(lat,lng),map:map}); /* ìƒˆë¡œìš´ ë§ˆì»¤ ìƒì„± */
    }
    naver.maps.Event.addListener(map,'click',e=>setLatLng(e.coord.lat(),e.coord.lng())); /* 10-5) ì§€ë„ í´ë¦­ ì‹œ ì¢Œí‘œ ê°€ì ¸ì™€ setLatLng í˜¸ì¶œ */
    document.getElementById('getLocBtn').onclick = () =>{ /* 10-6) í˜„ì¬ ìœ„ì¹˜ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ */
      navigator.geolocation?.getCurrentPosition(pos=>{ /* ìœ„ì¹˜ ê¶Œí•œ ìš”ì²­ */
        const {latitude,longitude}=pos.coords;
        setLatLng(latitude,longitude); /* ë§ˆì»¤ ì´ë™ ë° input ê°’ ì„¤ì • */
        map.setCenter(new naver.maps.LatLng(latitude,longitude)); /* ì§€ë„ ì¤‘ì‹¬ ì´ë™ */
        map.setZoom(18); /* í™•ëŒ€ ë ˆë²¨ 18ë¡œ ì„¤ì • */
      },()=>alert('ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.')); /* ê¶Œí•œ ê±°ë¶€ ì‹œ ì•Œë¦¼ */
    };

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 12. ì´ë¯¸ì§€ ì••ì¶• í•¨ìˆ˜ (<=1MB) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function compressImage(file,maxBytes=1_000_000){ /* 12-1) compressImage í•¨ìˆ˜ ì •ì˜ */
      return new Promise(resolve=>{
        const img = new Image();
        const reader = new FileReader();
        reader.onload = e => {
          img.onload = () => {
            const canvas = document.createElement('canvas');
            /* 12-2) ê°€ë¡œ ìµœëŒ€ 1024px ë¹„ìœ¨ ê³„ì‚° */
            const maxW = 500;
            const scale = Math.min(1, maxW / img.width);
            canvas.width  = img.width  * scale;
            canvas.height = img.height * scale;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img,0,0,canvas.width,canvas.height);

            let quality = 0.8;
            function exportBlob(){
              canvas.toBlob(blob=>{
                /* 12-3) blob í¬ê¸°ê°€ maxBytes ì´í•˜ ë˜ëŠ” í’ˆì§ˆì´ 0.4 ë¯¸ë§Œì´ë©´ resolve */
                if(blob.size <= maxBytes || quality < 0.4){
                  resolve(blob);
                }else{
                  quality -= 0.1; /* 12-4) í’ˆì§ˆ 0.1ì”© ë‚®ì¶”ê¸° */
                  exportBlob();
                }
              },'image/jpeg',quality);
            }
            exportBlob();
          };
          img.src = e.target.result; /* 12-5) FileReader ê²°ê³¼ë¥¼ img.srcì— ì„¤ì • */
        };
        reader.readAsDataURL(file); /* 12-6) íŒŒì¼ì„ DataURLë¡œ ë³€í™˜ */
      });
    }
    function convertToActualTime(timeStr) {
      const [hour, min] = timeStr.split(':').map(Number);
      const actualHour = hour >= 24 ? hour - 24 : hour;
      const isNextDay = hour >= 24;
      return { hour: actualHour, min, isNextDay };
    }
    /**
     * 13. parseVimeoInput í•¨ìˆ˜: ì‚¬ìš©ìê°€ ì…ë ¥í•œ Vimeo ê°’(iframe ì½”ë“œ, embed URL, ê³µìœ  URL)ì—ì„œ
     *    ì‹¤ì œ ì¬ìƒìš© player src URLë§Œ ì¶”ì¶œí•˜ì—¬ ë°˜í™˜
     */
    function parseVimeoInput(input) {
      // 13-1) <script> íƒœê·¸ ì œê±°
      input = input.replace(/<script[\s\S]*?<\/script>/gi, "");

      // 13-2) iframe src ì†ì„± ì¶”ì¶œ (iframe ì½”ë“œì¸ ê²½ìš°)
      const iframeMatch = input.match(/<iframe[^>]+src=["']([^"']+)["']/i);
      if (iframeMatch) {
        return iframeMatch[1];
      }
      // 13-3) player.vimeo.com Embed URL í˜•ì‹ ê²€ì¦
      const embedMatch = input.match(/^(https?:\/\/player\.vimeo\.com\/video\/\d+(?:\?.*)?)/i);
      if (embedMatch) {
        return embedMatch[1];
      }

      // 13-4) ê³µìœ ìš© Vimeo URL(vimeo.com/ID) í˜•ì‹ ê²€ì¦
      const shareMatch = input.match(/^https?:\/\/vimeo\.com\/(\d+)/i);
      if (shareMatch) {
        return `https://player.vimeo.com/video/${shareMatch[1]}`;
      }

      // 13-5) ìœ„ ì¡°ê±´ ëª¨ë‘ í•´ë‹¹í•˜ì§€ ì•Šìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
      return "";
    }  /* 13 ì¢…ë£Œ */

    // 14-3) ì„ íƒí•œ ì—…ì²´ë¥¼ í¼ì— ë¡œë“œ: Firestore ë¬¸ì„œ ë°ì´í„°ë¥¼ ê°ê°ì˜ ì…ë ¥ í•„ë“œì— ì±„ìš°ê³  ë§ˆì»¤ ì´ë™
    function loadStoreToForm(doc) {
      const data = doc.data();
      editingId = currentUser.email; /* 14-3-1) ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜: ì„ íƒí•œ ë¬¸ì„œ ID ì €ì¥ */
      document.querySelector('[name=name]').value     = data.name;  /* 14-3-2) ê°€ê²Œ ì´ë¦„ ì„¤ì • */
      document.querySelector('[name=insta_id]').value = data.insta; /* 14-3-3) ì¸ìŠ¤íƒ€ ID ì„¤ì • */
      document.querySelector('[name=desc]').value     = data.desc;  /* 14-3-4) ì„¤ëª… ì„¤ì • */
      document.getElementById('lat').value           = data.lat;   /* 14-3-5) ìœ„ë„ ì„¤ì • */
      document.getElementById('lng').value           = data.lng;   /* 14-3-6) ê²½ë„ ì„¤ì • */
      document.querySelector('[name=vimeo]').value    = data.vimeo || ""; /* 14-3-7) Vimeo í•„ë“œ ì„¤ì • */
      setLatLng(data.lat, data.lng); /* 14-3-8) ë§ˆì»¤ ìœ„ì¹˜ ì¬ì„¤ì • */
      document.getElementById('saveBtn').textContent = "ìˆ˜ì • ì €ì¥"; /* 14-3-9) ì €ì¥ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ */
    }
      document.getElementById('saveBtn').addEventListener('click', async () => {
          
          // â˜… ì €ì¥ ì‹œì‘: ì˜¤ë²„ë ˆì´ í‘œì‹œ & ë²„íŠ¼ ë¹„í™œì„±í™”
          overlay.style.display = 'flex';
          saveBtn.disabled      = true;

          try {
            /* ---------- 15-1) í•´ì‹œíƒœê·¸ ê¸¸ì´ ê²€ì‚¬ ---------- */
            const raw = document.querySelector('[name=hashtags]').value;
            const tags = raw.split(',').map(t => t.trim()).filter(Boolean);
            const invalid = tags.filter(t => Array.from(t).length > 5);
            if (invalid.length) {
              alert(`ë‹¤ìŒ í•´ì‹œíƒœê·¸ëŠ” 5ê¸€ìë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤:\n${invalid.join(', ')}`);
              return;
            }

            /* ---------- 15-2) Vimeo ì…ë ¥ íŒŒì‹± ---------- */
            const rawInput = document.querySelector('[name=vimeo]').value.trim();
            const vimeoUrl = rawInput ? parseVimeoInput(rawInput) : "";
            if (rawInput && !vimeoUrl) {
              alert('ìœ íš¨í•œ Vimeo ë§í¬ë‚˜ <iframe> ì½”ë“œë¥¼ ë„£ì–´ì£¼ì„¸ìš”.');
              return;
            }

            /* ---------- 15-3) ì‹œê°„Â·ì‰¬ëŠ”ë‚  ìˆ˜ì§‘ ---------- */
            const openTime   = document.querySelector('[name=openTime]').value;
            const closeTime  = document.querySelector('[name=closeTime]').value;
            const breakStart = document.querySelector('[name=breakStart]').value;
            const breakEnd   = document.querySelector('[name=breakEnd]').value;
            const offDays    = Array.from(
              document.querySelectorAll('[name="offDays[]"]:checked')
            ).map(cb => cb.value);

            if (!user) {
              alert('ë¡œê·¸ì¸ í›„ ë“±ë¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
              overlay.style.display = 'none';
              saveBtn.disabled = false;
              return;
            }
            /* ---------- 15-4) ì €ì¥ ê°ì²´ ---------- */
            const store = {
              name   : document.querySelector('[name=name]').value.trim(),
              insta  : document.querySelector('[name=insta_id]').value.trim(),
              desc   : document.querySelector('[name=desc]').value.trim(),
              lat    : parseFloat(document.getElementById('lat').value),
              lng    : parseFloat(document.getElementById('lng').value),
              photo  : "",
              vimeo  : vimeoUrl,
              hashtags  : tags,
              openTime  : openTime,
              closeTime : closeTime,
              breakStart: breakStart,
              breakEnd  : breakEnd,
              offDays   : offDays,
              userEmail: currentUser.email,  // âœ… ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ì´ë©”ì¼ ì €ì¥
              created: firebase.firestore.FieldValue.serverTimestamp()
            };

            if (!store.name || !store.insta || isNaN(store.lat) || isNaN(store.lng)
                || !openTime || !closeTime) {
              alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
              return;
            }

            /* ---------- 15-5) (ì„ íƒ) ì‚¬ì§„ ì—…ë¡œë“œ ---------- */
            const file = document.getElementById('photo').files[0];
            if (file) {
              const blob = await compressImage(file);
              const filename = `store_photos/${Date.now()}_${file.name.replace(/\s+/g,'')}`;
              const ref = storage.ref().child(filename);
              await ref.put(blob);
              store.photo = await ref.getDownloadURL();
            }

            /* ---------- 15-6) Firestore ì €ì¥ ---------- */
            const storeRef = db.collection('stores').doc(currentUser.email);
            if (editingId) {
              await storeRef.update(store);
              alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else {
              const exists = await storeRef.get();
              if (exists.exists) {
                alert("ì´ë¯¸ ë“±ë¡ëœ ê°€ê²Œì…ë‹ˆë‹¤. ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜ë©ë‹ˆë‹¤.");
                loadStoreToForm({ id: currentUser.email, data: () => exists.data() });
                return;
              }
              await storeRef.set(store);
              alert('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }

            /* ---------- 15-7) í¼ ë¦¬ì…‹ ---------- */
            document.getElementById('storeForm').reset();
            if (marker) marker.setMap(null);
            editingId = "";
            saveBtn.textContent = "ì €ì¥";

          } catch (err) {
            console.error(err);
            alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          } finally {
            // â˜… ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸° & ë²„íŠ¼ í™œì„±í™”
            overlay.style.display = 'none';
            saveBtn.disabled      = false;
          }
        });
  </script>   
<!-- ì°¸ê³  ì˜ìƒ ëª¨ë‹¬ -->
<div id="videoModal" class="modal">
  <div class="modal-content">
    <button id="closeVideo">&times;</button>   <!-- ë‹«ê¸° ë²„íŠ¼ -->
    <iframe
      id="videoFrame"
      src=""
      frameborder="0"
      allow="autoplay; fullscreen"
      allowfullscreen></iframe>
  </div>
</div>
<script>
/* === ì°¸ê³  ì˜ìƒ ëª¨ë‹¬ === */
const videoModal = document.getElementById('videoModal');
const videoFrame = document.getElementById('videoFrame');
const helpBtn    = document.getElementById('helpVideoBtn');
const closeBtn   = document.getElementById('closeVideo');

helpBtn.addEventListener('click', () => {
  const url = 'https://player.vimeo.com/video/1091824548?h=bfd071815a&autoplay=1&muted=1';
  videoFrame.src = url;              // ì¬ìƒ ì‹œì‘
  videoModal.style.display = 'flex'; // ëª¨ë‹¬ ì—´ê¸°
});

function hideModal() {
  videoFrame.src = '';               // ì •ì§€ & ë©”ëª¨ë¦¬ í•´ì œ
  videoModal.style.display = 'none';
}
closeBtn.addEventListener('click', hideModal);
videoModal.addEventListener('click', e => {
  if (e.target === videoModal) hideModal();  // ê²€ì€ ë°°ê²½ í„°ì¹˜ â†’ ë‹«ê¸°
});
</script>


</body>
</html>
