rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ğŸ”“ ëˆ„êµ¬ë‚˜ stores ë¬¸ì„œ ì½ê¸°/ì“°ê¸° í—ˆìš©
    match /stores/{storeId} {
      allow read, write: if true;
    }

    // âœ… ë¡œê·¸ì¸ëœ ìœ ì €ëŠ” ìì‹ ì˜ users ë¬¸ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
    match /users/{userEmail} {
      allow read, write: if request.auth != null
                         && request.auth.token.email == userEmail;
    }
  }
}
-----------------------------------------------

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ğŸŸ¢ stores ë¬¸ì„œ: ì½ê¸°ëŠ” ëˆ„êµ¬ë‚˜, ìˆ˜ì •ì€ userEmailì´ ë³¸ì¸ì¼ ë•Œë§Œ
    match /stores/{storeId} {
      allow read: if true;

      // ë¬¸ì„œ ìƒˆë¡œ ë§Œë“¤ê±°ë‚˜ ì—…ë°ì´íŠ¸í•  ë•Œ ì¡°ê±´
      allow write: if request.auth != null
                   && (
                        // â‘  ë¬¸ì„œ ìƒì„± ì‹œ â†’ ì…ë ¥ê°’ì— userEmailì´ ë³¸ì¸ ê²ƒì¸ì§€ ê²€ì‚¬
                        !(resource.data.userEmail is string)
                        && request.resource.data.userEmail == request.auth.token.email

                        // â‘¡ ë¬¸ì„œ ìˆ˜ì • ì‹œ â†’ ê¸°ì¡´ userEmailì´ ë³¸ì¸ ê²ƒì¸ì§€ ê²€ì‚¬
                        || resource.data.userEmail == request.auth.token.email
                   );
    }

    // ğŸŸ¢ users ë¬¸ì„œ: ë¡œê·¸ì¸ëœ ìœ ì € ë³¸ì¸ë§Œ ì ‘ê·¼ ê°€ëŠ¥
    match /users/{userEmail} {
      allow read, write: if request.auth != null
                         && request.auth.token.email == userEmail;
    }
  }
}

