<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>저장된 매장 목록</title>

  <!-- Naver Maps SDK -->
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=qpbrmxiff4"></script>

  <!-- Firebase SDK (compat 모드) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <style>
    body { margin: 0; font-family: sans-serif; overflow: hidden; }
    #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

    #toggleListBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 999;
      padding: 10px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
    }

    #storeList {
      position: absolute;
      bottom: -60%;
      left: 0;
      width: 100%;
      height: 60%;
      background: white;
      border-top-left-radius: 16px;
      border-top-right-radius: 16px;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      z-index: 998;
      overflow-y: auto;
      transition: bottom 0.3s ease;
      padding: 16px;
    }

    #storeList.active {
      bottom: 0;
    }

    .store {
      padding: 6px;
      border-bottom: 1px solid #ddd;
      cursor: pointer;
    }
    .store:hover {
      background: #f0f4ff;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <button id="toggleListBtn">매장 리스트 보기</button>
  <div id="storeList">
    <h3>매장 리스트</h3>
  </div>

<script>
// Firebase 초기화
firebase.initializeApp({
  apiKey: "AIzaSyCVYV1UxfSREQYnah3tBEKBTprgq9wRgii",
  authDomain: "instamap-9b595.firebaseapp.com",
  projectId: "instamap-9b595",
  storageBucket: "instamap-9b595.appspot.com",
  messagingSenderId: "280950399933",
  appId: "1:280950399933:web:8282e0d352e50c8bcd2be0"
});
const db = firebase.firestore();

const map = new naver.maps.Map('map', {
  center: new naver.maps.LatLng(37.5665, 126.9780),
  zoom: 12
});

let markers = [];
const listDiv = document.getElementById('storeList');

async function renderStores() {
  markers.forEach(m => m.setMap(null));
  markers = [];
  listDiv.innerHTML = '<h3>매장 리스트</h3>';

  const snapshot = await db.collection('stores')
                           .orderBy('created', 'desc')
                           .get();

  snapshot.forEach(doc => {
    const s = doc.data();
    const lat = parseFloat(s.lat), lng = parseFloat(s.lng);
    if (isNaN(lat) || isNaN(lng)) return;

    const marker = new naver.maps.Marker({
      position: new naver.maps.LatLng(lat, lng),
      map: map,
      icon: {
        url: '/image/beer-marker.png',
        size: new naver.maps.Size(32, 32),
        anchor: new naver.maps.Point(16, 32)
      }
    });
    markers.push(marker);

    const info = new naver.maps.InfoWindow({
      content: `
        <div style="min-width:180px;padding:6px">
          <strong>${s.name}</strong><br>
          <a href="https://instagram.com/${s.insta}" target="_blank">
            @${s.insta}
          </a><br>
          ${s.desc || ''}
        </div>`
    });
    naver.maps.Event.addListener(marker, 'click', () => {
      info.open(map, marker);
    });

    const div = document.createElement('div');
    div.className = 'store';
    div.innerHTML = `<strong>${s.name}</strong><br>@${s.insta}`;
    div.onclick = () => {
      map.setCenter(marker.getPosition());
      map.setZoom(15);
      info.open(map, marker);
    };
    listDiv.appendChild(div);
  });
}

renderStores();

// 리스트 토글
document.getElementById('toggleListBtn').addEventListener('click', () => {
  listDiv.classList.toggle('active');
});
</script>
</body>
</html>
