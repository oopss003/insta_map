<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>매장 지도</title>
  <style>
    #map {
      width: 100%;
      height: 100vh;
    }
    #store-list {
      position: absolute;
      top: 0;
      right: 0;
      width: 250px;
      height: 100%;
      overflow-y: auto;
      background: white;
      border-left: 1px solid #ccc;
      padding: 10px;
    }
    #control {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
  </style>
  <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=YOUR_NAVER_CLIENT_ID"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div id="control">
    <button onclick="moveToMyLocation()">내 위치로 이동</button>
  </div>

  <div id="map"></div>
  <div id="store-list"><strong>매장 리스트</strong><br /></div>

  <script>
    const firebaseConfig = {
      // 본인의 Firebase 설정 값으로 교체
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const map = new naver.maps.Map('map', {
      center: new naver.maps.LatLng(37.5665, 126.9780),
      zoom: 13
    });

    function moveToMyLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((pos) => {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;
          const location = new naver.maps.LatLng(lat, lng);
          map.setCenter(location);
        });
      } else {
        alert("GPS를 지원하지 않는 브라우저입니다.");
      }
    }

    db.collection("stores").get().then((querySnapshot) => {
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const position = new naver.maps.LatLng(data.lat, data.lng);
        const marker = new naver.maps.Marker({
          map: map,
          position: position
        });

        const infoWindow = new naver.maps.InfoWindow({
          content: `<div style="padding:10px;"><strong>${data.name}</strong><br/>@${data.insta}<br/>${data.desc}</div>`
        });

        naver.maps.Event.addListener(marker, "click", function () {
          infoWindow.open(map, marker);
        });

        const list = document.getElementById("store-list");
        const item = document.createElement("div");
        item.innerHTML = `<strong>${data.name}</strong><br/>@${data.insta}<br/><br/>`;
        list.appendChild(item);
      });
    });
  </script>
</body>
</html>
