<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>구글 로그인 처리</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
  <script src="js/firebase-config.js"></script>
</head>
<body>
  <p>로그인 처리 중입니다...</p>
  <script>
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    const id_token = params.get("id_token");

    if (id_token) {
      const decoded = jwt_decode(id_token);
      const email = decoded.email;
      const nickname = decoded.name;

      const db = firebase.firestore();
      db.collection("users").doc(email).set({
        email: email,
        nickname: nickname,
        provider: "google",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true }).then(() => {
        window.location.href = "mypage.html";
      });
    } else {
      alert("로그인 실패: 토큰 없음");
    }
  </script>
</body>
</html>

