<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë‚´ì •ë³´</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background: #f5f6fb;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 344px;
      padding: 16px 0 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      margin-bottom: 12px;
    }

    .back-btn,
    .profile-icon {
      width: 77px;
      height: 77px;
      background: #fff;
      border-radius: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }

    .image-card {
      width: 100%;
      background: #fff0e5;
      border-radius: 16px;
      padding: 16px;
      box-sizing: border-box;
      margin-bottom: 12px;
      position: relative;
    }

     .image-card img {
      width: 100%;       /* ë¶€ëª¨ ë„ˆë¹„ì— ë§ì¶¤ (344px) */
      height: auto;      /* ë¹„ìœ¨ ìœ ì§€ */
      border-radius: 16px;
      background: #eee;
      object-fit: cover; /* ì´ë¯¸ì§€ ì˜ë¦¬ëŠ” ê²½ìš° ì»¤ë²„ë¡œ ìœ ì§€ */
    }

    .desc {
      margin-top: 8px;
      font-size: 14px;
      color: #333;
      line-height: 1.4;
    }

    .image-card button {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #fff;
      border: none;
      border-radius: 8px;
      padding: 4px 10px;
      cursor: pointer;
      font-size: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .info-box,
    .event-box,
    .action-btn {
      width: 100%;
      background: #fff;
      border-radius: 16px;
      padding: 16px;
      box-sizing: border-box;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      margin-bottom: 12px;
      font-size: 14px;
      color: #222;
    }

    .info-box strong,
    .event-box strong {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .action-btn {
      height: 77px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
    }

    .action-btn:active {
      transform: scale(0.97);
      background: #eee;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- í—¤ë” -->
    <div class="header">
      <div class="back-btn" onclick="history.back()">
        <img src="/images/arrow-left-1.svg" width="24" />
      </div>
      <div class="profile-icon">
        <img src="/images/user-profile.svg" width="32" />
      </div>
    </div>

    <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ ì¹´ë“œ -->
    <div class="image-card" onclick="openStyleModal()">
      <img id="profileImage" src="" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" />
      <div class="desc">
        ì‚¬ì§„ ì˜ ë‚˜ì˜¤ëŠ” ê°ì„± ìˆ ì§‘, ì—¬ê¸° ë‹¤ ìˆì–´ìš”.<br />
        ë¶„ìœ„ê¸°ì™€ ê°ì„±ê¹Œì§€ ì±™ê¸°ëŠ” ë‹¹ì‹ ì„ ìœ„í•œ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸!
      </div>
    </div>

    <!-- ìŠ¤íƒ€ì¼ ì„ íƒ ëª¨ë‹¬ -->
    <div id="styleModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:999;">
      <div style="background:#fff; border-radius:16px; padding:20px; display:flex; flex-direction:column; align-items:center;">
        <p>í”„ë¡œí•„ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•˜ì„¸ìš”</p>
        <div style="display:flex; gap:12px; flex-wrap:wrap; justify-content:center;">
          <img src="https://oopss003.github.io/insta_map/images/001.png" width="80" onclick="selectStyle('001')" style="cursor:pointer; border-radius:12px;" />
          <img src="https://oopss003.github.io/insta_map/images/002.png" width="80" onclick="selectStyle('002')" style="cursor:pointer; border-radius:12px;" />
          <img src="https://oopss003.github.io/insta_map/images/003.png" width="80" onclick="selectStyle('003')" style="cursor:pointer; border-radius:12px;" />
          <img src="https://oopss003.github.io/insta_map/images/004.png" width="80" onclick="selectStyle('004')" style="cursor:pointer; border-radius:12px;" />
        </div>
        <button onclick="closeStyleModal()" style="margin-top:16px;">ë‹«ê¸°</button>
      </div>
    </div>


    <!-- ì´ë©”ì¼ -->
    <div class="info-box" id="emailBox">
      <strong>E-mail</strong>
      ë¡œë”© ì¤‘...
    </div>

    <!-- ë‹‰ë„¤ì„ -->
    <div class="info-box" id="nicknameBox">
      <strong>ë‹‰ë„¤ì„</strong>
      ë¡œë”© ì¤‘...
    </div>

    <!-- ì´ë²¤íŠ¸ ë‚´ì—­ -->
    <div class="event-box">
      <strong>ì´ë²¤íŠ¸ ë‚´ì—­</strong>
      <!-- ë¹„ì–´ ìˆìŒ -->
    </div>

    <!-- ë¡œê·¸ì•„ì›ƒ -->
    <div class="action-btn" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</div>

    <!-- íƒˆí‡´í•˜ê¸° -->
    <div class="action-btn" onclick="withdraw()">íƒˆí‡´í•˜ê¸°</div>

  </div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCVV1XUfsREQYnah3tbEKBTprgq9wRgiic",
    authDomain: "instamap-9b595.firebaseapp.com",
    projectId: "instamap-9b595",
    storageBucket: "instamap-9b595.appspot.com",
    messagingSenderId: "280950399393",
    appId: "1:280950399393:web:8282e0d352e50c8bcd2be0"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  firebase.auth().onAuthStateChanged(user => {
    if (!user) {
      alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      location.href = "/login.html";
      return;
    }

    const email = user.email.toLowerCase();
    localStorage.setItem("userEmail", email);  // ì¶”í›„ ì‚¬ìš©ì„ ìœ„í•œ ì €ì¥

    db.collection("users").doc(email).get().then(doc => {
      const data = doc.data();
      if (!data) {
        alert("ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      // ì´ë©”ì¼
      document.getElementById("emailBox").innerHTML = `
        <strong>E-mail</strong><br />
        ${email}
      `;

      // ë‹‰ë„¤ì„
      document.getElementById("nicknameBox").innerHTML = `
        <strong>ë‹‰ë„¤ì„</strong><br />
        ${data.nickname || 'ë‹‰ë„¤ì„ ì—†ìŒ'}
      `;

      // í”„ë¡œí•„ ì´ë¯¸ì§€
      const selectedStyle = data.selectedStyle || "001";
      const imagePath = `https://oopss003.github.io/insta_map/public/images/${selectedStyle}.png`;
      document.getElementById("profileImage").src = imagePath;
    }).catch(err => {
      console.error("ğŸ”¥ Firestore ì˜¤ë¥˜", err);
      alert("ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    });
  });

  function logout() {
    firebase.auth().signOut().then(() => {
      alert("ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.");
      location.href = "/login.html";
    });
  }

  function withdraw() {
    const confirmed = confirm("ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
    if (confirmed) {
      const user = firebase.auth().currentUser;
      if (user) {
        user.delete().then(() => {
          alert("íƒˆí‡´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
          location.href = "/login.html";
        }).catch(error => {
          alert("ì¬ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
        });
      }
    }
  }
  function openStyleModal() {
    document.getElementById('styleModal').style.display = 'flex';
  }

  function closeStyleModal() {
    document.getElementById('styleModal').style.display = 'none';
  }

  function selectStyle(styleCode) {
    const email = localStorage.getItem("userEmail");
    if (!email) {
      alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
      return;
    }

    db.collection("users").doc(email.toLowerCase()).update({
      selectedStyle: styleCode
    }).then(() => {
      // ì´ë¯¸ì§€ ê°±ì‹ 
      const imagePath = `https://oopss003.github.io/insta_map/images/${styleCode}.png`;
      document.getElementById("profileImage").src = imagePath;
      closeStyleModal();
    }).catch(error => {
      alert("ì´ë¯¸ì§€ ë³€ê²½ ì‹¤íŒ¨: " + error.message);
    });
  }

</script>

</body>
</html>
